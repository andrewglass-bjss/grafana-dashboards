{"meta":{"type":"db","canSave":false,"canEdit":true,"canAdmin":false,"canStar":true,"slug":"general-network-ingress-egress-overview","url":"/d/general-egress_ingress/general-network-ingress-egress-overview","expires":"0001-01-01T00:00:00Z","created":"2020-08-31T19:18:38Z","updated":"2021-05-21T14:34:02Z","updatedBy":"ops-contact@gitlab.com","createdBy":"ops-contact@gitlab.com","version":775,"hasAcl":false,"isFolder":false,"folderId":699,"folderTitle":"General Metrics","folderUrl":"/dashboards/f/general/general-metrics","provisioned":false,"provisionedExternalId":""},"dashboard":{"__inputs":[],"__requires":[],"annotations":{"list":[]},"description":"Uploaded by https://gitlab.com/gitlab-com/runbooks/-/jobs/1283493053 at Fri May 21 14:34:02 UTC 2021","editable":true,"gnetId":null,"graphTooltip":1,"hideControls":false,"id":null,"links":[],"panels":[{"content":"### What is this?\n\nAmount of ingress / egress traffic **per day**, for nodes (Virtual Machines) and HAProxy Backends\n\n* HAProxy Nodes: Ingress/Egress bytes from the VMs\n  * registry: registry.gitlab.com traffic \n  * fe: gitlab.com traffic (via cloudflare)\n  * pages: *.gitlab.io and pages custom domains\n* Fleet\n  * git: git-https, git-ssh, websockets\n  * api: gitlab.com public api, gitlab.com/v4/api/*\n  * web: gitlab.com web traffic, anything that is not gitlab.com/v4/api/*\n  * web-pages: *.gitlab.io pages traffic\n* Storage\n  * file: All projects/wikis from local disk, this is where gitaly runs\n  * pages: NFS server for *.gitlab.io gitlab pages\n  * share: Shared cache for job traces and artifacts\n  * patroni: All postgres database servers\n  * redis: All redis clusters\n  * object storagE: All object storage buckets\n","datasource":null,"gridPos":{"h":13,"w":8,"x":0,"y":1},"id":2,"mode":"markdown","title":"Explainer","type":"text"},{"content":"### HAProxy Backend Network Reporting\n\n**HAProxy backend reporting looks different than egress/ingress node metrics.**\n\nThis is because we are using HAProxy application metrics that allow us to see data\nflowing in and out of individual backends.\n\n* Web / API / HTTPs Git / Git SSH / Websockets - This traffic is served by the HAProxy Fe nodes\n* Registry - This traffic is served by the HAProxy Registry nodes\n* Pages - This traffic is served by the HAProxy Pages nodes\n\nNote that some of the graphs are more lopsided than the node graphs, see the FAQ for an explanation.\n","datasource":null,"gridPos":{"h":13,"w":8,"x":8,"y":1},"id":3,"mode":"markdown","title":"HAProxy Backends","type":"text"},{"content":"## FAQ\n\n* Why is the fleet node bandwidth so symetrical? Shouldn't we be sending more than we receive?\n  * Most of our traffic is proxied to storage services, or to object storage.\n* Do clients download direct from object storage?\n  * It depends. \n    * registry: all image pulls are direct from object storage \n    * uploads/lfs/merge-request-diffs: currently set to proxy but we might change that\n      https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/10117\n* Why for HAProxy Registry backend traffic, is there so much more ingress than egress?\n  * Registry downloads are direct from Object Storage\n* Why for HAProxy HTTPs and SSH Git traffic is egress so much more than ingress?\n  * We are sending more Git data to clients than we are receiving\n* Why do the web-pages fleet nodes have so much ingress compared to egress?\n  * Because of NFS, as you can see it is reading a lot of data from NFS but not serving\n    as much to the client, and probably compressed.\n  * Note that Pages data transfer on HAProxy shows more egress than ingress, which is what\n    we would expect\n* What about canary traffic?\n  * Canary traffic is included in production traffic\n* Why is there so little websockets traffic?\n  * Websockets is only used right now for the interractive terminal, for connecting to K8s pods\n","datasource":null,"gridPos":{"h":13,"w":8,"x":16,"y":1},"id":4,"mode":"markdown","title":"FAQ","type":"text"},{"collapse":false,"collapsed":false,"gridPos":{"h":12,"w":24,"x":0,"y":2},"id":5,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"HAProxy data transfer by Backend","titleSize":"h6","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":3,"fill":1,"gridPos":{"h":7,"w":6,"x":0,"y":2},"id":6,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":false,"max":true,"min":false,"rightSide":true,"show":false,"sideWidth":null,"total":false,"values":false},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(increase(haproxy_backend_bytes_out_total{device!=\"lo\", backend=~\".*https_git$\", env=\"$environment\"}[1d]))","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"egress","refId":"A"},{"expr":"sum(increase(haproxy_backend_bytes_in_total{device!=\"lo\", backend=~\".*https_git$\", env=\"$environment\"}[1d])) * -1","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"ingress","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"HTTPs Git Data Transfer / 24h","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":"bytes","logBase":1,"max":null,"min":null,"show":true},{"format":"byte","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":3,"fill":1,"gridPos":{"h":7,"w":6,"x":6,"y":2},"id":7,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":false,"max":true,"min":false,"rightSide":true,"show":false,"sideWidth":null,"total":false,"values":false},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(increase(haproxy_backend_bytes_out_total{device!=\"lo\", backend=~\".*registry$\", env=\"$environment\"}[1d]))","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"egress","refId":"A"},{"expr":"sum(increase(haproxy_backend_bytes_in_total{device!=\"lo\", backend=~\".*registry$\", env=\"$environment\"}[1d])) * -1","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"ingress","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Registry Data Transfer / 24h","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":"bytes","logBase":1,"max":null,"min":null,"show":true},{"format":"byte","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":3,"fill":1,"gridPos":{"h":7,"w":6,"x":12,"y":2},"id":8,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":false,"max":true,"min":false,"rightSide":true,"show":false,"sideWidth":null,"total":false,"values":false},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(increase(haproxy_backend_bytes_out_total{device!=\"lo\", backend=~\".*api$\", env=\"$environment\"}[1d]))","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"egress","refId":"A"},{"expr":"sum(increase(haproxy_backend_bytes_in_total{device!=\"lo\", backend=~\".*api$\", env=\"$environment\"}[1d])) * -1","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"ingress","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"API Data Transfer / 24h","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":"bytes","logBase":1,"max":null,"min":null,"show":true},{"format":"byte","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":3,"fill":1,"gridPos":{"h":7,"w":6,"x":18,"y":2},"id":9,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":false,"max":true,"min":false,"rightSide":true,"show":false,"sideWidth":null,"total":false,"values":false},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(increase(haproxy_backend_bytes_out_total{device!=\"lo\", backend=~\".*web$\", env=\"$environment\"}[1d]))","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"egress","refId":"A"},{"expr":"sum(increase(haproxy_backend_bytes_in_total{device!=\"lo\", backend=~\".*web$\", env=\"$environment\"}[1d])) * -1","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"ingress","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Web Data Transfer / 24h","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":"bytes","logBase":1,"max":null,"min":null,"show":true},{"format":"byte","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":3,"fill":1,"gridPos":{"h":7,"w":8,"x":0,"y":3},"id":10,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":false,"max":true,"min":false,"rightSide":true,"show":false,"sideWidth":null,"total":false,"values":false},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(increase(haproxy_backend_bytes_out_total{device!=\"lo\", backend=~\".*pages_https?$\", env=\"$environment\"}[1d]))","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"egress","refId":"A"},{"expr":"sum(increase(haproxy_backend_bytes_in_total{device!=\"lo\", backend=~\".*pages_https?$\", env=\"$environment\"}[1d])) * -1","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"ingress","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Pages Data Transfer / 24h","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":"bytes","logBase":1,"max":null,"min":null,"show":true},{"format":"byte","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":3,"fill":1,"gridPos":{"h":7,"w":8,"x":8,"y":3},"id":11,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":false,"max":true,"min":false,"rightSide":true,"show":false,"sideWidth":null,"total":false,"values":false},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(increase(haproxy_backend_bytes_out_total{device!=\"lo\", backend=~\".*websockets$\", env=\"$environment\"}[1d]))","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"egress","refId":"A"},{"expr":"sum(increase(haproxy_backend_bytes_in_total{device!=\"lo\", backend=~\".*websockets$\", env=\"$environment\"}[1d])) * -1","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"ingress","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"WebSockets Data Transfer / 24h","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":"bytes","logBase":1,"max":null,"min":null,"show":true},{"format":"byte","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":3,"fill":1,"gridPos":{"h":7,"w":8,"x":16,"y":3},"id":12,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":false,"max":true,"min":false,"rightSide":true,"show":false,"sideWidth":null,"total":false,"values":false},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(increase(haproxy_backend_bytes_out_total{device!=\"lo\", backend=~\".*ssh$\", env=\"$environment\"}[1d]))","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"egress","refId":"A"},{"expr":"sum(increase(haproxy_backend_bytes_in_total{device!=\"lo\", backend=~\".*ssh$\", env=\"$environment\"}[1d])) * -1","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"ingress","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"SSH Data Transfer / 24h","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":"bytes","logBase":1,"max":null,"min":null,"show":true},{"format":"byte","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"collapse":false,"collapsed":false,"gridPos":{"h":12,"w":24,"x":0,"y":4},"id":13,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"HAProxy Nodes","titleSize":"h6","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":3,"fill":1,"gridPos":{"h":7,"w":8,"x":0,"y":4},"id":14,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":false,"max":true,"min":false,"rightSide":true,"show":false,"sideWidth":null,"total":false,"values":false},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(increase(node_network_transmit_bytes_total{device!=\"lo\", fqdn=~\"^fe-registry-[0-9].*\", env=\"$environment\"}[1d]))","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"egress","refId":"A"},{"expr":"sum(increase(node_network_receive_bytes_total{device!=\"lo\", fqdn=~\"^fe-registry-[0-9].*\", env=\"$environment\"}[1d])) * -1","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"ingress","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Fe (HAProxy) Registry Data Transfer / 24h","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":"bytes","logBase":1,"max":null,"min":null,"show":true},{"format":"byte","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":3,"fill":1,"gridPos":{"h":7,"w":8,"x":8,"y":4},"id":15,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":false,"max":true,"min":false,"rightSide":true,"show":false,"sideWidth":null,"total":false,"values":false},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(increase(node_network_transmit_bytes_total{device!=\"lo\", fqdn=~\"^fe-[0-9].*\", env=\"$environment\"}[1d]))","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"egress","refId":"A"},{"expr":"sum(increase(node_network_receive_bytes_total{device!=\"lo\", fqdn=~\"^fe-[0-9].*\", env=\"$environment\"}[1d])) * -1","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"ingress","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Fe (HAProxy) Data Transfer / 24h","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":"bytes","logBase":1,"max":null,"min":null,"show":true},{"format":"byte","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":3,"fill":1,"gridPos":{"h":7,"w":8,"x":16,"y":4},"id":16,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":false,"max":true,"min":false,"rightSide":true,"show":false,"sideWidth":null,"total":false,"values":false},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(increase(node_network_transmit_bytes_total{device!=\"lo\", fqdn=~\"^fe-pages-[0-9].*\", env=\"$environment\"}[1d]))","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"egress","refId":"A"},{"expr":"sum(increase(node_network_receive_bytes_total{device!=\"lo\", fqdn=~\"^fe-pages-[0-9].*\", env=\"$environment\"}[1d])) * -1","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"ingress","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Fe Pages (HAProxy) Data Transfer / 24h","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":"bytes","logBase":1,"max":null,"min":null,"show":true},{"format":"byte","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"collapse":false,"collapsed":false,"gridPos":{"h":12,"w":24,"x":0,"y":5},"id":17,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Fleet Nodes","titleSize":"h6","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":3,"fill":1,"gridPos":{"h":7,"w":6,"x":0,"y":5},"id":18,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":false,"max":true,"min":false,"rightSide":true,"show":false,"sideWidth":null,"total":false,"values":false},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(increase(node_network_transmit_bytes_total{device!=\"lo\", type=\"git\", env=\"$environment\"}[1d]))","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"egress","refId":"A"},{"expr":"sum(increase(node_network_receive_bytes_total{device!=\"lo\", type=\"git\", env=\"$environment\"}[1d])) * -1","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"ingress","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Git Data Transfer / 24h","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":"bytes","logBase":1,"max":null,"min":null,"show":true},{"format":"byte","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":3,"fill":1,"gridPos":{"h":7,"w":6,"x":6,"y":5},"id":19,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":false,"max":true,"min":false,"rightSide":true,"show":false,"sideWidth":null,"total":false,"values":false},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(increase(node_network_transmit_bytes_total{device!=\"lo\", type=\"api\", env=\"$environment\"}[1d]))","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"egress","refId":"A"},{"expr":"sum(increase(node_network_receive_bytes_total{device!=\"lo\", type=\"api\", env=\"$environment\"}[1d])) * -1","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"ingress","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"API Data Transfer / 24h","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":"bytes","logBase":1,"max":null,"min":null,"show":true},{"format":"byte","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":3,"fill":1,"gridPos":{"h":7,"w":6,"x":12,"y":5},"id":20,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":false,"max":true,"min":false,"rightSide":true,"show":false,"sideWidth":null,"total":false,"values":false},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(increase(node_network_transmit_bytes_total{device!=\"lo\", type=\"web\", env=\"$environment\"}[1d]))","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"egress","refId":"A"},{"expr":"sum(increase(node_network_receive_bytes_total{device!=\"lo\", type=\"web\", env=\"$environment\"}[1d])) * -1","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"ingress","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Web Data Transfer / 24h","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":"bytes","logBase":1,"max":null,"min":null,"show":true},{"format":"byte","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":3,"fill":1,"gridPos":{"h":7,"w":6,"x":18,"y":5},"id":21,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":false,"max":true,"min":false,"rightSide":true,"show":false,"sideWidth":null,"total":false,"values":false},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(increase(node_network_transmit_bytes_total{device!=\"lo\", type=\"web-pages\", env=\"$environment\"}[1d]))","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"egress","refId":"A"},{"expr":"sum(increase(node_network_receive_bytes_total{device!=\"lo\", type=\"web-pages\", env=\"$environment\"}[1d])) * -1","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"ingress","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Web Pages Transfer / 24h","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":"bytes","logBase":1,"max":null,"min":null,"show":true},{"format":"byte","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"collapse":false,"collapsed":false,"gridPos":{"h":12,"w":24,"x":0,"y":6},"id":22,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Storage Nodes","titleSize":"h6","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":3,"fill":1,"gridPos":{"h":7,"w":8,"x":0,"y":6},"id":23,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":false,"max":true,"min":false,"rightSide":true,"show":false,"sideWidth":null,"total":false,"values":false},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(increase(node_network_transmit_bytes_total{device!=\"lo\", type=\"gitaly\", env=\"$environment\"}[1d]))","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"egress","refId":"A"},{"expr":"sum(increase(node_network_receive_bytes_total{device!=\"lo\", type=\"gitaly\", env=\"$environment\"}[1d])) * -1","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"ingress","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"File (Gitaly) Data Transfer / 24h","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":"bytes","logBase":1,"max":null,"min":null,"show":true},{"format":"byte","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":3,"fill":1,"gridPos":{"h":7,"w":8,"x":8,"y":6},"id":24,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":false,"max":true,"min":false,"rightSide":true,"show":false,"sideWidth":null,"total":false,"values":false},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(increase(node_network_transmit_bytes_total{device!=\"lo\", type=\"patroni\", env=\"$environment\"}[1d]))","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"egress","refId":"A"},{"expr":"sum(increase(node_network_receive_bytes_total{device!=\"lo\", type=\"patroni\", env=\"$environment\"}[1d])) * -1","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"ingress","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Patroni  (Database) Data Transfer / 24h","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":"bytes","logBase":1,"max":null,"min":null,"show":true},{"format":"byte","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":3,"fill":1,"gridPos":{"h":7,"w":8,"x":16,"y":6},"id":25,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":false,"max":true,"min":false,"rightSide":true,"show":false,"sideWidth":null,"total":false,"values":false},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(increase(node_network_transmit_bytes_total{device!=\"lo\", type=~\"^redis.*\", env=\"$environment\"}[1d]))","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"egress","refId":"A"},{"expr":"sum(increase(node_network_receive_bytes_total{device!=\"lo\", type=~\"^redis.*\", env=\"$environment\"}[1d])) * -1","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"ingress","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Redis  (All) Data Transfer / 24h","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":"bytes","logBase":1,"max":null,"min":null,"show":true},{"format":"byte","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":3,"fill":1,"gridPos":{"h":7,"w":12,"x":0,"y":7},"id":26,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":false,"max":true,"min":false,"rightSide":true,"show":false,"sideWidth":null,"total":false,"values":false},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(increase(node_network_transmit_bytes_total{device!=\"lo\", fqdn=~\"^pages-.*\", env=\"$environment\"}[1d]))","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"egress","refId":"A"},{"expr":"sum(increase(node_network_receive_bytes_total{device!=\"lo\", fqdn=~\"^pages-.*\", env=\"$environment\"}[1d])) * -1","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"ingress","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Pages Storage (NFS) Data Transfer / 24h","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":"bytes","logBase":1,"max":null,"min":null,"show":true},{"format":"byte","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":3,"fill":1,"gridPos":{"h":7,"w":12,"x":12,"y":7},"id":27,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":false,"max":true,"min":false,"rightSide":true,"show":false,"sideWidth":null,"total":false,"values":false},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(increase(node_network_transmit_bytes_total{device!=\"lo\", fqdn=~\"^share-.*\", env=\"$environment\"}[1d]))","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"egress","refId":"A"},{"expr":"sum(increase(node_network_receive_bytes_total{device!=\"lo\", fqdn=~\"^share-.*\", env=\"$environment\"}[1d])) * -1","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"ingress","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Share Cache Storage (Traces / Artifacts) Data Transfer / 24h","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":"bytes","logBase":1,"max":null,"min":null,"show":true},{"format":"byte","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"collapse":false,"collapsed":false,"gridPos":{"h":12,"w":24,"x":0,"y":8},"id":28,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Object Storage","titleSize":"h6","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":3,"fill":1,"gridPos":{"h":7,"w":24,"x":0,"y":8},"id":29,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":false,"max":true,"min":false,"rightSide":true,"show":false,"sideWidth":null,"total":false,"values":false},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (bucket_name) (stackdriver_gcs_bucket_storage_googleapis_com_network_sent_bytes_count{env=\"$environment\"}) * 1440","format":"time_series","interval":"1d","intervalFactor":3,"legendFormat":"egress {{ bucket_name }}","refId":"A"},{"expr":"sum by (bucket_name) (stackdriver_gcs_bucket_storage_googleapis_com_network_received_bytes_count{env=\"$environment\"}) * 1440 * -1","format":"time_series","interval":"1d","intervalFactor":3,"legendFormat":"ingress {{ bucket_name }}","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Object Storage by Bucket data transfer / 24h","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":"bytes","logBase":1,"max":null,"min":null,"show":true},{"format":"byte","label":null,"logBase":1,"max":null,"min":null,"show":false}]}],"refresh":"5m","rows":[],"schemaVersion":16,"style":"light","tags":["managed","general","general"],"templating":{"list":[{"current":{"text":"Global","value":"Global"},"hide":0,"label":null,"name":"PROMETHEUS_DS","options":[],"query":"prometheus","refresh":1,"regex":"/(.*-gprd|Frank|Global|gprd-.*)/","type":"datasource"},{"allValue":null,"current":{"text":"gprd","value":"gprd"},"datasource":"$PROMETHEUS_DS","hide":0,"includeAll":false,"label":null,"multi":false,"name":"environment","options":[],"query":"label_values(gitlab_service_ops:rate, environment)","refresh":1,"regex":"","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-30d","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"utc","title":"general: Network Ingress/Egress Overview","uid":"general-egress_ingress","version":775}}