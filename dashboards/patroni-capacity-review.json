{"meta":{"type":"db","canSave":false,"canEdit":true,"canAdmin":false,"canStar":true,"slug":"patroni-capacity-review","url":"/d/patroni-capacity-review/patroni-capacity-review","expires":"0001-01-01T00:00:00Z","created":"2021-06-07T08:54:16Z","updated":"2021-06-07T08:57:46Z","updatedBy":"ops-contact@gitlab.com","createdBy":"ops-contact@gitlab.com","version":2,"hasAcl":false,"isFolder":false,"folderId":976,"folderTitle":"Patroni Service","folderUrl":"/dashboards/f/patroni/patroni-service","provisioned":false,"provisionedExternalId":""},"dashboard":{"__inputs":[],"__requires":[],"annotations":{"list":[]},"description":"Uploaded by andrewn at Mon  7 Jun 2021 08:57:44 UTC","editable":false,"gnetId":null,"graphTooltip":1,"hideControls":false,"id":null,"links":[],"panels":[{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":2,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"cpu: Average Service CPU Utilization","titleSize":"h6","type":"row"},{"gridPos":{"h":4,"w":24,"x":0,"y":1},"id":3,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":0,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"light-red","value":null}]},"title":"Severity","unit":""},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"vector(1)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":""}],"title":"","type":"stat"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Timeseries","fill":0,"gridPos":{"h":12,"w":18,"x":0,"y":2},"id":1465724101,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-cpu","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max(\n      gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"cpu\"}\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"aggregated {{ component }}","refId":"A"},{"expr":"gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"cpu\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"95th quantile for week {{ component }}","refId":"B"},{"expr":"gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"cpu\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"99th quantile for week {{ component }}","refId":"C"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"cpu\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Soft SLO: {{ component }}","refId":"D"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"cpu\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Hard SLO: {{ component }}","refId":"E"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Average Service CPU Utilization","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"content":"This resource measures average CPU utilization across an all cores in a service fleet.\nIf it is becoming saturated, it may indicate that the fleet needs\nhorizontal or vertical scaling.\n","datasource":null,"gridPos":{"h":12,"w":6,"x":18,"y":2},"id":5,"mode":"markdown","title":"","type":"text"},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":100},"id":6,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"disk_inodes: Disk inode Utilization per Device per Node","titleSize":"h6","type":"row"},{"gridPos":{"h":4,"w":24,"x":0,"y":101},"id":7,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":0,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"light-red","value":null}]},"title":"Severity","unit":""},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"vector(1)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":""}],"title":"","type":"stat"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Timeseries","fill":0,"gridPos":{"h":12,"w":18,"x":0,"y":102},"id":39965907,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-disk_inodes","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max(\n      gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"disk_inodes\"}\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"aggregated {{ component }}","refId":"A"},{"expr":"gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"disk_inodes\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"95th quantile for week {{ component }}","refId":"B"},{"expr":"gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"disk_inodes\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"99th quantile for week {{ component }}","refId":"C"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"disk_inodes\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Soft SLO: {{ component }}","refId":"D"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"disk_inodes\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Hard SLO: {{ component }}","refId":"E"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Disk inode Utilization per Device per Node","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"content":"Disk inode utilization per device per node.\n\nIf this is too high, its possible that a directory is filling up with\nfiles. Consider logging in an checking temp directories for large numbers\nof files\n","datasource":null,"gridPos":{"h":12,"w":6,"x":18,"y":102},"id":9,"mode":"markdown","title":"","type":"text"},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":200},"id":10,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"disk_space: Disk Space Utilization per Device per Node","titleSize":"h6","type":"row"},{"gridPos":{"h":4,"w":24,"x":0,"y":201},"id":11,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":0,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"light-red","value":null}]},"title":"Severity","unit":""},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"vector(1)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":""}],"title":"","type":"stat"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Timeseries","fill":0,"gridPos":{"h":12,"w":18,"x":0,"y":202},"id":2661375984,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-disk_space","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max(\n      gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"disk_space\"}\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"aggregated {{ component }}","refId":"A"},{"expr":"gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"disk_space\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"95th quantile for week {{ component }}","refId":"B"},{"expr":"gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"disk_space\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"99th quantile for week {{ component }}","refId":"C"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"disk_space\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Soft SLO: {{ component }}","refId":"D"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"disk_space\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Hard SLO: {{ component }}","refId":"E"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Disk Space Utilization per Device per Node","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"content":"Disk space utilization per device per node.\n","datasource":null,"gridPos":{"h":12,"w":6,"x":18,"y":202},"id":13,"mode":"markdown","title":"","type":"text"},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":300},"id":14,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"disk_sustained_read_iops: Disk Sustained Read IOPS Utilization per Node","titleSize":"h6","type":"row"},{"gridPos":{"h":4,"w":24,"x":0,"y":301},"id":15,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":0,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"light-red","value":null}]},"title":"Severity","unit":""},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"vector(1)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":""}],"title":"","type":"stat"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Timeseries","fill":0,"gridPos":{"h":12,"w":18,"x":0,"y":302},"id":3942129027,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-disk_sustained_read_iops","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max(\n      gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"disk_sustained_read_iops\"}\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"aggregated {{ component }}","refId":"A"},{"expr":"gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"disk_sustained_read_iops\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"95th quantile for week {{ component }}","refId":"B"},{"expr":"gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"disk_sustained_read_iops\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"99th quantile for week {{ component }}","refId":"C"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"disk_sustained_read_iops\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Soft SLO: {{ component }}","refId":"D"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"disk_sustained_read_iops\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Hard SLO: {{ component }}","refId":"E"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Disk Sustained Read IOPS Utilization per Node","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"content":"Disk sustained read IOPS utilization per node.\n","datasource":null,"gridPos":{"h":12,"w":6,"x":18,"y":302},"id":17,"mode":"markdown","title":"","type":"text"},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":400},"id":18,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"disk_sustained_read_throughput: Disk Sustained Read Throughput Utilization per Node","titleSize":"h6","type":"row"},{"gridPos":{"h":4,"w":24,"x":0,"y":401},"id":19,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":0,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"light-red","value":null}]},"title":"Severity","unit":""},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"vector(1)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":""}],"title":"","type":"stat"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Timeseries","fill":0,"gridPos":{"h":12,"w":18,"x":0,"y":402},"id":3120931940,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-disk_sustained_read_throughput","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max(\n      gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"disk_sustained_read_throughput\"}\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"aggregated {{ component }}","refId":"A"},{"expr":"gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"disk_sustained_read_throughput\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"95th quantile for week {{ component }}","refId":"B"},{"expr":"gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"disk_sustained_read_throughput\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"99th quantile for week {{ component }}","refId":"C"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"disk_sustained_read_throughput\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Soft SLO: {{ component }}","refId":"D"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"disk_sustained_read_throughput\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Hard SLO: {{ component }}","refId":"E"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Disk Sustained Read Throughput Utilization per Node","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"content":"Disk sustained read throughput utilization per node.\n","datasource":null,"gridPos":{"h":12,"w":6,"x":18,"y":402},"id":21,"mode":"markdown","title":"","type":"text"},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":500},"id":22,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"disk_sustained_write_iops: Disk Sustained Write IOPS Utilization per Node","titleSize":"h6","type":"row"},{"gridPos":{"h":4,"w":24,"x":0,"y":501},"id":23,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":0,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"light-red","value":null}]},"title":"Severity","unit":""},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"vector(1)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":""}],"title":"","type":"stat"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Timeseries","fill":0,"gridPos":{"h":12,"w":18,"x":0,"y":502},"id":1520756669,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-disk_sustained_write_iops","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max(\n      gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"disk_sustained_write_iops\"}\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"aggregated {{ component }}","refId":"A"},{"expr":"gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"disk_sustained_write_iops\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"95th quantile for week {{ component }}","refId":"B"},{"expr":"gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"disk_sustained_write_iops\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"99th quantile for week {{ component }}","refId":"C"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"disk_sustained_write_iops\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Soft SLO: {{ component }}","refId":"D"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"disk_sustained_write_iops\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Hard SLO: {{ component }}","refId":"E"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Disk Sustained Write IOPS Utilization per Node","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"content":"Gitaly runs on Google Cloud's Persistent Disk product. This has a published sustained\nmaximum write IOPS value. This value can be exceeded for brief periods.\n\nIf a single node is consistently reaching saturation, it may indicate a noisy-neighbour repository,\npossible abuse or it may indicate that the node needs rebalancing.\n\nMore information can be found at\nhttps://cloud.google.com/compute/docs/disks/performance.\n","datasource":null,"gridPos":{"h":12,"w":6,"x":18,"y":502},"id":25,"mode":"markdown","title":"","type":"text"},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":600},"id":26,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"disk_sustained_write_throughput: Disk Sustained Write Throughput Utilization per Node","titleSize":"h6","type":"row"},{"gridPos":{"h":4,"w":24,"x":0,"y":601},"id":27,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":0,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"light-red","value":null}]},"title":"Severity","unit":""},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"vector(1)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":""}],"title":"","type":"stat"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Timeseries","fill":0,"gridPos":{"h":12,"w":18,"x":0,"y":602},"id":374696527,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-disk_sustained_write_throughput","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max(\n      gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"disk_sustained_write_throughput\"}\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"aggregated {{ component }}","refId":"A"},{"expr":"gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"disk_sustained_write_throughput\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"95th quantile for week {{ component }}","refId":"B"},{"expr":"gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"disk_sustained_write_throughput\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"99th quantile for week {{ component }}","refId":"C"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"disk_sustained_write_throughput\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Soft SLO: {{ component }}","refId":"D"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"disk_sustained_write_throughput\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Hard SLO: {{ component }}","refId":"E"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Disk Sustained Write Throughput Utilization per Node","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"content":"Gitaly runs on Google Cloud's Persistent Disk product. This has a published sustained\nmaximum write throughput value. This value can be exceeded for brief periods.\n\nIf a single node is consistently reaching saturation, it may indicate a noisy-neighbour repository,\npossible abuse or it may indicate that the node needs rebalancing.\n\nMore information can be found at\nhttps://cloud.google.com/compute/docs/disks/performance.\n","datasource":null,"gridPos":{"h":12,"w":6,"x":18,"y":602},"id":29,"mode":"markdown","title":"","type":"text"},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":700},"id":30,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"memory: Memory Utilization per Node","titleSize":"h6","type":"row"},{"gridPos":{"h":4,"w":24,"x":0,"y":701},"id":31,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":0,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"light-red","value":null}]},"title":"Severity","unit":""},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"vector(1)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":""}],"title":"","type":"stat"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Timeseries","fill":0,"gridPos":{"h":12,"w":18,"x":0,"y":702},"id":1955556769,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-memory","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max(\n      gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"memory\"}\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"aggregated {{ component }}","refId":"A"},{"expr":"gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"memory\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"95th quantile for week {{ component }}","refId":"B"},{"expr":"gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"memory\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"99th quantile for week {{ component }}","refId":"C"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"memory\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Soft SLO: {{ component }}","refId":"D"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"memory\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Hard SLO: {{ component }}","refId":"E"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Memory Utilization per Node","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"content":"Memory utilization per device per node.\n","datasource":null,"gridPos":{"h":12,"w":6,"x":18,"y":702},"id":33,"mode":"markdown","title":"","type":"text"},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":800},"id":34,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"nf_conntrack_entries: conntrack Entries per Node","titleSize":"h6","type":"row"},{"gridPos":{"h":4,"w":24,"x":0,"y":801},"id":35,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":0,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"light-red","value":null}]},"title":"Severity","unit":""},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"vector(1)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":""}],"title":"","type":"stat"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Timeseries","fill":0,"gridPos":{"h":12,"w":18,"x":0,"y":802},"id":503581002,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-nf_conntrack_entries","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max(\n      gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"nf_conntrack_entries\"}\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"aggregated {{ component }}","refId":"A"},{"expr":"gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"nf_conntrack_entries\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"95th quantile for week {{ component }}","refId":"B"},{"expr":"gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"nf_conntrack_entries\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"99th quantile for week {{ component }}","refId":"C"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"nf_conntrack_entries\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Soft SLO: {{ component }}","refId":"D"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"nf_conntrack_entries\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Hard SLO: {{ component }}","refId":"E"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"conntrack Entries per Node","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"content":"Netfilter connection tracking table utilization per node.\n\nWhen saturated, new connection attempts (incoming SYN packets) are dropped with no reply, leaving clients to slowly retry (and typically fail again) over the next several seconds.  When packets are being dropped due to this condition, kernel will log the event as: \"nf_conntrack: table full, dropping packet\".\n","datasource":null,"gridPos":{"h":12,"w":6,"x":18,"y":802},"id":37,"mode":"markdown","title":"","type":"text"},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":900},"id":38,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"node_schedstat_waiting: Node Scheduler Waiting Time","titleSize":"h6","type":"row"},{"gridPos":{"h":4,"w":24,"x":0,"y":901},"id":39,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":0,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"light-red","value":null}]},"title":"Severity","unit":""},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"vector(1)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":""}],"title":"","type":"stat"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Timeseries","fill":0,"gridPos":{"h":12,"w":18,"x":0,"y":902},"id":1415313189,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-node_schedstat_waiting","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max(\n      gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"node_schedstat_waiting\"}\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"aggregated {{ component }}","refId":"A"},{"expr":"gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"node_schedstat_waiting\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"95th quantile for week {{ component }}","refId":"B"},{"expr":"gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"node_schedstat_waiting\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"99th quantile for week {{ component }}","refId":"C"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"node_schedstat_waiting\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Soft SLO: {{ component }}","refId":"D"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"node_schedstat_waiting\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Hard SLO: {{ component }}","refId":"E"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Node Scheduler Waiting Time","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"content":"Measures the amount of scheduler waiting time that processes are waiting\nto be scheduled, according to [`CPU Scheduling Metrics`](https://www.robustperception.io/cpu-scheduling-metrics-from-the-node-exporter).\n\nA high value indicates that a node has more processes to be run than CPU time available\nto handle them, and may lead to degraded responsiveness and performance from the application.\n\nAdditionally, it may indicate that the fleet is under-provisioned.\n","datasource":null,"gridPos":{"h":12,"w":6,"x":18,"y":902},"id":41,"mode":"markdown","title":"","type":"text"},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":1000},"id":42,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"open_fds: Open file descriptor utilization per instance","titleSize":"h6","type":"row"},{"gridPos":{"h":4,"w":24,"x":0,"y":1001},"id":43,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":0,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"light-red","value":null}]},"title":"Severity","unit":""},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"vector(1)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":""}],"title":"","type":"stat"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Timeseries","fill":0,"gridPos":{"h":12,"w":18,"x":0,"y":1002},"id":1001792825,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-open_fds","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max(\n      gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"open_fds\"}\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"aggregated {{ component }}","refId":"A"},{"expr":"gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"open_fds\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"95th quantile for week {{ component }}","refId":"B"},{"expr":"gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"open_fds\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"99th quantile for week {{ component }}","refId":"C"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"open_fds\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Soft SLO: {{ component }}","refId":"D"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"open_fds\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Hard SLO: {{ component }}","refId":"E"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Open file descriptor utilization per instance","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"content":"Open file descriptor utilization per instance.\n\nSaturation on file descriptor limits may indicate a resource-descriptor leak in the application.\n\nAs a temporary fix, you may want to consider restarting the affected process.\n","datasource":null,"gridPos":{"h":12,"w":6,"x":18,"y":1002},"id":45,"mode":"markdown","title":"","type":"text"},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":1100},"id":46,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"pg_active_db_connections_primary: Active Primary DB Connection Utilization","titleSize":"h6","type":"row"},{"gridPos":{"h":4,"w":24,"x":0,"y":1101},"id":47,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":0,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"light-red","value":null}]},"title":"Severity","unit":""},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"vector(1)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":""}],"title":"","type":"stat"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Timeseries","fill":0,"gridPos":{"h":12,"w":18,"x":0,"y":1102},"id":1954311497,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-pg_active_db_connections_primary","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max(\n      gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pg_active_db_connections_primary\"}\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"aggregated {{ component }}","refId":"A"},{"expr":"gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pg_active_db_connections_primary\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"95th quantile for week {{ component }}","refId":"B"},{"expr":"gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pg_active_db_connections_primary\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"99th quantile for week {{ component }}","refId":"C"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"pg_active_db_connections_primary\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Soft SLO: {{ component }}","refId":"D"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"pg_active_db_connections_primary\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Hard SLO: {{ component }}","refId":"E"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Active Primary DB Connection Utilization","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"content":"Active db connection utilization on the primary node.\n\nPostgres is configured to use a maximum number of connections.\nWhen this resource is saturated, connections may queue.\n","datasource":null,"gridPos":{"h":12,"w":6,"x":18,"y":1102},"id":49,"mode":"markdown","title":"","type":"text"},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":1200},"id":50,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"pg_active_db_connections_replica: Active Secondary DB Connection Utilization","titleSize":"h6","type":"row"},{"gridPos":{"h":4,"w":24,"x":0,"y":1201},"id":51,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":0,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"light-red","value":null}]},"title":"Severity","unit":""},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"vector(1)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":""}],"title":"","type":"stat"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Timeseries","fill":0,"gridPos":{"h":12,"w":18,"x":0,"y":1202},"id":3266646533,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-pg_active_db_connections_replica","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max(\n      gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pg_active_db_connections_replica\"}\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"aggregated {{ component }}","refId":"A"},{"expr":"gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pg_active_db_connections_replica\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"95th quantile for week {{ component }}","refId":"B"},{"expr":"gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pg_active_db_connections_replica\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"99th quantile for week {{ component }}","refId":"C"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"pg_active_db_connections_replica\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Soft SLO: {{ component }}","refId":"D"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"pg_active_db_connections_replica\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Hard SLO: {{ component }}","refId":"E"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Active Secondary DB Connection Utilization","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"content":"Active db connection utilization per replica node\n\nPostgres is configured to use a maximum number of connections.\nWhen this resource is saturated, connections may queue.\n","datasource":null,"gridPos":{"h":12,"w":6,"x":18,"y":1202},"id":53,"mode":"markdown","title":"","type":"text"},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":1300},"id":54,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"pg_btree_bloat: Postgres btree bloat","titleSize":"h6","type":"row"},{"gridPos":{"h":4,"w":24,"x":0,"y":1301},"id":55,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":0,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"light-red","value":null}]},"title":"Severity","unit":""},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"vector(1)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":""}],"title":"","type":"stat"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Timeseries","fill":0,"gridPos":{"h":12,"w":18,"x":0,"y":1302},"id":2387842464,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-pg_btree_bloat","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max(\n      gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pg_btree_bloat\"}\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"aggregated {{ component }}","refId":"A"},{"expr":"gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pg_btree_bloat\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"95th quantile for week {{ component }}","refId":"B"},{"expr":"gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pg_btree_bloat\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"99th quantile for week {{ component }}","refId":"C"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"pg_btree_bloat\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Soft SLO: {{ component }}","refId":"D"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"pg_btree_bloat\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Hard SLO: {{ component }}","refId":"E"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Postgres btree bloat","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"content":"This measures the total bloat in Postgres Btree indexes, as a percentage of total index size.\n\nThe larger this measure, the more pages will unnecessarily be retrieved during index scans.\n","datasource":null,"gridPos":{"h":12,"w":6,"x":18,"y":1302},"id":57,"mode":"markdown","title":"","type":"text"},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":1400},"id":58,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"pg_int4_id: Postgres int4 ID capacity","titleSize":"h6","type":"row"},{"gridPos":{"h":4,"w":24,"x":0,"y":1401},"id":59,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":0,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"light-red","value":null}]},"title":"Severity","unit":""},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"vector(1)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":""}],"title":"","type":"stat"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Timeseries","fill":0,"gridPos":{"h":12,"w":18,"x":0,"y":1402},"id":3254820333,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-pg_int4_id","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max(\n      gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pg_int4_id\"}\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"aggregated {{ component }}","refId":"A"},{"expr":"gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pg_int4_id\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"95th quantile for week {{ component }}","refId":"B"},{"expr":"gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pg_int4_id\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"99th quantile for week {{ component }}","refId":"C"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"pg_int4_id\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Soft SLO: {{ component }}","refId":"D"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"pg_int4_id\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Hard SLO: {{ component }}","refId":"E"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Postgres int4 ID capacity","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"content":"This measures used int4 primary key capacity in selected postgres tables. It is critically important that we do not reach\nsaturation on this as GitLab will stop to work at this point.\n","datasource":null,"gridPos":{"h":12,"w":6,"x":18,"y":1402},"id":61,"mode":"markdown","title":"","type":"text"},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":1500},"id":62,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"pg_table_bloat: Postgres Table Bloat","titleSize":"h6","type":"row"},{"gridPos":{"h":4,"w":24,"x":0,"y":1501},"id":63,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":0,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"light-red","value":null}]},"title":"Severity","unit":""},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"vector(1)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":""}],"title":"","type":"stat"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Timeseries","fill":0,"gridPos":{"h":12,"w":18,"x":0,"y":1502},"id":773890326,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-pg_table_bloat","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max(\n      gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pg_table_bloat\"}\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"aggregated {{ component }}","refId":"A"},{"expr":"gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pg_table_bloat\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"95th quantile for week {{ component }}","refId":"B"},{"expr":"gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pg_table_bloat\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"99th quantile for week {{ component }}","refId":"C"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"pg_table_bloat\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Soft SLO: {{ component }}","refId":"D"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"pg_table_bloat\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Hard SLO: {{ component }}","refId":"E"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Postgres Table Bloat","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"content":"This measures the total bloat in Postgres Table pages, as a percentage of total size. This includes bloat in TOAST tables,\nand excludes extra space reserved due to fillfactor.\n","datasource":null,"gridPos":{"h":12,"w":6,"x":18,"y":1502},"id":65,"mode":"markdown","title":"","type":"text"},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":1600},"id":66,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"pg_vacuum_activity: Postgres Autovacuum Activity","titleSize":"h6","type":"row"},{"gridPos":{"h":4,"w":24,"x":0,"y":1601},"id":67,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":0,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"light-red","value":null}]},"title":"Severity","unit":""},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"vector(1)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":""}],"title":"","type":"stat"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Timeseries","fill":0,"gridPos":{"h":12,"w":18,"x":0,"y":1602},"id":1494397745,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-pg_vacuum_activity","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max(\n      gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pg_vacuum_activity\"}\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"aggregated {{ component }}","refId":"A"},{"expr":"gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pg_vacuum_activity\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"95th quantile for week {{ component }}","refId":"B"},{"expr":"gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pg_vacuum_activity\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"99th quantile for week {{ component }}","refId":"C"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"pg_vacuum_activity\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Soft SLO: {{ component }}","refId":"D"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"pg_vacuum_activity\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Hard SLO: {{ component }}","refId":"E"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Postgres Autovacuum Activity","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"content":"Measures the number of active autovacuum workers, as a percentage of the maximum, configured\nvia the `autovacuum_max_workers` setting.\n\nIf this is saturated for a sustained period, it may indicate that postgres is struggling to keep\nup with vacuum activity.\n\nThis could ultimately lead to a transaction ID wraparound situation: see\nhttps://gitlab.com/gitlab-com/runbooks/-/blob/master/docs/patroni/pg_xid_wraparound_alert.md\n","datasource":null,"gridPos":{"h":12,"w":6,"x":18,"y":1602},"id":69,"mode":"markdown","title":"","type":"text"},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":1700},"id":70,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"pg_walsender_cpu: Walsender CPU Saturation","titleSize":"h6","type":"row"},{"gridPos":{"h":4,"w":24,"x":0,"y":1701},"id":71,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":0,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"light-red","value":null}]},"title":"Severity","unit":""},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"vector(1)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":""}],"title":"","type":"stat"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Timeseries","fill":0,"gridPos":{"h":12,"w":18,"x":0,"y":1702},"id":1879384722,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-pg_walsender_cpu","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max(\n      gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pg_walsender_cpu\"}\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"aggregated {{ component }}","refId":"A"},{"expr":"gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pg_walsender_cpu\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"95th quantile for week {{ component }}","refId":"B"},{"expr":"gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pg_walsender_cpu\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"99th quantile for week {{ component }}","refId":"C"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"pg_walsender_cpu\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Soft SLO: {{ component }}","refId":"D"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"pg_walsender_cpu\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Hard SLO: {{ component }}","refId":"E"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Walsender CPU Saturation","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"content":"This saturation metric measures the total amount of time that the primary postgres instance is spending sending WAL segments\nto replicas. It is expressed as a percentage of all CPU available on the primary postgres instance.\n\nThe more replicas connected, the higher this metric will be.\n\nSince it's expressed as a percentage of all CPU, this should always remain low, since the CPU primarily needs to be available for\nhandling SQL statements.\n","datasource":null,"gridPos":{"h":12,"w":6,"x":18,"y":1702},"id":73,"mode":"markdown","title":"","type":"text"},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":1800},"id":74,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"pg_xid_wraparound: Transaction ID Wraparound","titleSize":"h6","type":"row"},{"gridPos":{"h":4,"w":24,"x":0,"y":1801},"id":75,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":0,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"light-red","value":null}]},"title":"Severity","unit":""},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"vector(1)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":""}],"title":"","type":"stat"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Timeseries","fill":0,"gridPos":{"h":12,"w":18,"x":0,"y":1802},"id":3666116359,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-pg_xid_wraparound","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max(\n      gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pg_xid_wraparound\"}\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"aggregated {{ component }}","refId":"A"},{"expr":"gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pg_xid_wraparound\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"95th quantile for week {{ component }}","refId":"B"},{"expr":"gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pg_xid_wraparound\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"99th quantile for week {{ component }}","refId":"C"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"pg_xid_wraparound\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Soft SLO: {{ component }}","refId":"D"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"pg_xid_wraparound\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Hard SLO: {{ component }}","refId":"E"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Transaction ID Wraparound","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"content":"Risk of DB shutdown in the near future, approaching transaction ID wraparound.\n\nThis is a critical situation.\n\nThis saturation metric measures how close the database is to Transaction ID wraparound.\n\nWhen wraparound occurs, the database will automatically shutdown to prevent data loss, causing a full outage.\n\nRecovery would require entering single-user mode to run vacuum, taking the site down for a potentially multi-hour maintenance session.\n\nTo avoid reaching the db shutdown threshold, consider the following short-term actions:\n\n1. Escalate to the SRE Datastores team, and then,\n\n2. Find and terminate any very old transactions. The runbook for this alert has details.  Do this first.  It is the most critical step and may be all that is necessary to let autovacuum do its job.\n\n3. Run a manual vacuum on tables with oldest relfrozenxid.  Manual vacuums run faster than autovacuum.\n\n4. Add autovacuum workers or reduce autovacuum cost delay, if autovacuum is chronically unable to keep up with the transaction rate.\n\nLong running transaction dashboard: https://dashboards.gitlab.net/d/alerts-long_running_transactions/alerts-long-running-transactions?orgId=1\n","datasource":null,"gridPos":{"h":12,"w":6,"x":18,"y":1802},"id":77,"mode":"markdown","title":"","type":"text"},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":1900},"id":78,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"pgbouncer_async_replica_pool: Postgres Async (Sidekiq) replica Connection Pool Utilization per Node","titleSize":"h6","type":"row"},{"gridPos":{"h":4,"w":24,"x":0,"y":1901},"id":79,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":0,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"light-red","value":null}]},"title":"Severity","unit":""},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"vector(1)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":""}],"title":"","type":"stat"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Timeseries","fill":0,"gridPos":{"h":12,"w":18,"x":0,"y":1902},"id":4069682945,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-pgbouncer_async_replica_pool","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max(\n      gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pgbouncer_async_replica_pool\"}\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"aggregated {{ component }}","refId":"A"},{"expr":"gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pgbouncer_async_replica_pool\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"95th quantile for week {{ component }}","refId":"B"},{"expr":"gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pgbouncer_async_replica_pool\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"99th quantile for week {{ component }}","refId":"C"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"pgbouncer_async_replica_pool\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Soft SLO: {{ component }}","refId":"D"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"pgbouncer_async_replica_pool\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Hard SLO: {{ component }}","refId":"E"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Postgres Async (Sidekiq) replica Connection Pool Utilization per Node","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"content":"pgbouncer async connection pool utilization per database node, for replica database connections.\n\nSidekiq maintains it's own pgbouncer connection pool. When this resource is saturated,\ndatabase operations may queue, leading to additional latency in background processing.\n","datasource":null,"gridPos":{"h":12,"w":6,"x":18,"y":1902},"id":81,"mode":"markdown","title":"","type":"text"},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":2000},"id":82,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"pgbouncer_client_conn: PGBouncer Client Connections per Process","titleSize":"h6","type":"row"},{"gridPos":{"h":4,"w":24,"x":0,"y":2001},"id":83,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":0,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"light-red","value":null}]},"title":"Severity","unit":""},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"vector(1)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":""}],"title":"","type":"stat"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Timeseries","fill":0,"gridPos":{"h":12,"w":18,"x":0,"y":2002},"id":1258049746,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-pgbouncer_client_conn","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max(\n      gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pgbouncer_client_conn\"}\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"aggregated {{ component }}","refId":"A"},{"expr":"gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pgbouncer_client_conn\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"95th quantile for week {{ component }}","refId":"B"},{"expr":"gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pgbouncer_client_conn\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"99th quantile for week {{ component }}","refId":"C"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"pgbouncer_client_conn\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Soft SLO: {{ component }}","refId":"D"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"pgbouncer_client_conn\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Hard SLO: {{ component }}","refId":"E"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"PGBouncer Client Connections per Process","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"content":"Client connections per pgbouncer process.\n\npgbouncer is configured to use a `max_client_conn` setting. This limits the total number of client connections per pgbouncer.\n\nWhen this limit is reached, client connections may be refused, and `max_client_conn` errors may appear in the pgbouncer logs.\n\nThis could affect users as Rails clients are left unable to connect to the database. Another potential knock-on effect\nis that Rails clients could fail their readiness checks for extended periods during a deployment, leading to saturation of\nthe older nodes.\n","datasource":null,"gridPos":{"h":12,"w":6,"x":18,"y":2002},"id":85,"mode":"markdown","title":"","type":"text"},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":2100},"id":86,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"pgbouncer_single_core: PGBouncer Single Core per Node","titleSize":"h6","type":"row"},{"gridPos":{"h":4,"w":24,"x":0,"y":2101},"id":87,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":0,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"light-red","value":null}]},"title":"Severity","unit":""},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"vector(1)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":""}],"title":"","type":"stat"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Timeseries","fill":0,"gridPos":{"h":12,"w":18,"x":0,"y":2102},"id":1214397558,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-pgbouncer_single_core","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max(\n      gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pgbouncer_single_core\"}\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"aggregated {{ component }}","refId":"A"},{"expr":"gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pgbouncer_single_core\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"95th quantile for week {{ component }}","refId":"B"},{"expr":"gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pgbouncer_single_core\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"99th quantile for week {{ component }}","refId":"C"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"pgbouncer_single_core\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Soft SLO: {{ component }}","refId":"D"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"pgbouncer_single_core\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Hard SLO: {{ component }}","refId":"E"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"PGBouncer Single Core per Node","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"content":"PGBouncer single core CPU utilization per node.\n\nPGBouncer is a single threaded application. Under high volumes this resource may become saturated,\nand additional pgbouncer nodes may need to be provisioned.\n","datasource":null,"gridPos":{"h":12,"w":6,"x":18,"y":2102},"id":89,"mode":"markdown","title":"","type":"text"},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":2200},"id":90,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"pgbouncer_sync_replica_pool: Postgres Sync (Web/API/Git) replica Connection Pool Utilization per Node","titleSize":"h6","type":"row"},{"gridPos":{"h":4,"w":24,"x":0,"y":2201},"id":91,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":0,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"light-red","value":null}]},"title":"Severity","unit":""},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"vector(1)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":""}],"title":"","type":"stat"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Timeseries","fill":0,"gridPos":{"h":12,"w":18,"x":0,"y":2202},"id":2061891964,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-pgbouncer_sync_replica_pool","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max(\n      gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pgbouncer_sync_replica_pool\"}\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"aggregated {{ component }}","refId":"A"},{"expr":"gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pgbouncer_sync_replica_pool\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"95th quantile for week {{ component }}","refId":"B"},{"expr":"gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"pgbouncer_sync_replica_pool\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"99th quantile for week {{ component }}","refId":"C"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"pgbouncer_sync_replica_pool\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Soft SLO: {{ component }}","refId":"D"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"pgbouncer_sync_replica_pool\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Hard SLO: {{ component }}","refId":"E"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Postgres Sync (Web/API/Git) replica Connection Pool Utilization per Node","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"content":"pgbouncer sync connection pool Saturation per database node, for replica database connections.\n\nWeb/api/git applications use a separate connection pool to sidekiq.\n\nWhen this resource is saturated, web/api database operations may queue, leading to rails worker\nsaturation and 503 errors in the web.\n","datasource":null,"gridPos":{"h":12,"w":6,"x":18,"y":2202},"id":93,"mode":"markdown","title":"","type":"text"},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":2300},"id":94,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"shard_cpu: Average CPU Utilization per Shard","titleSize":"h6","type":"row"},{"gridPos":{"h":4,"w":24,"x":0,"y":2301},"id":95,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":0,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"light-red","value":null}]},"title":"Severity","unit":""},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"vector(1)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":""}],"title":"","type":"stat"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Timeseries","fill":0,"gridPos":{"h":12,"w":18,"x":0,"y":2302},"id":1472933476,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-shard_cpu","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max(\n      gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"shard_cpu\"}\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"aggregated {{ component }}","refId":"A"},{"expr":"gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"shard_cpu\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"95th quantile for week {{ component }}","refId":"B"},{"expr":"gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"shard_cpu\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"99th quantile for week {{ component }}","refId":"C"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"shard_cpu\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Soft SLO: {{ component }}","refId":"D"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"shard_cpu\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Hard SLO: {{ component }}","refId":"E"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Average CPU Utilization per Shard","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"content":"This resource measures average CPU utilization across an all cores in a shard of a\nservice fleet. If it is becoming saturated, it may indicate that the\nshard needs horizontal or vertical scaling.\n","datasource":null,"gridPos":{"h":12,"w":6,"x":18,"y":2302},"id":97,"mode":"markdown","title":"","type":"text"},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":2400},"id":98,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"single_node_cpu: Average CPU Utilization per Node","titleSize":"h6","type":"row"},{"gridPos":{"h":4,"w":24,"x":0,"y":2401},"id":99,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":0,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"light-red","value":null}]},"title":"Severity","unit":""},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"vector(1)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":""}],"title":"","type":"stat"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Timeseries","fill":0,"gridPos":{"h":12,"w":18,"x":0,"y":2402},"id":3372411356,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-single_node_cpu","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max(\n      gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"single_node_cpu\"}\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"aggregated {{ component }}","refId":"A"},{"expr":"gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"single_node_cpu\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"95th quantile for week {{ component }}","refId":"B"},{"expr":"gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"patroni\", component=\"single_node_cpu\"}\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"99th quantile for week {{ component }}","refId":"C"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"single_node_cpu\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Soft SLO: {{ component }}","refId":"D"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"single_node_cpu\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Hard SLO: {{ component }}","refId":"E"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Average CPU Utilization per Node","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"content":"Average CPU utilization per Node.\n\nIf average CPU is satured, it may indicate that a fleet is in need to horizontal or vertical scaling. It may also indicate\nimbalances in load in a fleet.\n","datasource":null,"gridPos":{"h":12,"w":6,"x":18,"y":2402},"id":101,"mode":"markdown","title":"","type":"text"},{"content":"Made with ❤️ and [Grafonnet](https://github.com/grafana/grafonnet-lib). [Contribute to this dashboard on GitLab.com](https://gitlab.com/gitlab-com/runbooks/blob/master/dashboards/patroni/aux.shared.jsonnet)\n","datasource":null,"gridPos":{"h":2,"w":24,"x":0,"y":110000},"id":102,"mode":"markdown","title":"Source","type":"text"}],"refresh":"","rows":[],"schemaVersion":16,"style":"light","tags":["managed","patroni","patroni","type:patroni","capacity-review"],"templating":{"list":[{"current":{"text":"Global","value":"Global"},"hide":0,"label":null,"name":"PROMETHEUS_DS","options":[],"query":"prometheus","refresh":1,"regex":"/(.*-gprd|Frank|Global|gprd-.*)/","type":"datasource"},{"allValue":null,"current":{"text":"gprd","value":"gprd"},"datasource":"$PROMETHEUS_DS","hide":0,"includeAll":false,"label":null,"multi":false,"name":"environment","options":[],"query":"label_values(gitlab_service_ops:rate, environment)","refresh":1,"regex":"","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-29d/d","to":"now-1d/d"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"utc","title":"patroni: Capacity Review","uid":"patroni-capacity-review","version":2}}