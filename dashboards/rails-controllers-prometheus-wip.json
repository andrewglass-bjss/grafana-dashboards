{"meta":{"type":"db","canSave":true,"canEdit":true,"canStar":true,"slug":"rails-controllers-prometheus-wip","expires":"0001-01-01T00:00:00Z","created":"2018-06-22T15:26:18Z","updated":"2018-06-23T15:09:39Z","updatedBy":"ops-contact@gitlab.com","createdBy":"ops-contact@gitlab.com","version":5},"dashboard":{"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations \u0026 Alerts","type":"dashboard"},{"datasource":"$database","enable":true,"iconColor":"rgb(255, 255, 255)","name":"Deployments","query":"SELECT version FROM forever.deployments"}]},"editable":true,"gnetId":null,"graphTooltip":0,"hideControls":false,"id":null,"links":[],"refresh":false,"rows":[{"collapse":false,"height":"","panels":[{"cacheTimeout":null,"colorBackground":false,"colorValue":true,"colors":["rgba(50, 172, 45, 0.97)","rgba(237, 129, 40, 0.89)","rgba(245, 54, 54, 0.9)"],"datasource":"Prometheus on prometheus-app-01","editable":true,"error":false,"format":"s","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"height":"100px","id":4,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"span":2,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"alias":"$col","dsType":"influxdb","expr":"controller_action:gitlab_transaction_duration_seconds:p95{action=\"$action\",controller=\"$controller\",environment=\"$environment\"}","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"","orderByTime":"ASC","policy":"default","query":"SELECT percentile(\"duration\", 95) FROM rails_transactions WHERE $timeFilter AND \"action\" =~ /^[[action]]$/","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":"1,5","title":"Response Time","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"avg"},{"cacheTimeout":null,"colorBackground":false,"colorValue":true,"colors":["rgba(50, 172, 45, 0.97)","rgba(237, 129, 40, 0.89)","rgba(245, 54, 54, 0.9)"],"datasource":"Prometheus on prometheus-app-01","editable":true,"error":false,"format":"s","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"height":"100px","id":7,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"span":2,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"alias":"$col","dsType":"influxdb","expr":"controller_action:gitlab_sql_duration_seconds:p95{action=\"$action\",controller=\"$controller\",environment=\"$environment\"}","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"","policy":"default","query":"SELECT percentile(\"sql_duration\", 95) FROM rails_transactions WHERE $timeFilter AND \"action\" =~ /^[[action]]$/","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":"1,5","title":"SQL Time","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"avg"},{"cacheTimeout":null,"colorBackground":false,"colorValue":true,"colors":["rgba(50, 172, 45, 0.97)","rgba(237, 129, 40, 0.89)","rgba(245, 54, 54, 0.9)"],"datasource":"Prometheus on prometheus-app-01","editable":true,"error":false,"format":"s","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"height":"100px","id":19,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"span":2,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"alias":"$col","dsType":"influxdb","expr":"controller_action:gitaly_duration_seconds:p95{action=\"$action\",controller=\"$controller\",environment=\"$environment\"}","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"","policy":"default","query":"SELECT percentile(\"duration\", 95) AS \"95th Percentile\" FROM rails_method_calls WHERE $timeFilter AND \"action\" =~ /^[[action]]$/ AND method =~ /^(Gitlab::Git|Rugged)/","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":"0.5,5","title":"Gitaly Time","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"avg"},{"cacheTimeout":null,"colorBackground":false,"colorValue":true,"colors":["rgba(50, 172, 45, 0.97)","rgba(237, 129, 40, 0.89)","rgba(245, 54, 54, 0.9)"],"datasource":"$database","editable":true,"error":false,"format":"ms","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"height":"100px","id":8,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"span":2,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"alias":"$col","dsType":"influxdb","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"policy":"default","query":"SELECT percentile(\"view_duration\", 95) FROM rails_transactions WHERE $timeFilter AND \"action\" =~ /^[[action]]$/","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":"1000,5000","title":"View Time","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"avg"},{"cacheTimeout":null,"colorBackground":false,"colorValue":true,"colors":["rgba(50, 172, 45, 0.97)","rgba(237, 129, 40, 0.89)","rgba(245, 54, 54, 0.9)"],"datasource":"$database","editable":true,"error":false,"format":"ms","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"height":"100px","id":14,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"span":2,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"alias":"$col","dsType":"influxdb","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"policy":"default","query":"SELECT percentile(\"cache_duration\", 95) FROM rails_transactions WHERE $timeFilter AND \"action\" =~ /^[[action]]$/","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":"100,5000","title":"Cache Time","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"avg"},{"cacheTimeout":null,"colorBackground":false,"colorValue":true,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"datasource":"$database","editable":true,"error":false,"format":"percent","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"height":"100px","id":26,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"span":2,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"alias":"$col","dsType":"influxdb","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"policy":"default","query":"SELECT (sum(cache_read_hit_count) / (sum(cache_read_hit_count) + sum(cache_read_miss_count))) * 100 FROM rails_transactions WHERE $timeFilter AND \"action\" =~ /^[[action]]$/","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":"33,83","title":"Cache Hit Ratio","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"avg"}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Last Hour","titleSize":"h6"},{"collapse":false,"height":"250px","panels":[{"aliasColors":{"Amount":"#9AC48A"},"bars":false,"dashLength":10,"dashes":false,"datasource":"$database","editable":true,"error":false,"fill":0,"grid":{},"id":1,"interval":"1m","legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":false,"steppedLine":false,"targets":[{"alias":"$col","dsType":"influxdb","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"policy":"default","query":"SELECT \"count\" AS \"Amount\" FROM downsampled.rails_transaction_counts_per_action WHERE $timeFilter AND \"action\" =~ /^[[action]]$/","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Transactions","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","logBase":1,"max":null,"min":null,"show":true},{"format":"short","logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{"95th Percentile":"#9AC48A","99th Percentile":"#E24D42","Mean":"#6ED0E0"},"bars":false,"dashLength":10,"dashes":false,"datasource":"$database","editable":true,"error":false,"fill":0,"grid":{},"id":3,"interval":"1m","legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":false,"steppedLine":false,"targets":[{"alias":"$col","dsType":"influxdb","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"policy":"default","query":"SELECT \"duration_95th\" AS \"95th Percentile\", \"duration_99th\" AS \"99th Percentile\", \"duration_mean\" AS \"Mean\" FROM downsampled.rails_transaction_timings_per_action WHERE $timeFilter AND \"action\" =~ /^[[action]]$/","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Transaction Timings","tooltip":{"msResolution":true,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","logBase":1,"max":null,"min":null,"show":true},{"format":"short","logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{"95th Percentile":"#9AC48A","99th Percentile":"#E24D42"},"bars":false,"dashLength":10,"dashes":false,"datasource":"$database","editable":true,"error":false,"fill":0,"grid":{},"id":21,"interval":"1m","legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":false,"steppedLine":false,"targets":[{"alias":"$col","dsType":"influxdb","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"policy":"default","query":"SELECT \"rails_queue_duration_95th\" AS \"95th Percentile\", \"rails_queue_duration_99th\" AS \"99th Percentile\", \"rails_queue_duration_mean\" AS \"Mean\" FROM downsampled.rails_transaction_timings_per_action WHERE $timeFilter AND \"action\" =~ /^[[action]]$/","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"HTTP Queue Timings","tooltip":{"msResolution":true,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","logBase":1,"max":null,"min":null,"show":true},{"format":"short","logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{"95th Percentile":"#9AC48A","99th Percentile":"#E24D42"},"bars":false,"dashLength":10,"dashes":false,"datasource":"$database","editable":true,"error":false,"fill":0,"grid":{},"id":15,"interval":"1m","legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":false,"steppedLine":false,"targets":[{"alias":"$col","dsType":"influxdb","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"policy":"default","query":"SELECT \"cache_duration_95th\" AS \"95th Percentile\", \"cache_duration_99th\" AS \"99th Percentile\", \"cache_duration_mean\" AS \"Mean\" FROM downsampled.rails_transaction_timings_per_action WHERE $timeFilter AND \"action\" =~ /^[[action]]$/","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Cache Timings","tooltip":{"msResolution":true,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","logBase":1,"max":null,"min":null,"show":true},{"format":"short","logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{"95th Percentile":"#9AC48A","99th Percentile":"#E24D42"},"bars":false,"dashLength":10,"dashes":false,"datasource":"$database","editable":true,"error":false,"fill":0,"grid":{},"id":18,"interval":"1m","legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":false,"steppedLine":false,"targets":[{"alias":"$col","dsType":"influxdb","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"policy":"default","query":"SELECT \"duration_95th\" AS \"95th Percentile\", \"duration_99th\" AS \"99th Percentile\", \"duration_mean\" AS \"Mean\" FROM downsampled.rails_git_timings_per_action WHERE $timeFilter AND \"action\" =~ /^[[action]]$/","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Git Timings","tooltip":{"msResolution":true,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","logBase":1,"max":null,"min":null,"show":true},{"format":"short","logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"General","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{"95th Pecentile":"#9AC48A","95th Percentile":"#9AC48A","99th Percentile":"#E24D42","Maximum":"#EAB839","Mean":"#6ED0E0"},"bars":false,"dashLength":10,"dashes":false,"datasource":"$database","editable":true,"error":false,"fill":0,"grid":{},"id":5,"interval":"1m","legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":false,"steppedLine":false,"targets":[{"alias":"$col","dsType":"influxdb","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"policy":"default","query":"SELECT \"sql_duration_95th\" AS \"95th Percentile\", \"sql_duration_99th\" AS \"99th Percentile\", \"sql_duration_mean\" AS \"Mean\", \"sql_duration_max\" AS \"Maximum\" FROM downsampled.rails_transaction_timings_per_action WHERE $timeFilter AND \"action\" =~ /^[[action]]$/","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"SQL Timings","tooltip":{"msResolution":true,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","logBase":1,"max":null,"min":null,"show":true},{"format":"short","logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{"95th Percentile":"#9AC48A","99th Percentile":"#E24D42","Maximum":"#EAB839"},"bars":false,"dashLength":10,"dashes":false,"datasource":"$database","editable":true,"error":false,"fill":0,"grid":{},"id":20,"interval":"1m","legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"Maximum","yaxis":1}],"spaceLength":10,"span":6,"stack":false,"steppedLine":false,"targets":[{"alias":"$col","dsType":"influxdb","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"policy":"default","query":"SELECT \"sql_count_95th\" AS \"95th Percentile\", \"sql_count_99th\" AS \"99th Percentile\", \"sql_count_mean\" AS \"Mean\", \"sql_count_max\" AS \"Maximum\" FROM downsampled.rails_transaction_sql_counts_per_action WHERE $timeFilter AND \"action\" =~ /^[[action]]$/","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"SQL Query Counts","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","logBase":1,"max":null,"min":null,"show":true},{"format":"short","logBase":1,"max":null,"min":null,"show":true}]},{"cards":{"cardPadding":null,"cardRound":null},"color":{"cardColor":"rgb(122, 202, 250)","colorScale":"sqrt","colorScheme":"interpolateBlues","exponent":0.8,"mode":"opacity"},"dataFormat":"timeseries","datasource":"$database","description":"A heatmap of the 99th percentile of SQL timings","heatmap":{},"height":"400","highlightCards":true,"id":28,"interval":"1m","legend":{"show":false},"links":[],"span":12,"targets":[{"alias":"","dsType":"influxdb","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"measurement":"rails_transactions","orderByTime":"ASC","policy":"default","query":"SELECT percentile(\"sql_duration\", 99) AS \"99th Percentile\" FROM rails_transactions WHERE $timeFilter AND action = '[[action]]' GROUP BY time($interval)","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[{"key":"action","operator":"=","value":"select tag value"}]}],"title":"SQL Timings Heatmap","tooltip":{"show":true,"showHistogram":false},"type":"heatmap","xAxis":{"show":true},"xBucketNumber":null,"xBucketSize":"5m","yAxis":{"decimals":null,"format":"ms","logBase":2,"max":null,"min":"50","show":true,"splitFactor":2},"yBucketNumber":null,"yBucketSize":100}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"SQL","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{"95th Percentile":"#9AC48A","99th Percentile":"#E24D42","Maximum":"#EAB839"},"bars":false,"dashLength":10,"dashes":false,"datasource":"$database","editable":true,"error":false,"fill":0,"grid":{},"id":25,"interval":"1m","legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"Maximum","yaxis":1}],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"alias":"$col","dsType":"influxdb","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"policy":"default","query":"SELECT \"cache_read_hit_count_mean\" AS \"Hit mean\", \"cache_read_miss_count_mean\" AS \"Miss mean\" FROM downsampled.rails_transaction_cache_counts_per_action WHERE $timeFilter AND \"action\" =~ /^[[action]]$/","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Cache Read Hit/Miss Count","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"none","logBase":1,"max":null,"min":null,"show":true},{"format":"short","logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Redis","titleSize":"h6"},{"collapse":false,"height":"250px","panels":[{"aliasColors":{"Issue#referenced_merge_requests":"#70DBED"},"bars":true,"dashLength":10,"dashes":false,"datasource":"$database","editable":true,"error":false,"fill":1,"grid":{},"height":"400","id":17,"interval":"1m","legend":{"alignAsTable":true,"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":true,"min":false,"show":true,"sort":"avg","sortDesc":true,"total":false,"values":true},"lines":false,"linewidth":2,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"alias":"$tag_method","dsType":"influxdb","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"policy":"default","query":"SELECT mean(\"duration_95th\") AS \"value\" FROM downsampled.rails_method_call_timings_per_action_and_method WHERE $timeFilter AND \"action\" =~ /^[[action]]$/ GROUP BY \"method\", time($interval)","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Method Call Wall Time","tooltip":{"msResolution":false,"shared":false,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","logBase":1,"max":null,"min":null,"show":true},{"format":"short","logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{"Issue#referenced_merge_requests":"#70DBED"},"bars":true,"dashLength":10,"dashes":false,"datasource":"$database","editable":true,"error":false,"fill":1,"grid":{},"height":"400","id":22,"interval":"1m","legend":{"alignAsTable":true,"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":true,"min":false,"show":true,"sort":"avg","sortDesc":true,"total":false,"values":true},"lines":false,"linewidth":2,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"alias":"$tag_method","dsType":"influxdb","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"policy":"default","query":"SELECT mean(\"cpu_duration_95th\") AS \"value\" FROM downsampled.rails_method_call_timings_per_action_and_method WHERE $timeFilter AND \"action\" =~ /^[[action]]$/ GROUP BY \"method\", time($interval)","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Method Call CPU Time","tooltip":{"msResolution":false,"shared":false,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","logBase":1,"max":null,"min":null,"show":true},{"format":"short","logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{"Issue#referenced_merge_requests":"#70DBED"},"bars":true,"dashLength":10,"dashes":false,"datasource":"$database","editable":true,"error":false,"fill":1,"grid":{},"height":"400","id":23,"interval":"1m","legend":{"alignAsTable":true,"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":true,"min":false,"show":true,"sort":"avg","sortDesc":true,"total":false,"values":true},"lines":false,"linewidth":2,"links":[],"nullPointMode":"connected","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":true,"steppedLine":false,"targets":[{"alias":"$tag_method","dsType":"influxdb","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"policy":"default","query":"SELECT mean(\"call_count_95th\") AS \"value\" FROM downsampled.rails_method_call_timings_per_action_and_method WHERE $timeFilter AND \"action\" =~ /^[[action]]$/ GROUP BY \"method\", time($interval)","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Method Call Counts","tooltip":{"msResolution":false,"shared":false,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","logBase":1,"max":null,"min":null,"show":true},{"format":"short","logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Method Calls","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{"95th Pecentile":"#9AC48A","95th Percentile":"#9AC48A","99th Percentile":"#E24D42","Max":"#EAB839","Maximum":"#EAB839","Mean":"#6ED0E0"},"bars":false,"dashLength":10,"dashes":false,"datasource":"$database","editable":true,"error":false,"fill":0,"grid":{},"id":27,"interval":"1m","legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"alias":"$col","dsType":"influxdb","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"orderByTime":"ASC","policy":"default","query":"SELECT allocated_memory_95th AS \"95th Percentile\", allocated_memory_99th AS \"99th Percentile\", allocated_memory_mean AS \"Mean\", allocated_memory_max AS \"Maximum\"  FROM downsampled.rails_allocated_memory_per_action WHERE $timeFilter AND \"action\" =~ /^[[action]]$/","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Allocated Memory","tooltip":{"msResolution":true,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"decbytes","logBase":1,"max":null,"min":null,"show":true},{"format":"short","logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Memory","titleSize":"h6"}],"schemaVersion":14,"style":"dark","tags":["controller","prometheus"],"templating":{"list":[{"allFormat":"glob","allValue":null,"current":{"selected":false,"text":"Projects::PipelineSchedulesController","value":"Projects::PipelineSchedulesController"},"datasource":"Prometheus on prometheus-app-01","hide":0,"includeAll":false,"label":"Controller","multi":false,"multiFormat":"glob","name":"controller","options":[],"query":"label_values(gitlab_transaction_duration_seconds_count, controller)","refresh":1,"regex":"","sort":1,"tagValuesQuery":null,"tags":[],"tagsQuery":null,"type":"query","useTags":false},{"allValue":null,"current":{"text":"new","value":"new"},"datasource":"Prometheus on prometheus-app-01","hide":0,"includeAll":false,"label":"Action","multi":false,"name":"action","options":[],"query":"label_values(gitlab_transaction_duration_seconds_count{controller=\"$controller\"}, action)","refresh":2,"regex":"","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"text":"prd","value":"prd"},"datasource":"Prometheus on prometheus-app-01","hide":0,"includeAll":false,"label":"Environment","multi":false,"name":"environment","options":[],"query":"label_values(gitlab_transaction_duration_seconds_count, environment)","refresh":2,"regex":"","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-3h","to":"now"},"timepicker":{"now":true,"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"utc","title":"Rails Controllers - Prometheus WIP","version":5}}