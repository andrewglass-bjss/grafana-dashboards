{"meta":{"type":"db","canSave":false,"canEdit":false,"canAdmin":false,"canStar":true,"slug":"sidekiq-queue-detail","url":"/d/sidekiq-queue-detail/sidekiq-queue-detail","expires":"0001-01-01T00:00:00Z","created":"2019-11-26T13:11:05Z","updated":"2020-02-26T18:09:40Z","updatedBy":"ops-contact@gitlab.com","createdBy":"ops-contact@gitlab.com","version":41,"hasAcl":false,"isFolder":false,"folderId":949,"folderTitle":"Sidekiq service","folderUrl":"/dashboards/f/sidekiq/sidekiq-service","provisioned":false,"provisionedExternalId":""},"dashboard":{"__inputs":[],"__requires":[],"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":false,"iconColor":"#96D98D","name":"deploy","showIn":0,"tags":["deploy","$environment"],"type":"tags"},{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":false,"iconColor":"#FFEE52","name":"canary-deploy","showIn":0,"tags":["deploy","${environment}-cny"],"type":"tags"},{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":false,"iconColor":"#CA95E5","name":"feature-flags","showIn":0,"tags":["feature-flag","${environment}"],"type":"tags"}]},"description":"Uploaded by https://gitlab.com/gitlab-com/runbooks/-/jobs/451292284 at Wed Feb 26 18:09:40 UTC 2020","editable":false,"gnetId":null,"graphTooltip":1,"hideControls":false,"id":null,"links":[{"asDropdown":true,"icon":"external link","includeVars":false,"keepTime":true,"tags":"","targetBlank":false,"title":"Platform Triage","type":"link","url":"https://dashboards.gitlab.net/d/general-triage/platform-triage?orgId=1"},{"asDropdown":true,"icon":"external link","includeVars":false,"keepTime":true,"tags":"","targetBlank":false,"title":"Capacity Planning","type":"link","url":"https://dashboards.gitlab.net/d/general-capacity-planning/general-capacity-planning?orgId=1"},{"asDropdown":true,"icon":"external link","includeVars":false,"keepTime":false,"tags":"","targetBlank":true,"title":"Logs: Sidekiq","type":"link","url":"https://log.gprd.gitlab.net/goto/d7e4791e63d2a2b192514ac821c9f14f"},{"asDropdown":true,"icon":"external link","includeVars":false,"keepTime":false,"tags":"","targetBlank":true,"title":"Logs: Rails","type":"link","url":"https://log.gprd.gitlab.net/goto/86fbcd537588abef69339a352ef81d72"},{"asDropdown":true,"icon":"external link","includeVars":false,"keepTime":false,"tags":"","targetBlank":true,"title":"Logs: Unicorn","type":"link","url":"https://log.gprd.gitlab.net/goto/c87a39cf228c45ed8691c855aa583170"},{"asDropdown":true,"icon":"external link","includeVars":false,"keepTime":false,"tags":"","targetBlank":true,"title":"Logs: Unstructured","type":"link","url":"https://console.cloud.google.com/logs/viewer?project=gitlab-production\u0026interval=PT1H\u0026resource=gce_instance\u0026advancedFilter=jsonPayload.hostname%3A%22sidekiq%22%0Alabels.tag%3D%22unstructured.production%22\u0026customFacets=labels.%22compute.googleapis.com%2Fresource_name%22"},{"asDropdown":true,"icon":"external link","includeVars":false,"keepTime":false,"tags":"","targetBlank":true,"title":"Logs: system","type":"link","url":"https://log.gprd.gitlab.net/goto/72d0f3fdfd8db18db9800cc04d8b6f55"},{"asDropdown":true,"icon":"external link","includeVars":false,"keepTime":false,"tags":"","targetBlank":true,"title":"Runbook","type":"link","url":"https://gitlab.com/gitlab-com/runbooks/blob/master/troubleshooting/sidekiq_exception_count.md"},{"asDropdown":true,"icon":"external link","includeVars":false,"keepTime":false,"tags":"","targetBlank":true,"title":"Runbook","type":"link","url":"https://gitlab.com/gitlab-com/runbooks/blob/master/troubleshooting/sidekiq_stats_no_longer_showing.md"},{"asDropdown":true,"icon":"external link","includeVars":false,"keepTime":false,"tags":"","targetBlank":true,"title":"Runbook","type":"link","url":"https://gitlab.com/gitlab-com/runbooks/blob/master/troubleshooting/large-sidekiq-queue.md"},{"asDropdown":true,"icon":"dashboard","includeVars":false,"keepTime":true,"tags":"","targetBlank":false,"title":"api service","type":"link","url":"https://dashboards.gitlab.net/d/api-main/api-overview?orgId=1"},{"asDropdown":true,"icon":"dashboard","includeVars":false,"keepTime":true,"tags":"","targetBlank":false,"title":"ci-runners service","type":"link","url":"https://dashboards.gitlab.net/d/ci-runners-main/ci-runners-overview?orgId=1"},{"asDropdown":true,"icon":"dashboard","includeVars":false,"keepTime":true,"tags":"","targetBlank":false,"title":"frontend service","type":"link","url":"https://dashboards.gitlab.net/d/frontend-main/frontend-overview?orgId=1"},{"asDropdown":true,"icon":"dashboard","includeVars":false,"keepTime":true,"tags":"","targetBlank":false,"title":"git service","type":"link","url":"https://dashboards.gitlab.net/d/git-main/git-overview?orgId=1"},{"asDropdown":true,"icon":"dashboard","includeVars":false,"keepTime":true,"tags":"","targetBlank":false,"title":"gitaly service","type":"link","url":"https://dashboards.gitlab.net/d/gitaly-main/gitaly-overview?orgId=1"},{"asDropdown":true,"icon":"dashboard","includeVars":false,"keepTime":true,"tags":"","targetBlank":false,"title":"monitoring service","type":"link","url":"https://dashboards.gitlab.net/d/monitoring-main/monitoring-overview?orgId=1"},{"asDropdown":true,"icon":"dashboard","includeVars":false,"keepTime":true,"tags":"","targetBlank":false,"title":"pages service","type":"link","url":"https://dashboards.gitlab.net/d/general-service/service-platform-metrics?orgId=1\u0026var-type=pages"},{"asDropdown":true,"icon":"dashboard","includeVars":false,"keepTime":true,"tags":"","targetBlank":false,"title":"patroni service","type":"link","url":"https://dashboards.gitlab.net/d/patroni-main/patroni-overview?orgId=1"},{"asDropdown":true,"icon":"dashboard","includeVars":false,"keepTime":true,"tags":"","targetBlank":false,"title":"pgbouncer service","type":"link","url":"https://dashboards.gitlab.net/d/pgbouncer-main/pgbouncer-overview?orgId=1"},{"asDropdown":true,"icon":"dashboard","includeVars":false,"keepTime":true,"tags":"","targetBlank":false,"title":"redis service","type":"link","url":"https://dashboards.gitlab.net/d/redis-main/redis-overview?orgId=1"},{"asDropdown":true,"icon":"dashboard","includeVars":false,"keepTime":true,"tags":"","targetBlank":false,"title":"redis-cache service","type":"link","url":"https://dashboards.gitlab.net/d/redis-cache-main/redis-cache-overview?orgId=1"},{"asDropdown":true,"icon":"dashboard","includeVars":false,"keepTime":true,"tags":"","targetBlank":false,"title":"redis-sidekiq service","type":"link","url":"https://dashboards.gitlab.net/d/redis-sidekiq-main/redis-sidekiq-overview?orgId=1"},{"asDropdown":true,"icon":"dashboard","includeVars":false,"keepTime":true,"tags":"","targetBlank":false,"title":"registry service","type":"link","url":"https://dashboards.gitlab.net/d/registry-main/registry-overview?orgId=1"},{"asDropdown":true,"icon":"dashboard","includeVars":false,"keepTime":true,"tags":"","targetBlank":false,"title":"sidekiq service","type":"link","url":"https://dashboards.gitlab.net/d/sidekiq-main/sidekiq-overview?orgId=1"},{"asDropdown":true,"icon":"dashboard","includeVars":false,"keepTime":true,"tags":"","targetBlank":false,"title":"web service","type":"link","url":"https://dashboards.gitlab.net/d/web-main/web-overview??orgId=1"},{"asDropdown":true,"icon":"dashboard","includeVars":false,"keepTime":true,"tags":"","targetBlank":false,"title":"web-pages service","type":"link","url":"https://dashboards.gitlab.net/d/web-pages-main/web-pages-overview?orgId=1"},{"asDropdown":true,"icon":"dashboard","includeVars":true,"keepTime":true,"tags":"type:sidekiq","targetBlank":false,"title":"Sidekiq Detail","type":"dashboards","url":""}],"panels":[{"gridPos":{"h":4,"w":3,"x":0,"y":0},"id":2,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"links":[],"mappings":[{"from":"-10000000","id":0,"op":"=","text":"Latency Sensitive","to":"10000000","type":2,"value":"null"}],"nullValueMode":"connected","thresholds":{"mode":"absolute","steps":[{"color":"yellow","value":null}]},"title":"${__field.name}","unit":"none"},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"label_replace(\n  topk by (queue) (1, sum(rate(sidekiq_running_jobs{environment=\"$environment\", type=\"sidekiq\", stage=\"$stage\", queue=~\"$queue\"}[$__range])) by (queue, latency_sensitive)),\n  \"latency_sensitive\", \"unknown\", \"latency_sensitive\", \"\"\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":"{{ latency_sensitive }} ({{ queue }})"}],"title":"Queue Attribute: Latency Sensitive","type":"stat"},{"gridPos":{"h":4,"w":3,"x":3,"y":0},"id":3,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"links":[],"mappings":[{"from":"-10000000","id":0,"op":"=","text":"Feature Category","to":"10000000","type":2,"value":"null"}],"nullValueMode":"connected","thresholds":{"mode":"absolute","steps":[{"color":"blue","value":null}]},"title":"${__field.name}","unit":"none"},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"label_replace(\n  topk by (queue) (1, sum(rate(sidekiq_running_jobs{environment=\"$environment\", type=\"sidekiq\", stage=\"$stage\", queue=~\"$queue\"}[$__range])) by (queue, feature_category)),\n  \"feature_category\", \"unknown\", \"feature_category\", \"\"\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":"{{ feature_category }} ({{ queue }})"}],"title":"Queue Attribute: Feature Category","type":"stat"},{"gridPos":{"h":4,"w":3,"x":6,"y":0},"id":4,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"links":[{"title":"Sidekiq Priority Detail: ${__field.labels.priority}","url":"/d/sidekiq-priority-detail/sidekiq-priority-detail?orgId=1\u0026var-priority=${__field.labels.priority}\u0026var-environment=${environment}\u0026var-stage=${stage}\u0026${__url_time_range}"}],"mappings":[{"from":"-10000000","id":0,"op":"=","text":"Priority","to":"10000000","type":2,"value":"null"}],"nullValueMode":"connected","thresholds":{"mode":"absolute","steps":[{"color":"orange","value":null}]},"title":"${__field.name}","unit":"none"},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"label_replace(\n  topk by (queue) (1, sum(rate(sidekiq_running_jobs{environment=\"$environment\", type=\"sidekiq\", stage=\"$stage\", queue=~\"$queue\"}[$__range])) by (queue, priority)),\n  \"priority\", \"unknown\", \"priority\", \"\"\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":"{{ priority }} ({{ queue }})"}],"title":"Queue Attribute: Priority","type":"stat"},{"gridPos":{"h":4,"w":3,"x":9,"y":0},"id":5,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"links":[],"mappings":[{"from":"-10000000","id":0,"op":"=","text":"External Dependencies","to":"10000000","type":2,"value":"null"}],"nullValueMode":"connected","thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"title":"${__field.name}","unit":"none"},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"label_replace(\n  topk by (queue) (1, sum(rate(sidekiq_running_jobs{environment=\"$environment\", type=\"sidekiq\", stage=\"$stage\", queue=~\"$queue\"}[$__range])) by (queue, external_dependencies)),\n  \"external_dependencies\", \"none\", \"external_dependencies\", \"\"\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":"{{ external_dependencies }} ({{ queue }})"}],"title":"Queue Attribute: External Dependencies","type":"stat"},{"gridPos":{"h":4,"w":3,"x":12,"y":0},"id":6,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"links":[],"mappings":[{"from":"-10000000","id":0,"op":"=","text":"Resource Boundary","to":"10000000","type":2,"value":"null"}],"nullValueMode":"connected","thresholds":{"mode":"absolute","steps":[{"color":"purple","value":null}]},"title":"${__field.name}","unit":"none"},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"label_replace(\n  topk by (queue) (1, sum(rate(sidekiq_running_jobs{environment=\"$environment\", type=\"sidekiq\", stage=\"$stage\", queue=~\"$queue\"}[$__range])) by (queue, boundary)),\n  \"boundary\", \"none\", \"boundary\", \"\"\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":"{{ boundary }} ({{ queue }})"}],"title":"Queue Attribute: Resource Boundary","type":"stat"},{"gridPos":{"h":4,"w":3,"x":15,"y":0},"id":7,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":0,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"light-red","value":null}]},"title":"Max Queuing Duration SLO","unit":"s"},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"vector(60.000000) and on () sidekiq_running_jobs{environment=\"$environment\", type=\"sidekiq\", stage=\"$stage\", queue=~\"$queue\", latency_sensitive=\"no\"}\nor\nvector(10.000000) and on () sidekiq_running_jobs{environment=\"$environment\", type=\"sidekiq\", stage=\"$stage\", queue=~\"$queue\", latency_sensitive=\"yes\"}\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":"{{ queue }}"}],"title":"Max Queuing Duration SLO","type":"stat"},{"gridPos":{"h":4,"w":3,"x":18,"y":0},"id":8,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":0,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"red","value":null}]},"title":"Max Execution Duration SLO","unit":"s"},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"vector(300.000000) and on () sidekiq_running_jobs{environment=\"$environment\", type=\"sidekiq\", stage=\"$stage\", queue=~\"$queue\", latency_sensitive=\"no\"}\nor\nvector(10.000000) and on () sidekiq_running_jobs{environment=\"$environment\", type=\"sidekiq\", stage=\"$stage\", queue=~\"$queue\", latency_sensitive=\"yes\"}\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":"{{ queue }}"}],"title":"Max Execution Duration SLO","type":"stat"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"gridPos":{"h":10,"w":6,"x":0,"y":100},"id":9,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"histogram_quantile(0.95, sum by (queue, le) (\n  rate(sidekiq_jobs_queue_duration_seconds_bucket{environment=\"$environment\", type=\"sidekiq\", stage=\"$stage\", queue=~\"$queue\"}[$__interval])\n))\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"p95 {{ queue }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Queue Time","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":"Duration","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"gridPos":{"h":10,"w":6,"x":6,"y":100},"id":10,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"histogram_quantile(0.95, sum by (queue, le) (\n  rate(sidekiq_jobs_completion_seconds_bucket{environment=\"$environment\", type=\"sidekiq\", stage=\"$stage\", queue=~\"$queue\"}[$__interval])\n))\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"p95 {{ queue }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Execution Time","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":"Duration","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"gridPos":{"h":10,"w":6,"x":12,"y":100},"id":11,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (queue) (\n  rate(sidekiq_jobs_completion_seconds_count{environment=\"$environment\", type=\"sidekiq\", stage=\"$stage\", queue=~\"$queue\"}[$__interval])\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ queue }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"QPS","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"gridPos":{"h":10,"w":6,"x":18,"y":100},"id":12,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (queue) (\n  changes(sidekiq_jobs_failed_total{environment=\"$environment\", type=\"sidekiq\", stage=\"$stage\", queue=~\"$queue\"}[$__interval])\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ queue }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Error Rate","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"gridPos":{"h":10,"w":6,"x":0,"y":110},"id":13,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"histogram_quantile(0.95, sum by (fqdn, queue, le) (\n  rate(sidekiq_jobs_queue_duration_seconds_bucket{environment=\"$environment\", type=\"sidekiq\", stage=\"$stage\", queue=~\"$queue\"}[$__interval])\n))\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"p95 {{ queue }} - {{ fqdn }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Queue Time per Node","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":"Duration","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"gridPos":{"h":10,"w":6,"x":6,"y":110},"id":14,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"histogram_quantile(0.95, sum by (fqdn, queue, le) (\n  rate(sidekiq_jobs_completion_seconds_bucket{environment=\"$environment\", type=\"sidekiq\", stage=\"$stage\", queue=~\"$queue\"}[$__interval])\n))\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"p95 {{ queue }} - {{ fqdn }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Execution Time per Node","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":"Duration","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"gridPos":{"h":10,"w":6,"x":12,"y":110},"id":15,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (fqdn, queue) (\n  rate(sidekiq_jobs_completion_seconds_count{environment=\"$environment\", type=\"sidekiq\", stage=\"$stage\", queue=~\"$queue\"}[$__interval])\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ queue }} - {{ fqdn }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"QPS per Node","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"gridPos":{"h":10,"w":6,"x":18,"y":110},"id":16,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (fqdn, queue) (\n  changes(sidekiq_jobs_failed_total{environment=\"$environment\", type=\"sidekiq\", stage=\"$stage\", queue=~\"$queue\"}[$__interval])\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ queue }} - {{ fqdn }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Error Rate per Node","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"content":"Made with ❤️ and [Grafonnet](https://github.com/grafana/grafonnet-lib). [Contribute to this dashboard on GitLab.com](https://gitlab.com/gitlab-com/runbooks/blob/master/dashboards/./sidekiq/queue-detail.dashboard.jsonnet)\n","datasource":null,"gridPos":{"h":2,"w":24,"x":0,"y":110000},"id":17,"mode":"markdown","title":"Source","type":"text"}],"refresh":"","rows":[],"schemaVersion":16,"style":"light","tags":["managed","sidekiq","type:sidekiq","detail"],"templating":{"list":[{"current":{"text":"Prometheus","value":"Prometheus"},"hide":0,"label":null,"name":"PROMETHEUS_DS","options":[],"query":"prometheus","refresh":1,"regex":"/(.*-gprd|Global|gprd-.*)/","type":"datasource"},{"allValue":null,"current":{"text":"gprd","value":"gprd"},"datasource":"$PROMETHEUS_DS","hide":0,"includeAll":false,"label":null,"multi":false,"name":"environment","options":[],"query":"label_values(gitlab_service_ops:rate, environment)","refresh":1,"regex":"","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"text":"main","value":"main"},"hide":0,"includeAll":false,"label":"","multi":false,"name":"stage","options":[{"text":"main","value":"main"},{"text":"cny","value":"cny"},{"text":"","value":""}],"query":"main,cny,","refresh":0,"type":"custom"},{"allValue":".*","current":{"text":"post_receive","value":"post_receive"},"datasource":"$PROMETHEUS_DS","hide":0,"includeAll":true,"label":null,"multi":true,"name":"queue","options":[],"query":"label_values(sidekiq_jobs_completion_seconds_count{environment=\"$environment\", type=\"sidekiq\"}, queue)","refresh":1,"regex":"","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-6h","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"utc","title":"sidekiq: Queue Detail","uid":"sidekiq-queue-detail","version":41}}