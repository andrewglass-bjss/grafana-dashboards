{"meta":{"type":"db","canSave":false,"canEdit":false,"canAdmin":false,"canStar":true,"slug":"host-stats-thanos","url":"/d/7fT-fBeZz/host-stats-thanos","expires":"0001-01-01T00:00:00Z","created":"2020-05-05T07:38:30Z","updated":"2020-05-05T13:08:50Z","updatedBy":"ops-contact@gitlab.com","createdBy":"ops-contact@gitlab.com","version":14,"hasAcl":false,"isFolder":false,"folderId":0,"folderTitle":"General","folderUrl":"","provisioned":false,"provisionedExternalId":""},"dashboard":{"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations \u0026 Alerts","type":"dashboard"}]},"editable":true,"gnetId":null,"graphTooltip":1,"id":null,"iteration":1588679976806,"links":[],"panels":[{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":28,"panels":[],"title":"CPU and Load Average","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","description":"Percentage of all CPU cores/hyperthreads","editable":true,"error":false,"fill":10,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":8,"x":0,"y":1},"hiddenSeries":false,"id":8,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":0,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"expr":"avg(rate(node_cpu_seconds_total{env=\"$env\",fqdn=\"$fqdn\", mode !=\"idle\"}[$__interval])) by (mode)","format":"time_series","hide":false,"interval":"30s","intervalFactor":2,"legendFormat":"{{mode}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"CPU usage","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":null,"format":"percentunit","label":"% of all CPUs","logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","description":"Is workload unevenly distributed among vCPUs?\n\nNote that imbalance may be intentional (e.g. a process or container may be restricted to using only a limited number or set of vCPUs).  Unexpected imbalance may be worth investigating.","editable":true,"error":false,"fill":10,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":8,"x":8,"y":1},"hiddenSeries":false,"id":43,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":0,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"expr":"avg by (cpu) (rate(node_cpu_seconds_total{env=\"$env\",fqdn=\"$fqdn\",mode=\"system\"}[$__interval]))","format":"time_series","hide":false,"interval":"30s","intervalFactor":2,"legendFormat":"CPU {{cpu}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Per-core CPU usage for kernel-mode execution context","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":null,"format":"short","label":"# of vCPUs used","logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","editable":true,"error":false,"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":8,"x":16,"y":1},"hiddenSeries":false,"id":10,"legend":{"avg":true,"current":true,"max":true,"min":false,"show":false,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"avg(rate(node_context_switches_total{env=\"$env\",fqdn=\"$fqdn\"}[$__interval]))","format":"time_series","interval":"30s","intervalFactor":2,"legendFormat":"Context switches","refId":"B"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Context Switches","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"CS per second","logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","description":"Are soft-interrupts distributed evenly across vCPUs?\n\nShows percentage of CPU time spent by each vCPU on softirq handling.","editable":true,"error":false,"fill":10,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":8,"x":0,"y":8},"hiddenSeries":false,"id":41,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":0,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"expr":"avg by (cpu) (rate(node_cpu_seconds_total{env=\"$env\",fqdn=\"$fqdn\",mode=\"softirq\"}[$__interval]))","format":"time_series","hide":false,"interval":"30s","intervalFactor":2,"legendFormat":"CPU {{cpu}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Per-core CPU usage for soft-interrupt handling","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":null,"format":"short","label":"# of vCPUs used","logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","description":"Is workload unevenly distributed among vCPUs?\n\nNote that imbalance may be intentional (e.g. a process or container may be restricted to using only a limited number or set of vCPUs).  Unexpected imbalance may be worth investigating.","editable":true,"error":false,"fill":10,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":8,"x":8,"y":8},"hiddenSeries":false,"id":42,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":0,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"expr":"avg by (cpu) (\n  rate(node_cpu_seconds_total{env=\"$env\",fqdn=\"$fqdn\",mode=\"user\"}[$__interval])\n)","format":"time_series","hide":false,"interval":"30s","intervalFactor":2,"legendFormat":"CPU {{cpu}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Per-core CPU usage for user-mode execution context","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":null,"format":"short","label":"# of vCPUs used","logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","editable":true,"error":false,"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":8,"x":16,"y":8},"hiddenSeries":false,"id":9,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg(avg_over_time(node_load1{env=\"$env\",fqdn=\"$fqdn\"}[$__interval]) / avg_over_time(instance:node_cpus:count[$__interval]))","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"1m","intervalFactor":2,"legendFormat":"load","metric":"node_load1","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":120,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Load per CPU","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"","logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":15},"id":26,"panels":[],"title":"Memory","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","editable":true,"error":false,"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":8,"x":0,"y":16},"hiddenSeries":false,"id":7,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/.*Total/","dashes":true}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"avg(\n  avg_over_time(node_memory_MemTotal_bytes{env=\"$env\",fqdn=\"$fqdn\"}[$__interval])\n  -\n  avg_over_time(node_memory_MemAvailable_bytes{env=\"$env\",fqdn=\"$fqdn\"}[$__interval])\n)","format":"time_series","interval":"15s","intervalFactor":1,"legendFormat":"Used","refId":"E"},{"expr":"avg(\n  avg_over_time(node_memory_SwapTotal_bytes{env=\"$env\",fqdn=\"$fqdn\"}[$__interval]) \u003e 0\n  -\n  avg_over_time(node_memory_SwapFree_bytes{env=\"$env\",fqdn=\"$fqdn\"}[$__interval])\n)","format":"time_series","intervalFactor":1,"legendFormat":"Swap","refId":"F"},{"expr":"avg(avg_over_time(node_memory_MemTotal_bytes{env=\"$env\",fqdn=\"$fqdn\"}[$__interval]))","format":"time_series","intervalFactor":1,"legendFormat":"Total","refId":"G"},{"expr":"avg(avg_over_time(node_memory_SwapTotal_bytes{env=\"$env\",fqdn=\"$fqdn\"}[$__interval])) \u003e 0","format":"time_series","intervalFactor":1,"legendFormat":"Swap Total","refId":"H"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Memory Overview","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":0,"format":"bytes","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","description":"","editable":true,"error":false,"fill":10,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":8,"x":8,"y":16},"hiddenSeries":false,"id":39,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":0,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/write.*/","transform":"negative-Y"}],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg(avg_over_time(node_memory_AnonPages_bytes{env=\"$env\",fqdn=\"$fqdn\"}[$__interval]))","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"interval":"15s","intervalFactor":1,"legendFormat":"AnonPages","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":10,"tags":[]},{"dsType":"influxdb","expr":"avg(avg_over_time(node_memory_Buffers_bytes{env=\"$env\",fqdn=\"$fqdn\"}[$__interval]))","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"interval":"15s","intervalFactor":1,"legendFormat":"Buffers","metric":"","policy":"default","refId":"B","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":10,"tags":[]},{"dsType":"influxdb","expr":"avg(avg_over_time(node_memory_Slab_bytes{env=\"$env\",fqdn=\"$fqdn\"}[$__interval]))","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"interval":"15s","intervalFactor":1,"legendFormat":"Slab","metric":"","policy":"default","refId":"C","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":10,"tags":[]},{"dsType":"influxdb","expr":"avg(avg_over_time(node_memory_Cached_bytes{env=\"$env\",fqdn=\"$fqdn\"}[$__interval]))","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"interval":"15s","intervalFactor":1,"legendFormat":"Cached","metric":"","policy":"default","refId":"D","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":10,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Memory usage by type","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":0,"format":"bytes","label":null,"logBase":1,"max":null,"min":"0","show":true},{"decimals":null,"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","description":"Most normal (4 KB) memory pages are either:\n* anonymous memory (allocated by a process)\n* file-backed (cached copy of an on-disk block)\n\nWhen something needs a page of memory, typically another page needs to be evicted.  The memory manager has a 2-strikes policy: 1st strike bumps the page from Active to Inactive.  If a page on the Inactive list is not touched, it remains a candidate for eviction.  The kernel tries to keep enough pages on the Inactive list to satisfy memory demands.\n\nTypically the kernel prefers to evict file-backed pages, but if swap is enabled, it can also swap-out anonymous pages.","editable":true,"error":false,"fill":10,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":8,"x":16,"y":16},"hiddenSeries":false,"id":40,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":0,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg(avg_over_time(node_memory_Active_anon_bytes{env=\"$env\",fqdn=\"$fqdn\"}[$__interval]))","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"interval":"15s","intervalFactor":1,"legendFormat":"Active anonymous","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":10,"tags":[]},{"dsType":"influxdb","expr":"avg(avg_over_time(node_memory_Active_file_bytes{env=\"$env\",fqdn=\"$fqdn\"}[$__interval]))","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"interval":"15s","intervalFactor":1,"legendFormat":"Active file-backed","metric":"","policy":"default","refId":"B","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":10,"tags":[]},{"dsType":"influxdb","expr":"avg(avg_over_time(node_memory_Inactive_anon_bytes{env=\"$env\",fqdn=\"$fqdn\"}[$__interval]))","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"interval":"15s","intervalFactor":1,"legendFormat":"Inactive anonymous","metric":"","policy":"default","refId":"C","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":10,"tags":[]},{"dsType":"influxdb","expr":"avg(avg_over_time(node_memory_Inactive_file_bytes{env=\"$env\",fqdn=\"$fqdn\"}[$__interval]))","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"interval":"15s","intervalFactor":1,"legendFormat":"Inactive file-backed","metric":"","policy":"default","refId":"D","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":10,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Page cache","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":0,"format":"bytes","label":null,"logBase":1,"max":null,"min":"0","show":true},{"decimals":null,"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":true,"dashLength":10,"dashes":false,"datasource":null,"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":8,"x":0,"y":23},"hiddenSeries":false,"id":47,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":false,"linewidth":1,"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"ceil(avg(rate(node_vmstat_oom_kill{env=\"$env\",fqdn=\"$fqdn\"}[$__interval])) * 86400)","interval":"1d","intervalFactor":5,"legendFormat":"Boom!","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"OOMs / Day","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","description":"Physical I/O to/from any active swap file or partition.  Some hosts have swap disabled (see /proc/swaps on the host), in which case this metric will always be zero even when the host is under memory pressure.\n\nRaw metric uses a unit size of one 4 KB page, so we multiply by 4096 to convert to bytes.","editable":true,"error":false,"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":8,"x":8,"y":23},"hiddenSeries":false,"id":15,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/write.*/","transform":"negative-Y"}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg(increase(node_vmstat_pswpin{env=\"$env\",fqdn=\"$fqdn\"}[$__interval])) * 4096","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"interval":"30s","intervalFactor":1,"legendFormat":"swap in from disk","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":10,"tags":[]},{"dsType":"influxdb","expr":"avg(increase(node_vmstat_pswpout{env=\"$env\",fqdn=\"$fqdn\"}[$__interval])) * 4096","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"interval":"30s","intervalFactor":1,"legendFormat":"swap out to disk","metric":"","policy":"default","refId":"B","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":10,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Swap IO","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":0,"format":"bytes","label":null,"logBase":1,"max":null,"min":null,"show":true},{"decimals":null,"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":30},"id":24,"panels":[],"title":"Disk Performance","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","description":"This measures the mean duration for each read operation (including time spent in the I/O queue, not just time from Dispatch to Compete).\n\nGood latency should be a few milliseconds; if the graph's scale is in seconds, you have a problem!\n\nHigh read latency and deep I/O queues often occur together.  They can be caused by either increased service time from the block device (slower physical I/O) or increased demand (request arrival rate).  Note that writes can sometimes stall reads.","editable":true,"error":false,"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":12,"x":0,"y":31},"hiddenSeries":false,"id":13,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg by (device) (\n  rate(node_disk_read_time_seconds_total{env=\"$env\",fqdn=\"$fqdn\", device!~\"dm.*\"}[$__interval])\n  /\n  rate(node_disk_reads_completed_total{env=\"$env\",fqdn=\"$fqdn\", device!~\"dm.*\"}[$__interval])\n)","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"interval":"30s","intervalFactor":1,"legendFormat":"{{device}}","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":10,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Disk Read Latency (mean latency)","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","description":"This measures the mean duration for each write operation (including time spent in the I/O queue, not just time from Dispatch to Compete).\n\nWrite latency is often slower (due to larger mean operation size) and often runs in the background, so high write latency may not be as serious as read latency.  However, writes can stall reads if the reads are not getting promptly scheduled and spending time in the I/O queue.","editable":true,"error":false,"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":12,"x":12,"y":31},"hiddenSeries":false,"id":32,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg by (device) (\n  rate(node_disk_write_time_seconds_total{env=\"$env\",fqdn=\"$fqdn\", device!~\"dm.*\"}[$__interval])\n  /\n  rate(node_disk_writes_completed_total{env=\"$env\",fqdn=\"$fqdn\", device!~\"dm.*\"}[$__interval])\n)","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"interval":"30s","intervalFactor":1,"legendFormat":"{{device}}","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":10,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Disk Write Latency (mean latency)","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","description":"This measures the mean bytes read per wall-clock second from each mounted block device.","editable":true,"error":false,"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":12,"x":0,"y":38},"hiddenSeries":false,"id":33,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg by (device) (\n  rate(node_disk_read_bytes_total{env=\"$env\",fqdn=\"$fqdn\", device!~\"dm.*\"}[$__interval])\n)","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"interval":"30s","intervalFactor":1,"legendFormat":"{{device}}","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":10,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Disk Read Throughput (bytes/sec)","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":0,"format":"Bps","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","description":"This measures the mean bytes written per wall-clock second from each mounted block device.","editable":true,"error":false,"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":12,"x":12,"y":38},"hiddenSeries":false,"id":34,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg by (device) (\n  rate(node_disk_written_bytes_total{env=\"$env\",fqdn=\"$fqdn\", device!~\"dm.*\"}[$__interval])\n)","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"interval":"30s","intervalFactor":1,"legendFormat":"{{device}}","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":10,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Disk Write Throughput (bytes/sec)","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":0,"format":"Bps","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","description":"This measures the mean count of read operations per wall-clock second from each mounted block device.","editable":true,"error":false,"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":12,"x":0,"y":45},"hiddenSeries":false,"id":35,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg by (device) (\n  rate(node_disk_reads_completed_total{env=\"$env\",fqdn=\"$fqdn\", device!~\"dm.*\"}[$__interval])\n)","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"interval":"30s","intervalFactor":1,"legendFormat":"{{device}}","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":10,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Disk Read Throughput (operations/sec)","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":0,"format":"iops","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","description":"This measures the mean count of write operations per wall-clock second from each mounted block device.","editable":true,"error":false,"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":12,"x":12,"y":45},"hiddenSeries":false,"id":36,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg by (device) (\n  rate(node_disk_writes_completed_total{env=\"$env\",fqdn=\"$fqdn\", device!~\"dm.*\"}[$__interval])\n)","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"interval":"30s","intervalFactor":1,"legendFormat":"{{device}}","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":10,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Disk Write Throughput (operations/sec)","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":0,"format":"iops","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","description":"This measures the mean size of read operations for each mounted block device.","editable":true,"error":false,"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":12,"x":0,"y":52},"hiddenSeries":false,"id":37,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg by (device) (\n  rate(node_disk_read_bytes_total{env=\"$env\",fqdn=\"$fqdn\", device!~\"dm.*\"}[$__interval])\n  /\n  rate(node_disk_reads_completed_total{env=\"$env\",fqdn=\"$fqdn\", device!~\"dm.*\"}[$__interval])\n)","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"interval":"30s","intervalFactor":1,"legendFormat":"{{device}}","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":10,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Disk Mean Read Operation Size (bytes/operation)","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":0,"format":"decbytes","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","description":"This measures the mean size of write operations for each mounted block device.","editable":true,"error":false,"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":12,"x":12,"y":52},"hiddenSeries":false,"id":38,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg by (device) (\n  rate(node_disk_written_bytes_total{env=\"$env\",fqdn=\"$fqdn\", device!~\"dm.*\"}[$__interval])\n  /\n  rate(node_disk_writes_completed_total{env=\"$env\",fqdn=\"$fqdn\", device!~\"dm.*\"}[$__interval])\n)","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"interval":"30s","intervalFactor":1,"legendFormat":"{{device}}","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":10,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Disk Mean Write Operation Size (bytes/operation)","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":0,"format":"decbytes","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","fill":0,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":0,"y":59},"hiddenSeries":false,"id":18,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg(rate(node_vmstat_pgmajfault{env=\"$env\",fqdn=\"$fqdn\"}[$__interval]))","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"30s","intervalFactor":2,"legendFormat":"Major Faults","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":[{"colorMode":"critical","fill":true,"line":true,"op":"gt","value":1000,"yaxis":"left"}],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Page Faults","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":66},"id":22,"panels":[],"title":"Disk Usage","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","description":"","editable":true,"error":false,"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":8,"x":0,"y":67},"hiddenSeries":false,"id":14,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg by (mountpoint) (\n  1 - avg_over_time(instance:node_filesystem_avail:ratio{env=\"$env\",fqdn=\"$fqdn\", fstype=~\"ext.|xfs\"}[$__interval])\n)","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"1m","intervalFactor":2,"legendFormat":"{{mountpoint}}","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":10,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Available Filesystem Used by Mountpoint","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":null,"logBase":1,"max":"1","min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","editable":true,"error":false,"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":8,"x":8,"y":67},"hiddenSeries":false,"id":16,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"Max","dashes":true}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg(avg_over_time(node_filefd_allocated{env=\"$env\",fqdn=\"$fqdn\"}[$__interval]))","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"Allocated","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":10,"tags":[]},{"expr":"avg(node_filefd_maximum{env=\"$env\",fqdn=\"$fqdn\"})","format":"time_series","intervalFactor":2,"legendFormat":"Max","refId":"B"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Allocated file descriptors","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":74},"id":30,"panels":[],"title":"Network","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","editable":true,"error":false,"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":8,"x":0,"y":75},"hiddenSeries":false,"id":12,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/In .*/","transform":"negative-Y"}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"avg by (device) (\n  rate(node_network_transmit_bytes_total{env=\"$env\",fqdn=\"$fqdn\", device!=\"lo\"}[$__interval])\n)","format":"time_series","hide":false,"interval":"30s","intervalFactor":2,"legendFormat":"Out - {{device}}","refId":"D"},{"expr":"avg by (device) (\n  rate(node_network_receive_bytes_total{env=\"$env\",fqdn=\"$fqdn\", device!=\"lo\"}[$__interval])\n)","format":"time_series","hide":false,"interval":"30s","intervalFactor":2,"legendFormat":"In -  {{device}}","refId":"C"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Network Bandwidth Usage","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"Bps","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":0}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","description":"Shows point-in-time count of open TCP connections.\n\nNote that there could be microbursts occuring on a smaller time scale than our metrics-polling interval.  To check for this, look for spikes in the nearby counter-based graphs of new incoming and outgoing connections.","fill":1,"fillGradient":0,"gridPos":{"h":7,"w":8,"x":8,"y":75},"hiddenSeries":false,"id":17,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg(avg_over_time(node_netstat_Tcp_CurrEstab{env=\"$env\",fqdn=\"$fqdn\"}[$__interval]))","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"avg","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]},{"dsType":"influxdb","expr":"avg(max_over_time(node_netstat_Tcp_CurrEstab{env=\"$env\",fqdn=\"$fqdn\"}[$__interval]))","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"max","orderByTime":"ASC","policy":"default","refId":"B","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Count of established TCP connections","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","description":"Show this host's new TCP connection rate, split into:\n* Outgoing connections when acting as a client\n* Incoming connections when acting as a server\n\nThese kernel counters are incremented for each newly established outgoing (\"active\") or incoming (\"passive\") TCP connection.  This graph converts the counter to a rate to show the trend.\n\nFor reference, an \"active\" (outgoing) connection is where we are the client sending the initial SYN.  A \"passive\" (incoming) connection is where we are the server-side listener receiving the initial SYN.","fill":1,"fillGradient":0,"gridPos":{"h":7,"w":8,"x":16,"y":75},"hiddenSeries":false,"id":45,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg(rate(node_netstat_Tcp_ActiveOpens{env=\"$env\",fqdn=\"$fqdn\"}[$__interval]))","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"30s","intervalFactor":2,"legendFormat":"Outgoing","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]},{"dsType":"influxdb","expr":"avg(rate(node_netstat_Tcp_PassiveOpens{env=\"$env\",fqdn=\"$fqdn\"}[$__interval]))","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"30s","intervalFactor":2,"legendFormat":"Incoming","orderByTime":"ASC","policy":"default","refId":"B","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Rate of new outgoing and incoming TCP connections","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"con / sec","label":"","logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","description":"This kernel counter indicates the number of times an outgoing TCP SYN packet had to be retransmitted.\n\nThis is not a hard failure (the retry may succeed).  But it always indicates slowness (e.g. the 1st retry occurs after 1 second delay, and each subsequent retry uses exponential backoff).\n\nSpikes could hint at any of:\n* Packet loss along the network path (in either direction, dropping the outgoing SYN or the incoming SYN-ACK)\n* Connection rate-limiting by the remote peer (e.g. firewall, DDoS protection)\n* Saturation on the remote listener, having too many pending connection requests already waiting on is backlog","fill":1,"fillGradient":0,"gridPos":{"h":7,"w":8,"x":0,"y":82},"hiddenSeries":false,"id":44,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg(rate(node_netstat_TcpExt_TCPSynRetrans{env=\"$env\",fqdn=\"$fqdn\"}[$__interval]))","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"30s","intervalFactor":2,"legendFormat":"TCP SYN retransmits","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"As a client: Retry rate for new outgoing TCP connection requests","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ops","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","description":"This kernel counter indicates the number of times an incoming TCP SYN packet had to be dropped by the kernel due to the TCP listener's request backlog already being full.\n\nThis is a hard failure.  The TCP client connecting to this host will see this as a failed connection attempt.  The client may or may not implement retry logic to handle this error.","fill":1,"fillGradient":0,"gridPos":{"h":7,"w":8,"x":8,"y":82},"hiddenSeries":false,"id":19,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg(rate(node_netstat_TcpExt_ListenOverflows{env=\"$env\",fqdn=\"$fqdn\"}[$__interval]))","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"30s","intervalFactor":2,"legendFormat":"TCP SYN drops","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"As a server: Drop rate for new incoming TCP connection requests","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ops","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"refresh":false,"schemaVersion":22,"style":"dark","tags":[],"templating":{"list":[{"allValue":null,"current":{"selected":true,"text":"gprd","value":"gprd"},"datasource":"Global","definition":"label_values(up{job=\"prometheus\"}, env)","hide":0,"includeAll":false,"label":null,"multi":false,"name":"env","options":[],"query":"label_values(up{job=\"prometheus\"}, env)","refresh":1,"regex":"","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"text":"thanos-store-01-inf-gprd.c.gitlab-production.internal","value":"thanos-store-01-inf-gprd.c.gitlab-production.internal"},"datasource":"Global","definition":"label_values(up{env=\"$env\",job=\"node\"}, fqdn)","hide":0,"includeAll":false,"label":"Host","multi":false,"name":"fqdn","options":[],"query":"label_values(up{env=\"$env\",job=\"node\"}, fqdn)","refresh":2,"regex":"","skipUrlSync":false,"sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-7d","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"utc","title":"Host Stats (Thanos)","uid":"7fT-fBeZz","version":14}}