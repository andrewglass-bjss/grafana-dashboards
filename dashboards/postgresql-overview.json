{"meta":{"type":"db","canSave":false,"canEdit":true,"canAdmin":false,"canStar":true,"slug":"postgresql-overview","url":"/d/000000144/postgresql-overview","expires":"0001-01-01T00:00:00Z","created":"2018-11-27T12:15:53Z","updated":"2021-01-11T14:01:11Z","updatedBy":"ops-contact@gitlab.com","createdBy":"ops-contact@gitlab.com","version":53,"hasAcl":false,"isFolder":false,"folderId":657,"folderTitle":"PostgreSQL","folderUrl":"/dashboards/f/RNfEDpLmz/postgresql","provisioned":false,"provisionedExternalId":""},"dashboard":{"annotations":{"list":[{"$$hashKey":"object:787","builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations \u0026 Alerts","type":"dashboard"},{"$$hashKey":"object:789","datasource":"prometheus-01-inf-gprd","enable":true,"expr":"ALERTS{alertname=~\"PostgreSQL_[^E].*[^w]\",environment=\"$environment\",severity!~\"info\",alertstate=\"firing\"}","hide":false,"iconColor":"rgba(255, 96, 96, 1)","limit":100,"name":"Alerts","showIn":0,"step":"1h","tagKeys":"{{fqdn}}","tags":[],"textFormat":"{{fqdn}}","titleFormat":"{{alertname}}","type":"tags"}]},"editable":true,"gnetId":null,"graphTooltip":1,"id":null,"iteration":1610371376348,"links":[{"icon":"external link","includeVars":true,"keepTime":true,"tags":["postgresql"],"targetBlank":true,"type":"dashboards"}],"panels":[{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":38,"panels":[],"repeat":"type","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"title":"Health \u0026 Alerts ($type)","type":"row"},{"cacheTimeout":null,"colorBackground":false,"colorValue":true,"colors":["#d44a3a","rgba(237, 129, 40, 0.89)","#299c46"],"datasource":"Global","decimals":0,"description":"The number of nodes currently in the \"Up\" state.","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"format":"none","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"gridPos":{"h":3,"w":8,"x":0,"y":1},"height":"100","id":27,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"dsType":"influxdb","expr":"count(up{environment=\"$environment\",tier=\"db\",type=\"$type\",job=\"node\"})","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"instant":true,"interval":"","intervalFactor":2,"legendFormat":"","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":".5,.9","title":"Nodes Currently Up","transparent":true,"type":"singlestat","valueFontSize":"100%","valueMaps":[{"op":"=","text":"ALERTING","value":"0"},{"op":"=","text":"HEALTHY","value":"1"}],"valueName":"current"},{"cacheTimeout":null,"colorBackground":false,"colorValue":true,"colors":["#d44a3a","rgba(237, 129, 40, 0.89)","#299c46"],"datasource":"Global","decimals":1,"description":"The percentage of time no alerts were sent out.","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"format":"percent","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"gridPos":{"h":3,"w":8,"x":8,"y":1},"height":"100","id":25,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"dsType":"influxdb","expr":"sum(avg_over_time(up{environment=\"$environment\", tier=\"db\", type=\"$type\", job=\"node\"}[1d])) / count(up{environment=\"$environment\", tier=\"db\", type=\"$type\", job=\"node\"}) * 100","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"instant":true,"interval":"","intervalFactor":2,"legendFormat":"","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":"95,99","title":"Health Past 24h","transparent":true,"type":"singlestat","valueFontSize":"110%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"avg"},{"cacheTimeout":null,"colorBackground":false,"colorValue":true,"colors":["#d44a3a","rgba(237, 129, 40, 0.89)","#299c46"],"datasource":"Global","decimals":1,"description":"The percentage of time no alerts were sent out.","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"format":"percent","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"gridPos":{"h":3,"w":8,"x":16,"y":1},"height":"100","id":24,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"dsType":"influxdb","expr":"sum(avg_over_time(up{environment=\"$environment\", tier=\"db\", type=\"$type\", job=\"node\"}[1w])) / count(up{environment=\"$environment\", tier=\"db\", type=\"$type\", job=\"node\"}) * 100","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"instant":true,"interval":"","intervalFactor":2,"legendFormat":"","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":"95,99","title":"Health Past 7d","transparent":true,"type":"singlestat","valueFontSize":"110%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"avg"},{"columns":[],"datasource":"$prometheus","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"fontSize":"80%","gridPos":{"h":5,"w":24,"x":0,"y":4},"height":"225px","id":26,"links":[],"pageSize":4,"scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"scroll":true,"showHeader":true,"sort":{"col":0,"desc":true},"styles":[{"alias":"Time","align":"auto","dateFormat":"YYYY-MM-DD HH:mm:ss","pattern":"Time","type":"date"},{"alias":"","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"__name__","thresholds":[],"type":"hidden","unit":"short"},{"alias":"","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"environment","thresholds":[],"type":"hidden","unit":"short"},{"alias":"","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"job","thresholds":[],"type":"hidden","unit":"short"},{"alias":"","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"server","thresholds":[],"type":"hidden","unit":"short"},{"alias":"","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"tier","thresholds":[],"type":"hidden","unit":"short"},{"alias":"","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"type","thresholds":[],"type":"hidden","unit":"short"},{"alias":"","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"instance","thresholds":[],"type":"hidden","unit":"short"},{"alias":"","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"pager","thresholds":[],"type":"hidden","unit":"short"},{"alias":"","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"Value","thresholds":[],"type":"hidden","unit":"short"},{"alias":"","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"channel","thresholds":[],"type":"hidden","unit":"short"},{"alias":"","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"alertstate","thresholds":[],"type":"hidden","unit":"short"},{"alias":"","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"datid","thresholds":[],"type":"hidden","unit":"short"},{"alias":"","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"decimals":2,"pattern":"/.*/","thresholds":[""],"type":"number","unit":"short"}],"targets":[{"dsType":"influxdb","expr":"ALERTS{alertname=~\"PostgreSQL.*\",environment=\"$environment\",alertstate=\"firing\"}","format":"table","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"instant":false,"interval":"5m","intervalFactor":1,"orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"title":"Alerts","transform":"table","transparent":true,"type":"table-old"},{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":9},"id":39,"panels":[],"repeat":"type","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"title":"Overview ($type)","type":"row"},{"cacheTimeout":null,"colorBackground":false,"colorValue":true,"colors":["rgba(50, 172, 45, 0.97)","rgba(237, 129, 40, 0.89)","rgba(245, 54, 54, 0.9)"],"datasource":"$prometheus","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"format":"none","gauge":{"maxValue":300,"minValue":0,"show":true,"thresholdLabels":false,"thresholdMarkers":true},"gridPos":{"h":4,"w":6,"x":0,"y":10},"height":"","id":17,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"dsType":"influxdb","expr":"max(pg_stat_activity_count{datname=\"gitlabhq_production\", environment=\"$environment\", tier=\"db\", type=\"$type\"} and on(instance) pg_replication_is_replica==0)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"","policy":"default","query":"SELECT mean(\"value\") FROM \"measurement\" WHERE $timeFilter GROUP BY time($__interval) fill(null)","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":240,"tags":[]}],"thresholds":"255,275","title":"Primary Total Connections","type":"singlestat","valueFontSize":"80%","valueMaps":[],"valueName":"current"},{"cacheTimeout":null,"colorBackground":false,"colorValue":true,"colors":["rgba(50, 172, 45, 0.97)","rgba(237, 129, 40, 0.89)","rgba(245, 54, 54, 0.9)"],"datasource":"Global","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"format":"none","gauge":{"maxValue":200,"minValue":0,"show":true,"thresholdLabels":false,"thresholdMarkers":true},"gridPos":{"h":4,"w":4,"x":6,"y":10},"height":"","id":18,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"dsType":"influxdb","expr":"max(pg_stat_activity_count{datname=\"gitlabhq_production\", environment=\"$environment\", tier=\"db\", type=\"$type\", state=\"active\"} and ON(instance) pg_replication_is_replica==0)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"","policy":"default","query":"SELECT mean(\"value\") FROM \"measurement\" WHERE $timeFilter GROUP BY time($__interval) fill(null)","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":240,"tags":[]}],"thresholds":"50,100,150","title":"Primary Active Connections","type":"singlestat","valueFontSize":"80%","valueMaps":[],"valueName":"current"},{"cacheTimeout":null,"colorBackground":false,"colorValue":true,"colors":["rgba(50, 172, 45, 0.97)","rgba(237, 129, 40, 0.89)","rgba(245, 54, 54, 0.9)"],"datasource":"Global","decimals":null,"fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"format":"percentunit","gauge":{"maxValue":100,"minValue":0,"show":true,"thresholdLabels":false,"thresholdMarkers":true},"gridPos":{"h":4,"w":4,"x":10,"y":10},"height":"","id":19,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"dsType":"influxdb","expr":"max(sum(instance_cpu:node_cpu_not_idle:rate5m{tier=\"db\"} and  on (fqdn) pg_replication_is_replica==0) without (cpu) / instance:node_cpus:count)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"","policy":"default","query":"SELECT mean(\"value\") FROM \"measurement\" WHERE $timeFilter GROUP BY time($__interval) fill(null)","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":240,"tags":[]}],"thresholds":"30,50,80","title":"Primary CPU Usage","type":"singlestat","valueFontSize":"80%","valueMaps":[],"valueName":"current"},{"cacheTimeout":null,"colorBackground":false,"colorValue":true,"colors":["rgba(50, 172, 45, 0.97)","rgba(237, 129, 40, 0.89)","rgba(245, 54, 54, 0.9)"],"datasource":"$prometheus","decimals":null,"fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"format":"none","gauge":{"maxValue":32,"minValue":0,"show":true,"thresholdLabels":false,"thresholdMarkers":true},"gridPos":{"h":4,"w":4,"x":14,"y":10},"height":"","id":21,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"dsType":"influxdb","expr":"max(node_load1{environment=\"$environment\", tier=\"db\", type=\"$type\"} and on (fqdn) pg_replication_is_replica==0)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"","policy":"default","query":"SELECT mean(\"value\") FROM \"measurement\" WHERE $timeFilter GROUP BY time($__interval) fill(null)","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":240,"tags":[]}],"thresholds":"10,15","title":"Primary Load Average","type":"singlestat","valueFontSize":"80%","valueMaps":[],"valueName":"current"},{"cacheTimeout":null,"colorBackground":false,"colorValue":true,"colors":["rgba(50, 172, 45, 0.97)","rgba(237, 129, 40, 0.89)","rgba(245, 54, 54, 0.9)"],"datasource":"$prometheus","decimals":null,"fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"format":"decbytes","gauge":{"maxValue":1073741824,"minValue":0,"show":true,"thresholdLabels":false,"thresholdMarkers":true},"gridPos":{"h":4,"w":6,"x":18,"y":10},"height":"","id":20,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"dsType":"influxdb","expr":"max(pg_stat_replication_pg_xlog_location_diff{environment=\"$environment\", tier=\"db\", type=\"$type\"} and on (instance) pg_replication_is_replica==0)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":1,"legendFormat":"","policy":"default","query":"SELECT mean(\"value\") FROM \"measurement\" WHERE $timeFilter GROUP BY time($__interval) fill(null)","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":120,"tags":[]}],"thresholds":"52428800,524288000,1073741824","title":"Replication Lag Size","type":"singlestat","valueFontSize":"80%","valueMaps":[],"valueName":"current"},{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":14},"id":40,"panels":[],"repeat":"type","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"title":"Processes \u0026 Transactions ($type)","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$prometheus","editable":true,"error":false,"fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":8,"x":0,"y":15},"height":"","hiddenSeries":false,"id":1,"legend":{"alignAsTable":false,"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":false,"min":false,"rightSide":false,"show":false,"sideWidth":null,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"alertThreshold":true},"paceLength":10,"percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg_over_time(pg_stat_activity_count{datname=\"gitlabhq_production\", env=\"$environment\", tier=\"db\", type=\"$type\"}[$__interval])","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":1,"legendFormat":"{{fqdn}} - {{state}}","metric":"pg_stat_activity_count","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":15,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Process Activity Count","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:1190","format":"short","label":null,"logBase":1,"max":"300","min":"0","show":true},{"$$hashKey":"object:1191","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$prometheus","editable":true,"error":false,"fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":8,"x":8,"y":15},"height":"","hiddenSeries":false,"id":29,"legend":{"alignAsTable":false,"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":false,"min":false,"rightSide":false,"show":false,"sideWidth":null,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"alertThreshold":true},"paceLength":10,"percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(avg_over_time(pg_stat_activity_count{datname=\"gitlabhq_production\", env=\"$environment\", tier=\"db\", type=\"$type\"}[$__interval])) by (fqdn)","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":1,"legendFormat":"{{fqdn}}","metric":"pg_stat_activity_count","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":15,"tags":[]}],"thresholds":[{"colorMode":"critical","fill":true,"line":true,"op":"gt","value":285}],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Process Activity Total by Host","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:1244","decimals":null,"format":"short","label":null,"logBase":1,"max":"300","min":null,"show":true},{"$$hashKey":"object:1245","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$prometheus","editable":true,"error":false,"fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":8,"x":16,"y":15},"hiddenSeries":false,"id":5,"legend":{"alignAsTable":false,"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":false,"min":false,"rightSide":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"alertThreshold":true},"paceLength":10,"percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"seriesOverrides":[{"$$hashKey":"object:1298","alias":"/rolled/","dashLength":1,"dashes":true,"spaceLength":1,"yaxis":2}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"rate(pg_stat_database_xact_commit{datname=\"gitlabhq_production\", env=\"$environment\", tier=\"db\", type=\"$type\"}[$__rate_interval])","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"30s","intervalFactor":1,"legendFormat":"{{fqdn}} committed","metric":"pg_stat_database_xact_","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":15,"tags":[]},{"expr":"rate(pg_stat_database_xact_rollback{datname=\"gitlabhq_production\", environment=\"$environment\", tier=\"db\", type=\"$type\"}[$__interval])","format":"time_series","interval":"30s","intervalFactor":1,"legendFormat":"{{fqdn}} rolled back","refId":"B","step":15}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Transactions","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:1311","format":"ops","label":"Committed","logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:1312","decimals":null,"format":"ops","label":"Rolled Back","logBase":1,"max":null,"min":"0","show":true}],"yaxis":{"align":false,"alignLevel":null}},{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":22},"id":41,"panels":[],"repeat":"type","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"title":"Errors and Locks ($type)","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$prometheus","editable":true,"error":false,"fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":2,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":12,"x":0,"y":23},"hiddenSeries":false,"id":3,"legend":{"alignAsTable":false,"avg":false,"current":false,"max":false,"min":false,"rightSide":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"alertThreshold":true},"paceLength":10,"percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(rate(postgresql_errors_total{env=\"$environment\"}[$__rate_interval]) * 60) by (type)","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":1,"legendFormat":"{{type}}","metric":"pg_locks_count","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":5,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Errors","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:1366","format":"opm","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:1367","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$prometheus","editable":true,"error":false,"fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":2,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":12,"x":12,"y":23},"hiddenSeries":false,"id":33,"legend":{"alignAsTable":false,"avg":false,"current":false,"max":false,"min":false,"rightSide":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"alertThreshold":true},"paceLength":10,"percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"rate(pgbouncer_errors_count{env=\"$environment\",type=\"$type\",errmsg!~\"invalid command.*\"}[$__rate_interval]) \u003e 0 * 60","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":1,"legendFormat":"{{fqdn}}: {{errmsg}}","metric":"pg_locks_count","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":5,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"PGBouncer Errors","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:1421","format":"opm","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:1422","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","editable":true,"error":false,"fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":2,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":12,"x":0,"y":30},"hiddenSeries":false,"id":34,"legend":{"alignAsTable":false,"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":false,"min":false,"rightSide":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"alertThreshold":true},"paceLength":10,"percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"rate(postgresql_lock_waits_total{env=\"$environment\", type=\"$type\"}[$__rate_interval]) * 60","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"1m","intervalFactor":1,"legendFormat":"{{mode}} on {{locktype}}","metric":"pg_locks_count","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":5,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Slow Lock Acquires","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:1476","decimals":null,"format":"opm","label":null,"logBase":1,"max":null,"min":null,"show":true},{"$$hashKey":"object:1477","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$prometheus","editable":true,"error":false,"fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":1,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":12,"x":12,"y":30},"hiddenSeries":false,"id":35,"legend":{"alignAsTable":false,"avg":false,"current":false,"max":false,"min":false,"rightSide":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"alertThreshold":true},"paceLength":10,"percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(rate(pg_locks_count{env=\"$environment\", type=\"$type\"}[$__rate_interval]) * 60) by (mode)","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"1m","intervalFactor":1,"legendFormat":"{{mode}}","metric":"pg_locks_count","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":5,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Locks across all hosts","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:1576","decimals":0,"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:1577","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":37},"id":42,"panels":[],"repeat":"type","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"title":"Load ($type)","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$prometheus","fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":0,"y":38},"hiddenSeries":false,"id":13,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"paceLength":10,"percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg_over_time(instance:node_cpu_utilization:ratio{env=\"$environment\", tier=\"db\", type=\"$type\"}[$__interval])","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":1,"legendFormat":"{{fqdn}}","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":30,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"DB CPU Percent","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:1032","format":"percentunit","label":"","logBase":1,"max":"1","min":"0","show":true},{"$$hashKey":"object:1033","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","editable":true,"error":false,"fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":12,"x":12,"y":38},"height":"","hiddenSeries":false,"id":9,"legend":{"alignAsTable":false,"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"alertThreshold":true},"paceLength":10,"percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg_over_time(node_load1{env=\"$environment\", tier=\"db\", type=\"$type\"}[$__interval])","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":1,"legendFormat":"{{fqdn}}","metric":"node_load1","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":15,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Database Host Load","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:1901","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"$$hashKey":"object:1902","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":45},"id":43,"panels":[],"repeat":"type","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"title":"Storage \u0026 Memory ($type)","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$prometheus","decimals":2,"editable":true,"error":false,"fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":10,"w":8,"x":0,"y":46},"hiddenSeries":false,"id":10,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"alertThreshold":true},"paceLength":10,"percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg_over_time(node_filesystem_size_bytes{env=\"$environment\", tier=\"db\", type=\"$type\", mountpoint=\"/var/opt/gitlab\"}[$__interval]) - avg_over_time(node_filesystem_free_bytes{env=\"$environment\", tier=\"db\", type=\"$type\", mountpoint=\"/var/opt/gitlab\"}[$__interval])","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":1,"legendFormat":"{{fqdn}}","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":30,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Storage Used","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:1955","format":"bytes","label":null,"logBase":1,"max":null,"min":null,"show":true},{"$$hashKey":"object:1956","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$prometheus","editable":true,"error":false,"fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":10,"w":8,"x":8,"y":46},"hiddenSeries":false,"id":12,"legend":{"alignAsTable":true,"avg":false,"current":true,"hideEmpty":true,"hideZero":true,"max":false,"min":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"alertThreshold":true},"paceLength":10,"percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg_over_time(node_memory_MemTotal_bytes{env=\"$environment\", tier=\"db\", type=\"$type\"}[$__interval]) - avg_over_time(node_memory_MemFree_bytes{env=\"$environment\", tier=\"db\", type=\"$type\"}[$__interval])","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"interval":"","intervalFactor":1,"legendFormat":"{{fqdn}}","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":30,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Memory (Total - Free)","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:152","format":"bytes","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:153","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$prometheus","editable":true,"error":false,"fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":10,"w":8,"x":16,"y":46},"hiddenSeries":false,"id":60,"legend":{"alignAsTable":true,"avg":false,"current":true,"hideEmpty":true,"hideZero":true,"max":false,"min":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"alertThreshold":true},"paceLength":10,"percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg_over_time(node_memory_MemTotal_bytes{env=\"$environment\", tier=\"db\", type=\"$type\"}[$__interval]) - avg_over_time(node_memory_MemAvailable_bytes{env=\"$environment\", tier=\"db\", type=\"$type\"}[$__interval])","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"interval":"","intervalFactor":1,"legendFormat":"{{fqdn}}","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":30,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Memory (Total - Available)","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:152","format":"bytes","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:153","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$prometheus","description":"The number of bytes per second loaded into memory by minor page faults.","editable":true,"error":false,"fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":10,"w":8,"x":0,"y":56},"hiddenSeries":false,"id":61,"legend":{"alignAsTable":true,"avg":false,"current":true,"hideEmpty":true,"hideZero":true,"max":false,"min":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"alertThreshold":true},"paceLength":10,"percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"rate(node_vmstat_pgfault{env=\"$environment\", tier=\"db\", type=\"$type\"}[$__rate_interval]) * 4096","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"interval":"","intervalFactor":1,"legendFormat":"{{fqdn}}","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":30,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"VMStat Minor Page Faults","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:152","format":"Bps","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:153","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$prometheus","description":"The number of bytes per second loaded into memory by Major page faults.","editable":true,"error":false,"fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":10,"w":8,"x":8,"y":56},"hiddenSeries":false,"id":62,"legend":{"alignAsTable":true,"avg":false,"current":true,"hideEmpty":true,"hideZero":true,"max":false,"min":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"alertThreshold":true},"paceLength":10,"percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"rate(node_vmstat_pgmajfault{env=\"$environment\", tier=\"db\", type=\"$type\"}[$__rate_interval]) * 4096","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"interval":"","intervalFactor":1,"legendFormat":"{{fqdn}}","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":30,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"VMStat Major Page Faults","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:152","format":"Bps","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:153","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$prometheus","description":"Total storage used for tables with all associated indexes, space maps, toast storage","fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":10,"w":8,"x":16,"y":56},"hiddenSeries":false,"id":23,"interval":"10s","legend":{"alignAsTable":true,"avg":false,"current":true,"max":true,"min":true,"show":true,"sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"paceLength":10,"percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"topk(20, avg_over_time(pg_total_relation_size_bytes{env=\"$environment\", tier=\"db\", type=\"$type\"}[$__interval]) and on (instance) pg_replication_is_replica{env=\"$environment\", tier=\"db\", type=\"$type\"}==0 )\n","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["0"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"{{schemaname}}.{{relname}}","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["pg_total_relation_size_bytes"],"type":"field"},{"params":[],"type":"mean"}]],"step":20,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Table Size (Top 20 Tables)","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:2217","format":"bytes","label":"Table Storage Size","logBase":1,"max":null,"min":null,"show":true},{"$$hashKey":"object:2218","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}],"yaxis":{"align":false,"alignLevel":null}},{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":66},"id":44,"panels":[],"repeat":"type","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"title":"Disk Access ($type)","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$prometheus","editable":true,"error":false,"fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":8,"x":0,"y":67},"hiddenSeries":false,"id":6,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"alertThreshold":true},"paceLength":10,"percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(rate(node_disk_read_time_seconds_total{env=\"$environment\", tier=\"db\", type=\"$type\", device=\"sda\"}[$__rate_interval])) by (fqdn)","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":1,"legendFormat":"{{fqdn}} reads","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":15,"tags":[]},{"dsType":"influxdb","expr":"sum(rate(node_disk_write_time_seconds_total{environment=\"$environment\", tier=\"db\", type=\"$type\", device=~\"sda\"}[5m])) by (fqdn)","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":1,"legendFormat":"{{fqdn}} writes","metric":"","policy":"default","refId":"B","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":15,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"disk IO wait sda","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:2330","format":"s","label":null,"logBase":1,"max":null,"min":null,"show":true},{"$$hashKey":"object:2331","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$prometheus","editable":true,"error":false,"fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":8,"x":8,"y":67},"hiddenSeries":false,"id":48,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"alertThreshold":true},"paceLength":10,"percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(rate(node_disk_read_time_seconds_total{env=\"$environment\", tier=\"db\", type=\"$type\", device=\"sdb\"}[$__rate_interval])) by (fqdn)","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":1,"legendFormat":"{{fqdn}} reads","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":15,"tags":[]},{"dsType":"influxdb","expr":"sum(rate(node_disk_write_time_seconds_total{environment=\"$environment\", tier=\"db\", type=\"$type\", device=~\"sdb\"}[5m])) by (fqdn)","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":1,"legendFormat":"{{fqdn}} writes","metric":"","policy":"default","refId":"B","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":15,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"disk IO wait sdb","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:2384","format":"s","label":null,"logBase":1,"max":null,"min":null,"show":true},{"$$hashKey":"object:2385","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$prometheus","editable":true,"error":false,"fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":8,"x":16,"y":67},"hiddenSeries":false,"id":49,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"alertThreshold":true},"paceLength":10,"percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(rate(node_disk_read_time_seconds_total{env=\"$environment\", tier=\"db\", type=\"$type\", device=\"sdc\"}[$__rate_interval])) by (fqdn)","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":1,"legendFormat":"{{fqdn}} reads","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":15,"tags":[]},{"dsType":"influxdb","expr":"sum(rate(node_disk_write_time_seconds_total{environment=\"$environment\", tier=\"db\", type=\"$type\", device=~\"sdc\"}[5m])) by (fqdn)","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":1,"legendFormat":"{{fqdn}} writes","metric":"","policy":"default","refId":"B","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":15,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"disk IO wait sdc","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:2438","format":"s","label":null,"logBase":1,"max":null,"min":null,"show":true},{"$$hashKey":"object:2439","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$prometheus","fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":6,"w":8,"x":0,"y":74},"hiddenSeries":false,"id":14,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"paceLength":10,"percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"rate(node_disk_io_time_seconds_total{environment=\"$environment\", tier=\"db\", type=\"$type\", device=~\"sda\"}[2m])","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"{{fqdn}}","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":30,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Disk IO Utilization sda","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":null,"logBase":1,"max":"1","min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$prometheus","fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":6,"w":8,"x":8,"y":74},"hiddenSeries":false,"id":50,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"paceLength":10,"percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"rate(node_disk_io_time_seconds_total{environment=\"$environment\", tier=\"db\", type=\"$type\", device=~\"sdb\"}[$__interval])","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"1m","intervalFactor":1,"legendFormat":"{{fqdn}}","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":30,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Disk IO Utilization sdb","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":null,"logBase":1,"max":"1","min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$prometheus","fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":6,"w":8,"x":16,"y":74},"hiddenSeries":false,"id":51,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"paceLength":10,"percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"rate(node_disk_io_time_seconds_total{environment=\"$environment\", tier=\"db\", type=\"$type\", device=~\"sdc\"}[2m])","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"{{fqdn}}","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":30,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Disk IO Utilization sdc","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":null,"logBase":1,"max":"1","min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$prometheus","editable":true,"error":false,"fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":8,"x":0,"y":80},"hiddenSeries":false,"id":4,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"alertThreshold":true},"paceLength":10,"percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"irate(pg_stat_database_blks_hit{datname=\"gitlabhq_production\", environment=\"$environment\", tier=\"db\", type=\"$type\"}[1m])","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":1,"legendFormat":"{{fqdn}} hits","metric":"pg_stat_database_blks_hit","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":15,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Disk Block Hits","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":87},"id":53,"panels":[],"repeat":"type","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"title":"Network throughput - transmit and error rate (outbound only) ($type)","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":null,"description":"","fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":1,"fillGradient":0,"gridPos":{"h":9,"w":24,"x":0,"y":88},"hiddenSeries":false,"id":57,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"rightSide":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.2.0","pointradius":2,"points":false,"renderer":"flot","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"rate(node_netstat_Tcp_OutSegs{environment=\"$environment\", type=\"$type\"}[1m])","format":"time_series","intervalFactor":1,"legendFormat":"{{fqdn}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Overall TCP transmit rate (outbound only)","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"TCP segments / minute","logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":null,"description":"Typically the Patroni primary db has a *much* higher TCP retransmit rate than the Patroni replica dbs, and the gap is much larger for retransmits than for overall network throughput.  This implies packet loss may occur more often for the Patroni primary db workload and may be a sign that some portion of the current IaaS packet processing pipeline may become saturated during peak workload.  The inferred packet loss may affect some flows/network paths more than others.","fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":1,"fillGradient":0,"gridPos":{"h":9,"w":24,"x":0,"y":97},"id":55,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"rightSide":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pluginVersion":"7.2.0","pointradius":2,"points":false,"renderer":"flot","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"rate(node_netstat_Tcp_RetransSegs{environment=\"$environment\", type=\"$type\"}[$__interval])","format":"time_series","interval":"30s","intervalFactor":1,"legendFormat":"{{fqdn}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Retransmit rate (outbound only), resending possibly lost packets","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"pps","label":"TCP segments","logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":null,"description":"TCP SYN retransmits never occur sooner than after 1 second delay, so they always add significant latency to the affected connection attempt.  They could indicate packet loss or downtime for the remote listener endpoint.  Anecdotally, the Patroni nodes overall TCP retransmit rate (inferred packet loss) is usually correlated with workload spikes, but SYN retransmits typically have a stable low flat rate with no bursts.","fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":1,"fillGradient":0,"gridPos":{"h":9,"w":24,"x":0,"y":106},"id":59,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"rightSide":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pluginVersion":"7.2.0","pointradius":2,"points":false,"renderer":"flot","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"rate(node_netstat_TcpExt_TCPSynRetrans{environment=\"$environment\", type=\"$type\"}[$__interval])","format":"time_series","interval":"30s","intervalFactor":1,"legendFormat":"{{fqdn}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"TCP SYN Retransmit Rate","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"pps","label":"TCP SYN retransmits","logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":115},"id":45,"panels":[],"repeat":"type","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"title":"Checkpoints ($type)","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","editable":true,"error":false,"fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"fill":0,"grid":{},"gridPos":{"h":7,"w":12,"x":0,"y":116},"id":7,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","paceLength":10,"percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"rate(pg_stat_bgwriter_checkpoint_write_time{environment=\"$environment\", tier=\"db\", type=\"$type\"}[$__interval])","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"5m","intervalFactor":1,"legendFormat":"{{fqdn}} write","metric":"pg_stat_bgwriter_checkpoint","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":15,"tags":[]},{"expr":"rate(pg_stat_bgwriter_checkpoint_sync_time{environment=\"$environment\", tier=\"db\", type=\"$type\"}[$__interval])","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"{{fqdn}} sync","metric":"pg_stat_bgwriter_checkpoint_sync_time","refId":"B","step":15}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Checkpoint Times","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$prometheus","editable":true,"error":false,"fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"fill":0,"grid":{},"gridPos":{"h":7,"w":12,"x":12,"y":116},"id":8,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","paceLength":10,"percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"rate(pg_stat_bgwriter_checkpoints_req{environment=\"$environment\", tier=\"db\", type=\"$type\"}[60m])*60","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"interval":"","intervalFactor":1,"legendFormat":"{{fqdn}} requested","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":15,"tags":[]},{"expr":"rate(pg_stat_bgwriter_checkpoints_timed{environment=\"$environment\", tier=\"db\", type=\"$type\"}[60m])*60","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"{{fqdn}} scheduled","metric":"pg_stat_bgwriter_checkpoints_timed","refId":"B","step":15}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Performed Checkpoints","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"opm","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":123},"id":46,"panels":[],"repeat":"type","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"title":"Replication Lag Time ($type)","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$prometheus","editable":true,"error":false,"fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"fill":0,"grid":{},"gridPos":{"h":7,"w":8,"x":0,"y":124},"id":11,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"maxPerRow":2,"nullPointMode":"connected","paceLength":10,"percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(pg_stat_replication_pg_xlog_location_diff{environment=\"$environment\", tier=\"db\", type=\"$type\"}) by (client_addr)","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":1,"legendFormat":"{{slot_name}} - {{client_addr}}","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":15,"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Replication Lag Size","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$prometheus","editable":true,"error":false,"fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"fill":0,"grid":{},"gridPos":{"h":7,"w":8,"x":8,"y":124},"id":16,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"maxPerRow":2,"nullPointMode":"connected","paceLength":10,"percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"pg_replication_lag{environment=\"$environment\", tier=\"db\", type=\"$type\"} and pg_replication_is_replica==1","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":1,"legendFormat":"{{fqdn}}","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":15,"tags":[]}],"thresholds":[{"colorMode":"warning","fill":true,"line":true,"op":"gt","value":60},{"colorMode":"critical","fill":true,"line":true,"op":"gt","value":120}],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Replication Lag Time","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":null,"format":"none","label":"","logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$prometheus","description":"The number of query conflicts occurring on secondaries","editable":true,"error":false,"fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"fill":0,"grid":{},"gridPos":{"h":7,"w":8,"x":16,"y":124},"id":15,"legend":{"avg":false,"current":false,"hideEmpty":false,"hideZero":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"maxPerRow":2,"nullPointMode":"connected","paceLength":10,"percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","scopedVars":{"type":{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"}},"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"rate(pg_stat_database_conflicts{datname=\"gitlabhq_production\", environment=\"$environment\", tier=\"db\", type=\"$type\"}[1m]) * 60","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{fqdn}}","refId":"D","step":60}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Query Conflicts","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"opm","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":131},"id":47,"panels":[],"repeat":null,"title":"PGBouncer","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$prometheus","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"fill":1,"gridPos":{"h":7,"w":12,"x":0,"y":132},"id":30,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","paceLength":10,"percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"rate(pgbouncer_query_wait_timeout_total{environment=\"$environment\"}[1m])","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"{{fqdn}}","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Query Wait Timeouts","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ops","label":"","logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$prometheus","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"fill":1,"gridPos":{"h":7,"w":12,"x":12,"y":132},"id":32,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","paceLength":10,"percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"rate(pgbouncer_cant_connect_to_server_total{environment=\"$environment\"}[1m])","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"{{fqdn}}","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Server Connection Errors","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ops","label":"","logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"refresh":false,"schemaVersion":26,"style":"dark","tags":["postgresql","patroni","triage"],"templating":{"list":[{"current":{"text":"prometheus-01-inf-gprd","value":"prometheus-01-inf-gprd"},"hide":2,"includeAll":false,"label":null,"multi":false,"name":"prometheus","options":[],"query":"prometheus","refresh":1,"regex":"Global","skipUrlSync":false,"type":"datasource"},{"allValue":null,"current":{"tags":[],"text":"gprd","value":"gprd"},"hide":0,"includeAll":false,"label":"Environment","multi":false,"name":"environment","options":[{"$$hashKey":"object:959","selected":false,"text":"gprd","value":"gprd"},{"$$hashKey":"object:960","selected":true,"text":"gstg","value":"gstg"},{"$$hashKey":"object:961","selected":false,"text":"dr","value":"dr"}],"query":"gprd,gstg,dr","skipUrlSync":false,"type":"custom"},{"allValue":null,"current":{"tags":[],"text":"patroni","value":"patroni"},"hide":0,"includeAll":false,"label":null,"multi":false,"name":"type","options":[{"$$hashKey":"object:936","selected":true,"text":"patroni","value":"patroni"},{"$$hashKey":"object:937","selected":false,"text":"postgres11","value":"postgres11"},{"$$hashKey":"object:938","selected":false,"text":"postgres-delayed","value":"postgres-delayed"},{"$$hashKey":"object:939","selected":false,"text":"postgres-archive","value":"postgres-archive"}],"query":"patroni, postgres11, postgres-delayed, postgres-archive","skipUrlSync":false,"type":"custom"}]},"time":{"from":"now-3h","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"utc","title":"PostgreSQL Overview","uid":"000000144","version":53}}