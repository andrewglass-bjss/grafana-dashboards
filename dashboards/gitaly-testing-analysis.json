{"meta":{"type":"db","canSave":true,"canEdit":true,"canAdmin":true,"canStar":true,"slug":"gitaly-testing-analysis","url":"/d/000000190/gitaly-testing-analysis","expires":"0001-01-01T00:00:00Z","created":"2017-05-31T12:22:58Z","updated":"2018-07-10T13:35:00Z","updatedBy":"ops-contact@gitlab.com","createdBy":"ops-contact@gitlab.com","version":17,"hasAcl":false,"isFolder":false,"folderId":310,"folderTitle":"Gitaly Dashboards","folderUrl":"/dashboards/f/eVNL3GOmk/gitaly-dashboards","provisioned":false},"dashboard":{"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations \u0026 Alerts","type":"dashboard"},{"datasource":"Prometheus in Azure","enable":true,"expr":"sum(irate(grpc_server_handled_total{fqdn=~\"^nfs-file.*\"}[1m])) \u003e bool 0.5","hide":false,"iconColor":"rgba(255, 96, 96, 1)","limit":100,"name":"nfs_requests","showIn":0,"step":"10m","type":"alert"}]},"editable":true,"gnetId":null,"graphTooltip":0,"id":null,"links":[],"panels":[{"collapsed":false,"gridPos":{"h":7,"w":24,"x":0,"y":0},"id":8,"panels":[],"repeat":null,"title":"Dashboard Row","type":"row"},{"aliasColors":{"Smoothed: Non-idle CPU Usage":"#58140C","Unsmoothed: Non-idle CPU Usage":"#EAB839"},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":0,"gridPos":{"h":7,"w":24,"x":0,"y":1},"id":1,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"Unsmoothed: Non-idle CPU Usage","yaxis":1}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"avg(instance_cpu:node_cpu_not_idle:rate5m{fqdn=~\"^nfs.*\"})","format":"time_series","hide":false,"intervalFactor":2,"legendFormat":"Unsmoothed: Non-idle CPU Usage","refId":"B","step":10},{"dsType":"influxdb","expr":"avg(holt_winters(instance_cpu:node_cpu_not_idle:rate5m{fqdn=~\"^nfs.*\"}[5m],0.2, 0.9))","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"Smoothed: Non-idle CPU Usage","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":10,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"CPU Utilisation, NFS Servers","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"","logBase":1,"max":"0.1","min":"0.04","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"collapsed":false,"gridPos":{"h":7,"w":24,"x":0,"y":8},"id":9,"panels":[],"repeat":null,"title":"Dashboard Row","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"gridPos":{"h":7,"w":24,"x":0,"y":9},"id":2,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(irate(grpc_server_handled_total{fqdn=~\"^nfs-file.*\"}[1m])) by (fqdn)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"intervalFactor":2,"legendFormat":"{{fqdn}}","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":10,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"GRPC Method Calls to File Servers","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"collapsed":false,"gridPos":{"h":7,"w":24,"x":0,"y":16},"id":10,"panels":[],"repeat":null,"title":"Dashboard Row","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":0,"gridPos":{"h":7,"w":24,"x":0,"y":17},"id":3,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg(1 - irate(node_cpu{fqdn=~\"^git01.fe.*\", mode=\"idle\"}[10m]))","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"git01","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":10,"tags":[]},{"expr":"avg(1 - irate(node_cpu{fqdn=~\"^git(02|03|04|05|06|07|08|09|10).fe.*\", mode=\"idle\"}[10m]))","format":"time_series","interval":"","intervalFactor":2,"legendFormat":"rest of git fleet","refId":"B","step":10}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Worker CPU Utilisation","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"","logBase":1,"max":"1","min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"collapsed":true,"gridPos":{"h":7,"w":24,"x":0,"y":24},"id":11,"panels":[],"repeat":null,"title":"Dashboard Row","type":"row"},{"collapsed":false,"gridPos":{"h":7,"w":24,"x":0,"y":25},"id":12,"panels":[],"repeat":null,"title":"Dashboard Row","type":"row"},{"aliasColors":{"black:rest of fleet":"#58140C","red: git01":"#99440A"},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"gridPos":{"h":7,"w":24,"x":0,"y":26},"id":4,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg(holt_winters(instance_cpu:node_cpu_not_idle:rate5m{fqdn=\"git01.fe.gitlab.com\"}[5m],0.1, 0.9))","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"interval":"","intervalFactor":2,"legendFormat":"red: git01","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":10,"tags":[]},{"expr":"avg(holt_winters(instance_cpu:node_cpu_not_idle:rate5m{fqdn=~\"^git(02|03|04|05|06|07|09|10).fe.gitlab.com\"}[5m],0.1, 0.9))","format":"time_series","hide":false,"interval":"","intervalFactor":2,"legendFormat":"black:rest of fleet","refId":"B","step":10}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"CPU Utilisation on Git Workers: Red vs Black","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"","logBase":1,"max":"0.75","min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"collapsed":false,"gridPos":{"h":7,"w":24,"x":0,"y":33},"id":13,"panels":[],"repeat":null,"title":"Dashboard Row","type":"row"},{"aliasColors":{"Now":"#58140C","Smoothed: Non-idle CPU Usage":"#58140C","Unsmoothed: Non-idle CPU Usage":"#EAB839","t-1d":"#447EBC","t-1w":"#DEDAF7"},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":0,"gridPos":{"h":7,"w":24,"x":0,"y":34},"id":5,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"Unsmoothed: Non-idle CPU Usage","yaxis":1}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"avg(instance_cpu:node_cpu_not_idle:rate5m{fqdn=~\"^nfs.*\"})","format":"time_series","hide":false,"intervalFactor":2,"legendFormat":"Now","refId":"B","step":10},{"expr":"avg(instance_cpu:node_cpu_not_idle:rate5m{fqdn=~\"^nfs.*\"} offset 1d) ","format":"time_series","hide":false,"intervalFactor":2,"legendFormat":"t-1d","refId":"A","step":10},{"expr":"avg(instance_cpu:node_cpu_not_idle:rate5m{fqdn=~\"^nfs.*\"} offset 1w) ","format":"time_series","intervalFactor":2,"legendFormat":"t-1w","refId":"C","step":10}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"CPU Utilisation, NFS Servers compared with t-1d, t-1w","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"","logBase":1,"max":"0.1","min":"0.04","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"collapsed":false,"gridPos":{"h":7,"w":24,"x":0,"y":41},"id":14,"panels":[],"repeat":null,"title":"Dashboard Row","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":0,"gridPos":{"h":7,"w":24,"x":0,"y":42},"id":6,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"   avg(instance:node_disk_reads_completed:irate1m{fqdn=~\"^nfs-file.*\"})","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"now","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":10,"tags":[]},{"expr":"   avg(instance:node_disk_reads_completed:irate1m{fqdn=~\"^nfs-file.*\"} offset 1d)","format":"time_series","intervalFactor":2,"legendFormat":"t-1d","refId":"B","step":10},{"expr":"   avg(instance:node_disk_reads_completed:irate1m{fqdn=~\"^nfs-file.*\"} offset 1w)","format":"time_series","intervalFactor":2,"legendFormat":"t-1w","refId":"C","step":10}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Disk Reads (with offsets)","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"collapsed":false,"gridPos":{"h":7,"w":24,"x":0,"y":49},"id":15,"panels":[],"repeat":null,"title":"Dashboard Row","type":"row"},{"aliasColors":{"black: control (not-git01)":"#890F02","red: test (git01)":"#7EB26D"},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"gridPos":{"h":7,"w":24,"x":0,"y":50},"id":7,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg(instance:node_disk_reads_completed:irate1m{fqdn=\"git01.fe.gitlab.com\"})","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"red: test (git01)","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":10,"tags":[]},{"expr":"avg(instance:node_disk_reads_completed:irate1m{fqdn=~\"^git(02|03|04|05|06|07|09|10).fe.gitlab.com\"})","format":"time_series","interval":"","intervalFactor":2,"legendFormat":"black: control (not-git01)","refId":"B","step":10}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Git Worker Disk Reads","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"","logBase":1,"max":"200","min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"refresh":false,"schemaVersion":16,"style":"dark","tags":[],"templating":{"list":[]},"time":{"from":"now-1h","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"utc","title":"Gitaly Testing Analysis","uid":"000000190","version":17}}