{"meta":{"type":"db","canSave":false,"canEdit":false,"canAdmin":false,"canStar":true,"slug":"workhorse-overview","url":"/d/OktWokpik/workhorse-overview","expires":"0001-01-01T00:00:00Z","created":"2018-08-15T11:51:55Z","updated":"2019-02-12T17:00:11Z","updatedBy":"ops-contact@gitlab.com","createdBy":"ops-contact@gitlab.com","version":27,"hasAcl":false,"isFolder":false,"folderId":195,"folderTitle":"Workhorse Service","folderUrl":"/dashboards/f/_OKcteIiz/workhorse-service","provisioned":false},"dashboard":{"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations \u0026 Alerts","type":"dashboard"}]},"editable":true,"gnetId":null,"graphTooltip":1,"id":null,"iteration":1549963407082,"links":[],"panels":[{"aliasColors":{"API - Target 10s, Acceptable 30s":"#ff0000","Web - Target 1s, Acceptable 10s":"#0000ff"},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","fill":0,"gridPos":{"h":9,"w":24,"x":0,"y":0},"id":82,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"avg_over_time(gitlab_component_apdex:ratio{environment=\"$env\",type=~\"$type\"}[$__interval])","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{type}}","refId":"A"},{"expr":"avg_over_time(gitlab_component_apdex:ratio{environment=\"$env\",type=~\"$type\"}[$__interval] offset 7d)","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{type}} - last week","refId":"B"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Combined Error + Latency Apdex Scores","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":null,"format":"percentunit","label":null,"logBase":1,"max":"1","min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":9},"id":8,"panels":[],"title":"HTTP Status Codes","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","fill":0,"gridPos":{"h":9,"w":24,"x":0,"y":10},"id":94,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"hideZero":true,"max":false,"min":true,"show":true,"sort":null,"sortDesc":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"1 -\n(\n  sum(avg_over_time(code_method:gitlab_workhorse_http_requests_total:rate1m{environment=\"$env\", type=~\"$type\", code=~\"^5.*\"}[$__interval])) by (type) \n  /  \n  sum(avg_over_time(code_method:gitlab_workhorse_http_requests_total:rate1m{environment=\"$env\", type=~\"$type\"}[$__interval])) by (type) \n)","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ type }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Workhorse Availability","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":4,"format":"percentunit","label":"Successful Requests","logBase":1,"max":"1","min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus-app-01-inf-gprd","fill":0,"gridPos":{"h":9,"w":24,"x":0,"y":19},"id":10,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"hideZero":true,"max":true,"min":false,"rightSide":true,"show":true,"sort":"avg","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"minSpan":4,"nullPointMode":"null as zero","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":"type","repeatDirection":"h","scopedVars":{"type":{"selected":true,"text":"web","value":"web"}},"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"\nsum without(code) (\n  label_replace(\n    label_replace(\n      avg_over_time(\n        code_method:gitlab_workhorse_http_requests_total:rate1m{environment=\"$env\", type=\"$type\"}[$__interval]\n      ), \n      \"class\", \"${1}XX\", \"code\", \"^(.).*\"\n    ),\n    \"route\", \"default\", \"route\", \"^$\"\n  )\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ class }}: {{ method  }} {{ route }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"$type: All HTTP Responses per Backend","tooltip":{"shared":false,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":28},"id":16,"panels":[],"repeat":null,"title":"5xx Server Errors","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","fill":0,"gridPos":{"h":9,"w":24,"x":0,"y":29},"id":21,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"rightSide":true,"show":true,"sort":"avg","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"minSpan":4,"nullPointMode":"null as zero","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":"type","repeatDirection":"h","scopedVars":{"type":{"selected":true,"text":"web","value":"web"}},"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"\nsum without(fqdn, instance) (\n  label_replace(\n    avg_over_time(\n      code_method:gitlab_workhorse_http_requests_total:rate1m{environment=\"$env\", type=\"$type\", code=~\"^5.*\"}[$__interval]\n    ),\n    \"route\", \"default\", \"route\", \"^$\"\n  )\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ code }}: {{ method  }} {{ route }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"$type: 5xx HTTP Responses per Backend","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":38},"id":6,"panels":[],"title":"Inflight Requests","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus-app-01-inf-gprd","fill":0,"gridPos":{"h":9,"w":24,"x":0,"y":39},"id":2,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":"type","repeatDirection":"h","scopedVars":{"type":{"selected":true,"text":"web","value":"web"}},"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum without (fqdn,instance) (gitlab_workhorse_http_in_flight_requests{environment=\"$env\", type=\"$type\"})","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{type}} - {{ stage }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"$type: Inflight Requests","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"Inflight Requests","logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":48},"id":29,"panels":[],"title":"Request Durations","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus-app-01-inf-gprd","fill":0,"gridPos":{"h":9,"w":24,"x":0,"y":49},"id":30,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"hideZero":true,"max":true,"min":false,"show":true,"sort":"avg","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"minSpan":4,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":"type","repeatDirection":"h","scopedVars":{"type":{"selected":true,"text":"web","value":"web"}},"seriesOverrides":[{"alias":"default","linewidth":2},{"alias":"^/api/","linewidth":2},{"alias":"/api\\/v4\\/jobs/","color":"#cccccc"}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"histogram_quantile(0.99, \n  sum(\n    label_replace(\n      rate(gitlab_workhorse_http_request_duration_seconds_bucket{environment=\"$env\", type=\"$type\", code=~\"^[25].*\", method!=\"head\", route!=\"^/api/v4/jobs/request\\\\z\"}[$__interval]),\n      \"route\", \"default\", \"route\", \"^$\"\n    )\n  ) by (route, le)\n)\n","format":"time_series","interval":"1m","intervalFactor":4,"legendFormat":"{{ route }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"$type: p99 Response Times (2XX, 5XX responses)","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":null,"logBase":10,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":58},"id":40,"panels":[],"title":"Request Payload Size","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","fill":0,"gridPos":{"h":9,"w":24,"x":0,"y":59},"id":51,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"minSpan":4,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":"type","repeatDirection":"h","scopedVars":{"type":{"selected":true,"text":"web","value":"web"}},"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"histogram_quantile(0.95, sum(rate(gitlab_workhorse_http_request_size_bytes_bucket{environment=\"$env\", type=\"$type\", code=~\"2.*\"}[$__interval])) by (le, method))","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ method }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"$type: p95 Request Size (2xx)","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":null,"format":"bytes","label":"Request Size","logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus-app-01-inf-gprd","fill":0,"gridPos":{"h":9,"w":24,"x":0,"y":68},"id":70,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"hideZero":true,"max":true,"min":false,"show":true,"sort":"current","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"minSpan":4,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":"type","repeatDirection":"h","scopedVars":{"type":{"selected":true,"text":"web","value":"web"}},"seriesOverrides":[{"alias":"default","linewidth":2},{"alias":"^/api/","linewidth":2},{"alias":"/api\\/v4\\/jobs/","color":"#cccccc"}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"histogram_quantile(0.99, \n  sum(\n    label_replace(\n      rate(gitlab_workhorse_http_time_to_write_header_seconds_bucket{environment=\"$env\", type=\"$type\", code=~\"2.*\"}[$__interval]),\n      \"route\", \"default\", \"route\", \"^$\"\n    )\n  ) by (route, le)\n)\n","format":"time_series","interval":"1m","intervalFactor":4,"legendFormat":"{{ route }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"$type: p99 Time-to-First-Byte","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":null,"format":"dtdurations","label":"Time to First Byte","logBase":10,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"refresh":"1m","schemaVersion":16,"style":"dark","tags":[],"templating":{"list":[{"allValue":null,"current":{"text":"gprd","value":"gprd"},"datasource":"prometheus-app-01-inf-gprd","definition":"","hide":0,"includeAll":false,"label":null,"multi":false,"name":"env","options":[{"selected":true,"text":"gprd","value":"gprd"}],"query":"label_values(gitlab_workhorse_http_requests_total, environment)","refresh":0,"regex":"","skipUrlSync":false,"sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"tags":[],"text":"web","value":"web"},"hide":0,"includeAll":true,"label":null,"multi":false,"name":"type","options":[{"selected":false,"text":"All","value":"$__all"},{"selected":true,"text":"web","value":"web"},{"selected":false,"text":"api","value":"api"},{"selected":false,"text":"git","value":"git"}],"query":"web,api,git","skipUrlSync":false,"type":"custom"}]},"time":{"from":"now-24h","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"","title":"Workhorse Overview","uid":"OktWokpik","version":27}}