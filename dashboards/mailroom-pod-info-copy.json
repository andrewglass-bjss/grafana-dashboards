{"meta":{"type":"db","canSave":true,"canEdit":true,"canAdmin":false,"canStar":true,"slug":"mailroom-pod-info-copy","url":"/d/Jk2uvIPMz/mailroom-pod-info-copy","expires":"0001-01-01T00:00:00Z","created":"2021-02-09T23:21:30Z","updated":"2021-02-09T23:21:30Z","updatedBy":"ops-contact@gitlab.com","createdBy":"ops-contact@gitlab.com","version":1,"hasAcl":false,"isFolder":false,"folderId":980,"folderTitle":"Playground - FOR TESTING PURPOSES ONLY","folderUrl":"/dashboards/f/playground-FOR-TESTING-ONLY/playground-for-testing-purposes-only","provisioned":false,"provisionedExternalId":""},"dashboard":{"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":false,"iconColor":"#96D98D","name":"deploy","showIn":0,"tags":["deploy","$environment"],"type":"tags"},{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":false,"iconColor":"#FFEE52","name":"canary-deploy","showIn":0,"tags":["deploy","${environment}-cny"],"type":"tags"},{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":false,"iconColor":"#CA95E5","name":"feature-flags","showIn":0,"tags":["feature-flag","${environment}"],"type":"tags"}]},"description":"Uploaded by https://gitlab.com/gitlab-com/runbooks/-/jobs/1019412073 at Tue Feb  9 22:30:40 UTC 2021","editable":true,"gnetId":null,"graphTooltip":1,"hideControls":false,"id":null,"iteration":1612912810132,"links":[],"panels":[{"collapse":false,"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":2,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Mailroom Version","titleSize":"h6","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":5,"w":12,"x":0,"y":1},"hiddenSeries":false,"id":3,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"count(kube_pod_container_info{pod=~\"^$Deployment.*\", container_id!=\"\", cluster=\"$cluster\", namespace=\"$namespace\"}) by (image)","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ image }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Active Version","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":5,"w":12,"x":12,"y":1},"hiddenSeries":false,"id":4,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":true,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"avg(kube_replicaset_spec_replicas{replicaset=~\"^$Deployment.*\", cluster=\"$cluster\", namespace=\"$namespace\"}) by (replicaset)","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ replicaset }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Active Replicaset","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}],"yaxis":{"align":false,"alignLevel":null}},{"collapse":false,"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":6},"id":5,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Deployment Info","titleSize":"h6","type":"row"},{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["#299c46","rgba(237, 129, 40, 0.89)","#d44a3a"],"datasource":"$PROMETHEUS_DS","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"format":"percent","gauge":{"maxValue":100,"minValue":0,"show":true,"thresholdLabels":false,"thresholdMarkers":true},"gridPos":{"h":5,"w":8,"x":0,"y":7},"id":6,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":null,"postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"expr":"sum (container_memory_working_set_bytes{env=~\"$environment\", pod=~\"^$Deployment.*$\", kubernetes_io_hostname=~\"^$Node$\", pod!=\"\", cluster=\"$cluster\", namespace=\"$namespace\"}) / sum (kube_node_status_allocatable_memory_bytes{env=~\"$environment\", node=~\"^$Node.*$\"}) * 100","format":true,"interval":"1m","intervalFactor":3,"legendFormat":"","refId":"A"}],"thresholds":"65,90","title":"Deployment Memory Usage","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"current"},{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["#299c46","rgba(237, 129, 40, 0.89)","#d44a3a"],"datasource":"$PROMETHEUS_DS","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"format":"percentunit","gauge":{"maxValue":1,"minValue":0,"show":true,"thresholdLabels":false,"thresholdMarkers":true},"gridPos":{"h":5,"w":8,"x":8,"y":7},"id":7,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":null,"postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"expr":"sum (rate (container_cpu_usage_seconds_total{env=~\"$environment\", pod=~\"^$Deployment.*$\", cluster=\"$cluster\", kubernetes_io_hostname=~\"^$Node$\"}[2m])) / sum (machine_cpu_cores{env=~\"$environment\", cluster=\"$cluster\", kubernetes_io_hostname=~\"^$Node$\"}) * 100","format":true,"interval":"1m","intervalFactor":3,"legendFormat":"","refId":"A"}],"thresholds":".65,.90","title":"Deployment CPU Usage","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"current"},{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["#299c46","rgba(237, 129, 40, 0.89)","#d44a3a"],"datasource":"$PROMETHEUS_DS","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"format":"percentunit","gauge":{"maxValue":100,"minValue":0,"show":true,"thresholdLabels":false,"thresholdMarkers":true},"gridPos":{"h":5,"w":8,"x":16,"y":7},"id":8,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":null,"postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"expr":"((sum(kube_deployment_status_replicas{env=~\"$environment\", deployment=~\".*$Deployment\", cluster=\"$cluster\", namespace=\"$namespace\"}) or vector(0)) - ((sum(kube_deployment_status_replicas_available{env=~\"$environment\", deployment=~\".*$Deployment\", cluster=\"$cluster\", namespace=\"$namespace\"}) or vector(0)))) / (sum(kube_deployment_status_replicas{env=~\"$environment\", deployment=~\".*$Deployment\", cluster=\"$cluster\", namespace=\"$namespace\"}) or vector(0))","format":true,"interval":"1m","intervalFactor":3,"legendFormat":"","refId":"A"}],"thresholds":"1,30","title":"Unavailable Replicas","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"current"},{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["#299c46","rgba(237, 129, 40, 0.89)","#d44a3a"],"datasource":"$PROMETHEUS_DS","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"format":"bytes","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"gridPos":{"h":3,"w":4,"x":0,"y":12},"id":9,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":null,"postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"expr":"sum (container_memory_working_set_bytes{env=~\"$environment\", pod=~\"^$Deployment.*$\", kubernetes_io_hostname=~\"^$Node$\", pod!=\"\", cluster=\"$cluster\", namespace=\"$namespace\"})","format":true,"interval":"1m","intervalFactor":3,"legendFormat":"","refId":"A"}],"thresholds":"","title":"Memory Used","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"current"},{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["#299c46","rgba(237, 129, 40, 0.89)","#d44a3a"],"datasource":"$PROMETHEUS_DS","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"format":"bytes","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"gridPos":{"h":3,"w":4,"x":4,"y":12},"id":10,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":null,"postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"expr":"sum (kube_node_status_allocatable_memory_bytes{env=~\"$environment\", cluster=\"$cluster\", node=~\"^$Node.*$\"})","format":true,"interval":"1m","intervalFactor":3,"legendFormat":"","refId":"A"}],"thresholds":"","title":"Memory Total (cluster)","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"current"},{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["#299c46","rgba(237, 129, 40, 0.89)","#d44a3a"],"datasource":"$PROMETHEUS_DS","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"format":"none","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"gridPos":{"h":3,"w":4,"x":8,"y":12},"id":11,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"cores","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"expr":"sum (rate (container_cpu_usage_seconds_total{env=~\"$environment\", pod=~\"^$Deployment.*$\", kubernetes_io_hostname=~\"^$Node$\", cluster=\"$cluster\", namespace=\"$namespace\"}[1m]))","format":true,"interval":"1m","intervalFactor":3,"legendFormat":"","refId":"A"}],"thresholds":"","title":"CPU Used","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"current"},{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["#299c46","rgba(237, 129, 40, 0.89)","#d44a3a"],"datasource":"$PROMETHEUS_DS","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"format":"none","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"gridPos":{"h":3,"w":4,"x":12,"y":12},"id":12,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"cores","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"expr":"sum (machine_cpu_cores{env=~\"$environment\", cluster=\"$cluster\", kubernetes_io_hostname=~\"^$Node$\"})","format":true,"interval":"1m","intervalFactor":3,"legendFormat":"","refId":"A"}],"thresholds":"","title":"CPU Total (cluster)","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"current"},{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["#299c46","rgba(237, 129, 40, 0.89)","#d44a3a"],"datasource":"$PROMETHEUS_DS","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"format":"none","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"gridPos":{"h":3,"w":4,"x":16,"y":12},"id":13,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"Pods","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"expr":"sum(kube_deployment_status_replicas_available{env=~\"$environment\", deployment=~\".*$Deployment\", cluster=\"$cluster\", namespace=\"$namespace\"})","format":true,"interval":"1m","intervalFactor":3,"legendFormat":"","refId":"A"}],"thresholds":"","title":"Available (cluster)","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"current"},{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["#299c46","rgba(237, 129, 40, 0.89)","#d44a3a"],"datasource":"$PROMETHEUS_DS","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"format":"none","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"gridPos":{"h":3,"w":4,"x":20,"y":12},"id":14,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"Pods","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"expr":"sum(kube_deployment_status_replicas{env=~\"$environment\", deployment=~\".*$Deployment\", cluster=\"$cluster\", namespace=\"$namespace\"})","format":true,"interval":"1m","intervalFactor":3,"legendFormat":"","refId":"A"}],"thresholds":"","title":"Total (cluster)","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"current"},{"collapse":false,"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":15},"id":15,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"CPU","titleSize":"h6","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":3,"fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":10,"w":24,"x":0,"y":16},"hiddenSeries":false,"id":16,"legend":{"alignAsTable":true,"avg":false,"current":true,"hideEmpty":false,"max":true,"min":false,"rightSide":true,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum (rate (container_cpu_usage_seconds_total{env=~\"$environment\", image!=\"\", pod=~\"^$Deployment.*$\", node=~\"^$Node$\", cluster=\"$cluster\", namespace=\"$namespace\"}[1m])) by (pod,node)","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"real: {{ pod }}","refId":"A"},{"expr":"sum (kube_pod_container_resource_requests_cpu_cores{env=~\"$environment\", pod=~\"^$Deployment.*$\",node=~\"^$Node$\", cluster=\"$cluster\", namespace=\"$namespace\"}) by (pod,node)","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"rqst: {{ pod }}","refId":"B"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Usage","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"none","label":"cores","logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}],"yaxis":{"align":false,"alignLevel":null}},{"columns":[],"datasource":"$PROMETHEUS_DS","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"fontSize":"100%","gridPos":{"h":10,"w":24,"x":0,"y":26},"id":17,"links":[],"pageSize":null,"showHeader":true,"sort":{"col":0,"desc":true},"styles":[{"alias":"Time","align":"auto","pattern":"Time","type":"hidden"},{"alias":"Pod","align":"auto","decimals":0,"link":true,"linkTooltip":"Drill Down","linkUrl":"/d/kubernetes-resources-pod/k8s-resources-pod?var-datasource=$datasource\u0026var-cluster=$cluster\u0026var-namespace=$namespace\u0026var-pod=$__cell","pattern":"pod","type":"number","unit":"short"},{"alias":"CPU Usage","align":"auto","decimals":3,"pattern":"Value #A","type":"number","unit":"short"},{"alias":"CPU Requests","align":"auto","decimals":3,"pattern":"Value #B","type":"number","unit":"short"},{"alias":"CPU Usage %","align":"auto","decimals":0,"pattern":"Value #C","type":"number","unit":"percentunit"}],"targets":[{"expr":"sum(label_replace(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_rate{env=~\"$environment\"}, \"pod\", \"$1\", \"pod\", \"(.*)\") * on(namespace,pod) group_left(workload) mixin_pod_workload{env=~\"$environment\", workload=~\"^$Deployment\", cluster=\"$cluster\", namespace=\"$namespace\"}) by (pod)","format":"table","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":"","refId":"A"},{"expr":"sum(kube_pod_container_resource_requests_cpu_cores{env=~\"$environment\"} * on(namespace,pod) group_left(workload) mixin_pod_workload{env=~\"$environment\", workload=~\"^$Deployment\", cluster=\"$cluster\", namespace=\"$namespace\"}) by (pod)","format":"table","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":"","refId":"B"},{"expr":"sum(label_replace(namespace_pod_container:container_cpu_usage_seconds_total:sum_rate{env=~\"$environment\"}, \"pod\", \"$1\", \"pod\", \"(.*)\") * on(pod) group_left(workload) mixin_pod_workload{env=~\"$environment\", workload=~\"^$Deployment\", cluster=\"$cluster\", namespace=\"$namespace\"}) by (pod) / sum(kube_pod_container_resource_requests_cpu_cores{env=~\"$environment\"} * on(pod) group_left(workload) mixin_pod_workload{env=~\"$environment\", workload=~\"^$Deployment\", cluster=\"$cluster\", namespace=\"$namespace\"}) by (pod)","format":"table","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":"","refId":"C"}],"timeFrom":null,"timeShift":null,"title":"Quota","transform":"table","type":"table-old"},{"collapse":false,"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":36},"id":18,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Memory","titleSize":"h6","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":3,"fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"fill":0,"gridPos":{"h":10,"w":24,"x":0,"y":37},"id":19,"legend":{"alignAsTable":true,"avg":false,"current":true,"hideEmpty":false,"max":true,"min":false,"rightSide":true,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum (container_memory_working_set_bytes{env=~\"$environment\", id!=\"/\",pod=~\"^$Deployment.*$\",node=~\"^$Node$\", container=\"mailroom\", cluster=\"$cluster\", namespace=\"$namespace\"}) by (pod)","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"real: {{ pod }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Usage","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":3,"format":"bytes","label":null,"logBase":1,"max":null,"min":null,"show":true},{"decimals":3,"format":"bytes","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"columns":[],"datasource":"$PROMETHEUS_DS","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"gridPos":{"h":10,"w":24,"x":0,"y":47},"id":20,"links":[],"styles":[{"alias":"Time","align":"auto","pattern":"Time","type":"hidden"},{"alias":"Pod","align":"auto","decimals":0,"link":true,"linkTooltip":"Drill Down","linkUrl":"/d/kubernetes-resources-pod/k8s-resources-pod?var-datasource=$datasource\u0026var-cluster=$cluster\u0026var-namespace=$namespace\u0026var-pod=$__cell","pattern":"pod","type":"number","unit":"short"},{"alias":"Memory Usage","align":"auto","decimals":2,"pattern":"Value #A","type":"number","unit":"bytes"},{"alias":"Memory Requests","align":"auto","decimals":2,"pattern":"Value #B","type":"number","unit":"bytes"},{"alias":"Memory Usage %","align":"auto","decimals":1,"pattern":"Value #C","type":"number","unit":"percentunit"}],"targets":[{"expr":"sum(label_replace(container_memory_usage_bytes{env=~\"$environment\", container!=\"\"}, \"pod\", \"$1\", \"pod\", \"(.*)\") * on(pod) group_left(workload) mixin_pod_workload{env=~\"$environment\", workload=~\"^$Deployment\", cluster=\"$cluster\", namespace=\"$namespace\"}) by (pod)","format":"table","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":"","refId":"A"},{"expr":"sum(kube_pod_container_resource_requests_memory_bytes{env=~\"$environment\"} * on(pod) group_left(workload) mixin_pod_workload{env=~\"$environment\", workload=~\"^$Deployment\", cluster=\"$cluster\", namespace=\"$namespace\"}) by (pod)","format":"table","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":"","refId":"B"},{"expr":"sum(label_replace(container_memory_usage_bytes{env=~\"$environment\", container!=\"\"}, \"pod\", \"$1\", \"pod\", \"(.*)\") * on(pod) group_left(workload) mixin_pod_workload{env=~\"$environment\", workload=~\"^$Deployment\", cluster=\"$cluster\", namespace=\"$namespace\"}) by (pod) /sum(kube_pod_container_resource_requests_memory_bytes{env=~\"$environment\", } * on(pod) group_left(workload) mixin_pod_workload{env=~\"$environment\", workload=~\"^$Deployment\", cluster=\"$cluster\", namespace=\"$namespace\"}) by (pod)","format":"table","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":"","refId":"C"}],"timeFrom":null,"timeShift":null,"title":"Quota","type":"table-old"},{"collapse":false,"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":57},"id":21,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Network","titleSize":"h6","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":1,"fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"fill":1,"gridPos":{"h":10,"w":24,"x":0,"y":58},"id":22,"legend":{"alignAsTable":true,"avg":false,"current":true,"hideEmpty":false,"max":true,"min":false,"rightSide":true,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pluginVersion":"7.2.0","pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum (rate (container_network_receive_bytes_total{env=~\"$environment\", id!=\"/\",pod=~\"^$Deployment.*$\",node=~\"^$Node$\", cluster=\"$cluster\", namespace=\"$namespace\"}[1m])) by (pod)","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"-\u003e {{ pod }}","refId":"A"},{"expr":"- sum( rate (container_network_transmit_bytes_total{env=~\"$environment\", id!=\"/\",pod=~\"^$Deployment.*$\",node=~\"^$Node$\", cluster=\"$cluster\", namespace=\"$namespace\"}[1m])) by (pod)","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"\u003c- {{ pod }}","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"All processes network I/O","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":1,"format":"Bps","label":null,"logBase":1,"max":null,"min":null,"show":true},{"decimals":1,"format":"Bps","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"refresh":"","schemaVersion":26,"style":"light","tags":[],"templating":{"list":[{"current":{"selected":false,"text":"Global","value":"Global"},"hide":0,"includeAll":false,"label":null,"multi":false,"name":"PROMETHEUS_DS","options":[],"query":"prometheus","refresh":1,"regex":"/(.*-gprd|Frank|Global|gprd-.*)/","skipUrlSync":false,"type":"datasource"},{"allValue":null,"current":{"selected":false,"text":"gprd","value":"gprd"},"datasource":"$PROMETHEUS_DS","definition":"","hide":0,"includeAll":false,"label":null,"multi":false,"name":"environment","options":[],"query":"label_values(gitlab_service_ops:rate, environment)","refresh":1,"regex":"","skipUrlSync":false,"sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"selected":false,"text":"gprd-gitlab-gke","value":"gprd-gitlab-gke"},"datasource":"$PROMETHEUS_DS","definition":"","hide":0,"includeAll":false,"label":null,"multi":false,"name":"cluster","options":[],"query":"label_values(kube_pod_container_info{environment=\"$environment\"}, cluster)","refresh":1,"regex":"","skipUrlSync":false,"sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"text":"main","value":"main"},"hide":0,"includeAll":false,"label":"","multi":false,"name":"stage","options":[{"text":"main","value":"main"},{"text":"cny","value":"cny"},{"text":"","value":""}],"query":"main,cny,","refresh":0,"skipUrlSync":false,"type":"custom"},{"allValue":"gitlab","current":{"selected":false,"text":"consul","value":"consul"},"datasource":"$PROMETHEUS_DS","definition":"label_values(kube_pod_container_info{environment=\"$environment\"}, namespace)","hide":2,"includeAll":true,"label":null,"multi":false,"name":"namespace","options":[],"query":"label_values(kube_pod_container_info{environment=\"$environment\"}, namespace)","refresh":1,"regex":"","skipUrlSync":false,"sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":".*","current":{"selected":false,"text":"All","value":"$__all"},"datasource":"$PROMETHEUS_DS","definition":"","hide":0,"includeAll":true,"label":null,"multi":false,"name":"Node","options":[],"query":"query_result(count(count_over_time(kube_node_labels{environment=\"$environment\", cluster=\"$cluster\"}[1w])) by (label_kubernetes_io_hostname))","refresh":2,"regex":"/.*=\"(.*)\".*/","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"text":"gitlab-mailroom","value":"gitlab-mailroom"},"hide":2,"includeAll":false,"label":"","multi":false,"name":"Deployment","options":[{"text":"gitlab-mailroom","value":"gitlab-mailroom"},{"text":"","value":""}],"query":"gitlab-mailroom,","refresh":0,"skipUrlSync":false,"type":"custom"}]},"time":{"from":"now-6h/m","to":"now/m"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"utc","title":"mailroom: Pod Info Copy","uid":"Jk2uvIPMz","version":1}}