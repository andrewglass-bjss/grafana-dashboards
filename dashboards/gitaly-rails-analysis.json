{"meta":{"type":"db","canSave":true,"canEdit":true,"canAdmin":true,"canStar":true,"slug":"gitaly-rails-analysis","url":"/d/000000194/gitaly-rails-analysis","expires":"0001-01-01T00:00:00Z","created":"2017-06-14T12:20:44Z","updated":"2017-06-16T11:54:17Z","updatedBy":"ops-contact@gitlab.com","createdBy":"ops-contact@gitlab.com","version":10,"hasAcl":false,"isFolder":false,"folderId":0,"folderTitle":"General","folderUrl":"","provisioned":false},"dashboard":{"annotations":{"list":[{"datasource":"$database","enable":true,"iconColor":"rgb(255, 255, 255)","name":"Deployments","query":"SELECT version FROM forever.deployments"}]},"editMode":false,"editable":true,"gnetId":null,"graphTooltip":0,"hideControls":false,"id":null,"links":[],"refresh":false,"rows":[{"collapse":false,"height":361,"panels":[{"columns":[],"datasource":"$database","editable":true,"error":false,"fontSize":"80%","height":"250","id":11,"links":[],"pageSize":30,"scroll":false,"showHeader":true,"sort":{"col":1,"desc":true},"span":12,"styles":[{"colorMode":"cell","colors":["rgba(50, 189, 80, 0.9)","rgba(237, 129, 40, 0.89)","rgba(200, 72, 72, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"Duration","thresholds":["1000","3000"],"type":"number","unit":"ms"},{"colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"Action","thresholds":[],"type":"string","unit":"short"},{"colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"HH:mm:ss","decimals":2,"pattern":"Time","thresholds":[],"type":"date","unit":"short"},{"colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"URI","thresholds":[],"type":"string","unit":"short"},{"colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"Memory","thresholds":[],"type":"number","unit":"bytes"},{"colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":0,"pattern":"Queries","thresholds":[],"type":"number","unit":"short"}],"targets":[{"alias":"$col","dsType":"influxdb","groupBy":[],"hide":false,"measurement":"transactions","orderByTime":"ASC","policy":"default","query":"SELECT \"duration\" AS \"Duration\", \"allocated_memory\" AS \"Memory\", \"sql_count\" AS \"Queries\", \"request_method\" AS \"Method\", \"action\" AS \"Action\", \"request_uri\" AS \"URI\" FROM \"rails_transactions\" WHERE $timeFilter AND \"action\" ='[[action]]' ORDER BY time DESC LIMIT 500","rawQuery":true,"refId":"A","resultFormat":"table","select":[[{"params":["duration"],"type":"field"}],[{"params":["method"],"type":"field"}],[{"params":["path"],"type":"field"}]],"tags":[]}],"title":"Transaction Details","transform":"table","transparent":false,"type":"table"}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Details","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"columns":[],"datasource":"$database","fontSize":"80%","id":28,"interval":"\u003e 3600s","links":[],"pageSize":10,"scroll":false,"showHeader":true,"sort":{"col":2,"desc":true},"span":12,"styles":[{"alias":"Time","dateFormat":"YYYY-MM-DD HH:mm:ss","pattern":"Time","type":"hidden"},{"alias":"","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"decimals":2,"pattern":"/.*/","thresholds":[],"type":"number","unit":"short"}],"targets":[{"alias":"$tag_method","dsType":"influxdb","groupBy":[{"params":["method"],"type":"tag"}],"hide":false,"measurement":"rails_method_call_timings_per_action_and_method","orderByTime":"ASC","policy":"downsampled","query":"    SELECT mean(call_count_99th) as mean_99th \n      FROM downsampled.rails_method_call_timings_per_action_and_method \n     WHERE $timeFilter \n       AND \"action\" =~ /^[[action]]$/\n  GROUP BY method, time(30d)","rawQuery":true,"refId":"A","resultFormat":"table","select":[[{"params":["cpu_duration_95th"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[{"key":"action","operator":"=","value":"Admin::DashboardController#index"}]}],"title":"Method Times","transform":"table","type":"table"}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Method Times","titleSize":"h6"},{"collapse":false,"height":247,"panels":[{"aliasColors":{"95th Percentile":"#9AC48A","99th Percentile":"#E24D42"},"bars":false,"dashLength":10,"dashes":false,"datasource":"$database","editable":true,"error":false,"fill":0,"grid":{},"id":18,"interval":"1m","legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":false,"steppedLine":false,"targets":[{"alias":"$col","dsType":"influxdb","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"orderByTime":"ASC","policy":"default","query":"SELECT \"duration_95th\" AS \"95th Percentile\", \"duration_99th\" AS \"99th Percentile\", \"duration_mean\" AS \"Mean\" FROM downsampled.rails_git_timings_per_action WHERE $timeFilter AND \"action\" =~ /^[[action]]$/","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Git Timings","tooltip":{"msResolution":true,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","logBase":1,"max":null,"min":null,"show":true},{"format":"short","logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{"95th Pecentile":"#9AC48A","95th Percentile":"#9AC48A","99th Percentile":"#E24D42","Maximum":"#EAB839","Mean":"#6ED0E0"},"bars":false,"dashLength":10,"dashes":false,"datasource":"$database","editable":true,"error":false,"fill":0,"grid":{},"id":5,"interval":"1m","legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":3,"stack":false,"steppedLine":false,"targets":[{"alias":"$col","dsType":"influxdb","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"orderByTime":"ASC","policy":"default","query":"SELECT \"sql_duration_95th\" AS \"95th Percentile\", \"sql_duration_99th\" AS \"99th Percentile\", \"sql_duration_mean\" AS \"Mean\", \"sql_duration_max\" AS \"Maximum\" FROM downsampled.rails_transaction_timings_per_action WHERE $timeFilter AND \"action\" =~ /^[[action]]$/","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"SQL Timings","tooltip":{"msResolution":true,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","logBase":1,"max":null,"min":null,"show":true},{"format":"short","logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{"95th Percentile":"#9AC48A","99th Percentile":"#E24D42","Maximum":"#EAB839"},"bars":false,"dashLength":10,"dashes":false,"datasource":"$database","editable":true,"error":false,"fill":0,"grid":{},"id":20,"interval":"1m","legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"Maximum","yaxis":1}],"spaceLength":10,"span":3,"stack":false,"steppedLine":false,"targets":[{"alias":"$col","dsType":"influxdb","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"orderByTime":"ASC","policy":"default","query":"SELECT \"sql_count_95th\" AS \"95th Percentile\", \"sql_count_99th\" AS \"99th Percentile\", \"sql_count_mean\" AS \"Mean\", \"sql_count_max\" AS \"Maximum\" FROM downsampled.rails_transaction_sql_counts_per_action WHERE $timeFilter AND \"action\" =~ /^[[action]]$/","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"SQL Query Counts","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","logBase":1,"max":null,"min":null,"show":true},{"format":"short","logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Graphs","titleSize":"h6"},{"collapse":false,"height":"250px","panels":[{"aliasColors":{"Issue#referenced_merge_requests":"#70DBED"},"bars":false,"dashLength":10,"dashes":false,"datasource":"$database","editable":true,"error":false,"fill":8,"grid":{},"height":"400","id":17,"interval":"1m","legend":{"alignAsTable":true,"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":true,"min":false,"rightSide":true,"show":true,"sort":"avg","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":0,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":true,"steppedLine":false,"targets":[{"alias":"$tag_method","dsType":"influxdb","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"orderByTime":"ASC","policy":"default","query":"SELECT mean(\"duration_95th\") AS \"value\" FROM downsampled.rails_method_call_timings_per_action_and_method WHERE $timeFilter AND \"action\" =~ /^[[action]]$/ GROUP BY \"method\", time($interval)","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Method Call Wall Time","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","logBase":10,"max":null,"min":null,"show":true},{"format":"short","logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{"Issue#referenced_merge_requests":"#70DBED"},"bars":false,"dashLength":10,"dashes":false,"datasource":"$database","editable":true,"error":false,"fill":6,"grid":{},"height":"400","id":22,"interval":"1m","legend":{"alignAsTable":true,"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":true,"min":false,"show":true,"sort":"avg","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":0,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":true,"steppedLine":false,"targets":[{"alias":"$tag_method","dsType":"influxdb","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"orderByTime":"ASC","policy":"default","query":"SELECT mean(\"cpu_duration_95th\") AS \"value\" FROM downsampled.rails_method_call_timings_per_action_and_method WHERE $timeFilter AND \"action\" =~ /^[[action]]$/ GROUP BY \"method\", time($interval)","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Method Call CPU Time","tooltip":{"msResolution":false,"shared":false,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","logBase":10,"max":null,"min":null,"show":true},{"format":"short","logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{"Issue#referenced_merge_requests":"#70DBED"},"bars":false,"dashLength":10,"dashes":false,"datasource":"$database","editable":true,"error":false,"fill":7,"grid":{},"height":"400","id":23,"interval":"1m","legend":{"alignAsTable":true,"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":true,"min":false,"show":false,"sort":"avg","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":0,"links":[],"nullPointMode":"connected","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":true,"steppedLine":false,"targets":[{"alias":"$tag_method","dsType":"influxdb","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"orderByTime":"ASC","policy":"default","query":"SELECT mean(\"call_count_95th\") AS \"value\" FROM downsampled.rails_method_call_timings_per_action_and_method WHERE $timeFilter AND \"action\" =~ /^[[action]]$/ GROUP BY \"method\", time($interval)","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Method Call Counts","tooltip":{"msResolution":false,"shared":false,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","logBase":1,"max":null,"min":null,"show":true},{"format":"short","logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Graphs","titleSize":"h6"}],"schemaVersion":14,"style":"dark","tags":["controller"],"templating":{"list":[{"allFormat":"glob","allValue":null,"current":{"selected":false,"text":"Projects::BlobController#show.json","value":"Projects::BlobController#show.json"},"datasource":"Production","hide":0,"includeAll":false,"label":"Action","multi":false,"multiFormat":"glob","name":"action","options":[],"query":"SHOW TAG VALUES FROM gitlab.downsampled.rails_transaction_counts_per_action WITH KEY = \"action\"","refresh":1,"regex":"/#/","sort":0,"tagValuesQuery":null,"tags":[],"tagsQuery":null,"type":"query","useTags":false},{"current":{"selected":true,"text":"Production","value":"Production"},"datasource":null,"hide":0,"includeAll":false,"label":"Database","multi":false,"name":"database","options":[],"query":"influxdb","refresh":1,"regex":"","type":"datasource"}]},"time":{"from":"now-7d","to":"now"},"timepicker":{"now":true,"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"utc","title":"Gitaly: Rails Analysis","uid":"000000194","version":10}}