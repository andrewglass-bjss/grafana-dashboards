{"meta":{"type":"db","canSave":false,"canEdit":false,"canAdmin":false,"canStar":true,"slug":"web-latency-issue","url":"/d/r9M4sj7Wk/web-latency-issue","expires":"0001-01-01T00:00:00Z","created":"2019-06-20T17:28:41Z","updated":"2019-07-01T16:49:28Z","updatedBy":"ops-contact@gitlab.com","createdBy":"ops-contact@gitlab.com","version":24,"hasAcl":false,"isFolder":false,"folderId":735,"folderTitle":"Amar - Web Latency","folderUrl":"/dashboards/f/GbHlPj7Wk/amar-web-latency","provisioned":false,"provisionedExternalId":""},"dashboard":{"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations \u0026 Alerts","type":"dashboard"}]},"editable":true,"gnetId":null,"graphTooltip":0,"id":null,"links":[],"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"fill":0,"gridPos":{"h":8,"w":12,"x":0,"y":0},"id":20,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"avg_over_time(gitlab_service_apdex:ratio{type=\"web\", environment=\"gprd\", stage=\"main\"}[$__interval])","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Web Apdex","refId":"A"},{"expr":"avg_over_time(gitlab_service_apdex:ratio{type=\"api\", environment=\"gprd\", stage=\"main\"}[$__interval])","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"API Apdex","refId":"B"},{"expr":"avg_over_time(gitlab_service_apdex:ratio{type=\"sidekiq\", environment=\"gprd\", stage=\"main\"}[$__interval])","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"SideKiq Apdex","refId":"C"},{"expr":"avg_over_time(gitlab_service_apdex:ratio{type=\"git\", environment=\"gprd\", stage=\"main\"}[$__interval])","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"GIT Apdex","refId":"D"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Apdex of Web, API, SideKiq,  GIT","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"fill":1,"gridPos":{"h":8,"w":12,"x":12,"y":0},"id":4,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"avg(node_memory_MemFree_bytes{fqdn=~\"web-.*-sv-gprd.*\"}) / 1000 / 1024 ","format":"time_series","intervalFactor":1,"legendFormat":"Node MemFree","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Node MemFree","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"transparent":true,"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"fill":0,"gridPos":{"h":8,"w":12,"x":0,"y":8},"id":18,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"rate(pg_stat_database_xact_commit{datname=\"gitlabhq_production\", environment=\"gprd\", tier=\"db\", type=\"patroni\"}[$__interval])","format":"time_series","interval":"30s","intervalFactor":1,"legendFormat":"{{fqdn}} committed","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"DB Transactions","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ops","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"cacheTimeout":null,"dashLength":10,"dashes":false,"fill":1,"gridPos":{"h":8,"w":12,"x":12,"y":8},"id":6,"interval":"","legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{},"percentage":false,"pluginVersion":"6.2.1","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"unicorn_active_connections{fqdn=~\"web-.*-sv-gprd.*\", environment=\"gprd\", type=\"web\", socket_address=\"/var/opt/gitlab/gitlab-rails/sockets/gitlab.socket\"} \u003e 42  ","format":"time_series","hide":false,"interval":"","intervalFactor":1,"legendFormat":"{{fqdn}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Active Conns \u003e 42  workers","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":1}},{"aliasColors":{"QueryTime":"dark-blue"},"bars":false,"dashLength":10,"dashes":false,"fill":0,"gridPos":{"h":8,"w":12,"x":0,"y":16},"id":14,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","options":{},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"Web Apdex","yaxis":2}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"avg(rate(pg_stat_statements_time_milliseconds{queryid=\"2722666312\"}[$__interval]))","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"QueryTime","refId":"A"},{"expr":"avg_over_time(gitlab_service_apdex:ratio{type=\"web\", environment=\"gprd\", stage=\"main\"}[$__interval])","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Web Apdex","refId":"B"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Web Apdex VS internal_ids for update time","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"fill":0,"gridPos":{"h":8,"w":12,"x":12,"y":16},"id":8,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{},"percentage":false,"pluginVersion":"6.2.1","pointradius":0.5,"points":true,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(rate(unicorn_exceeds_memory_limit_total{fqdn=~\"web-[0-9][0-9]-sv-gprd.*\", environment=\"gprd\"}[5m]) * 300)","format":"heatmap","instant":false,"interval":"","intervalFactor":1,"legendFormat":"Unicorn Memory Exceeds","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Unicorn Max Memory Exceeds | SIGQUIT","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":true,"dashLength":10,"dashes":false,"fill":0,"gridPos":{"h":8,"w":12,"x":0,"y":24},"id":16,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":false,"linewidth":2,"links":[],"nullPointMode":"null as zero","options":{},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"expr":"sum(rate(github_importer_imported_projects{environment = \"gprd\"}[$__interval])) * 3600","format":"time_series","interval":"5m","intervalFactor":5,"legendFormat":"Projects","refId":"A"},{"expr":"sum(rate(github_importer_imported_issues{environment = \"gprd\"}[$__interval])) * 3600","format":"time_series","interval":"5m","intervalFactor":5,"legendFormat":"Issues","refId":"B"},{"expr":"sum(rate(github_importer_imported_repositories{environment = \"gprd\"}[$__interval])) * 3600","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"Repositories","refId":"C"},{"expr":"sum(rate(github_importer_imported_pull_requests{environment = \"gprd\"}[$__interval])) * 3600","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"PRs","refId":"D"},{"expr":"sum((rate(github_importer_imported_notes{environment=\"gprd\"}[$__interval]) + rate(github_importer_imported_diff_notes{environment=\"gprd\"}[$__interval]))) * 3600","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"Notes","refId":"E"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"GitHub Imports","tooltip":{"shared":true,"sort":1,"value_type":"individual"},"transparent":true,"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"fill":1,"gridPos":{"h":8,"w":12,"x":12,"y":24},"id":12,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"Memory Utiliization","yaxis":2},{"alias":"CPU","yaxis":2}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"avg(avg_over_time(instance:memory_utilization:ratio_q95{environment=\"gprd\",fqdn=~\"web-[0-9][0-9]-sv-gprd.*\"}[5m]))","format":"time_series","intervalFactor":1,"legendFormat":"Memory Utiliization","refId":"A"},{"expr":"avg(avg_over_time(instance:cpu_utilization:ratio_q95{environment=\"gprd\",fqdn=~\"web-[0-9][0-9]-sv-gprd.*\"}[5m]))","format":"time_series","intervalFactor":1,"legendFormat":"CPU","refId":"B"},{"expr":"avg((node_memory_Cached_bytes{fqdn=~\"web-[0-9][0-9]-sv-gprd.*\", environment=\"gprd\"} + node_memory_Buffers_bytes{fqdn=~\"web-[0-9][0-9]-sv-gprd.*\", environment=\"gprd\"}) / 1000 / 1024 / 1024)","format":"time_series","intervalFactor":1,"legendFormat":"Buff/Cache","refId":"C"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Resource Utilization","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"none","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"percentunit","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"fill":1,"gridPos":{"h":8,"w":12,"x":0,"y":32},"id":10,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(avg_over_time(job:unicorn_queued_connections:sum{environment=\"gprd\",type=\"web\"}[1m]))  ","format":"time_series","intervalFactor":1,"legendFormat":"Unicorn  Queued Conns","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Unicorn  Queued Conns","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"fill":1,"gridPos":{"h":9,"w":12,"x":0,"y":40},"id":2,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(rate(haproxy_frontend_http_requests_total{environment=\"gprd\", frontend=~\"http[s]\"}[5m]))","format":"time_series","intervalFactor":1,"legendFormat":"Traffic (HAProxy Frontend)","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Traffic (HAProxy Frontend)","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"transparent":true,"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"refresh":false,"schemaVersion":18,"style":"dark","tags":[],"templating":{"list":[]},"time":{"from":"now-6h","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"","title":"Web Latency Issue","uid":"r9M4sj7Wk","version":24}}