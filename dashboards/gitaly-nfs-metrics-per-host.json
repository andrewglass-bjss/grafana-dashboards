{"meta":{"type":"db","canSave":true,"canEdit":true,"canAdmin":true,"canStar":true,"slug":"gitaly-nfs-metrics-per-host","url":"/d/000000204/gitaly-nfs-metrics-per-host","expires":"0001-01-01T00:00:00Z","created":"2017-07-20T09:52:52Z","updated":"2018-07-09T10:23:42Z","updatedBy":"ops-contact@gitlab.com","createdBy":"ops-contact@gitlab.com","version":109,"hasAcl":false,"isFolder":false,"folderId":0,"folderTitle":"General","folderUrl":"","provisioned":false},"dashboard":{"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations \u0026 Alerts","type":"dashboard"},{"datasource":"Prometheus in Azure","enable":false,"expr":"ALERTS{fqdn=\"$fqdn\"}","hide":false,"iconColor":"rgba(255, 96, 96, 0.19)","limit":100,"name":"alerts","showIn":0,"step":"1m","tagKeys":"pager,channel","titleFormat":"{{alertname}}","type":"alert"}]},"editable":true,"gnetId":null,"graphTooltip":1,"hideControls":false,"id":null,"links":[{"icon":"external link","includeVars":true,"keepTime":true,"tags":["GitalyMain"],"type":"dashboards"},{"icon":"external link","tags":[],"targetBlank":true,"title":"Kibana","tooltip":"","type":"link","url":" https://log.gitlap.com/app/kibana#/discover?_a=%28index%3A'gitaly-*'%2Cquery%3A%28query_string%3A%28query%3A'hostname:%22$fqdn%22'%29%29%29\u0026_g=%28refreshInterval:%28display:Off,pause:!f,value:0%29,time:%28from:now-1h,mode:quick,to:now%29%29"},{"icon":"external link","tags":[],"title":"Abuse Dashboard (ELK)","tooltip":"","type":"link","url":"https://log.gitlab.net/app/kibana#/dashboard?_g=(filters:!(('$state':(store:globalState),meta:(alias:!n,disabled:!f,index:AWM6iM-v1NBBQZg_CdXQ,key:json.fqdn,negate:!f,type:phrase,value:'$fqdn'),query:(match:(json.fqdn:(query:'$fqdn',type:phrase))))),refreshInterval:(display:Off,pause:!f,value:0),time:(from:now-4h,mode:quick,to:now))\u0026_a=(description:'',filters:!(),options:(darkTheme:!f),panels:!((col:1,id:AWR-Qq-LlAroidPhIwzo,panelIndex:1,row:1,size_x:9,size_y:6,type:visualization)),query:(match_all:()),timeRestore:!f,title:'New+Dashboard',uiState:(),viewMode:edit)"}],"refresh":false,"rows":[{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":26,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(rate(grpc_server_handled_total{fqdn=\"$fqdn\", job=\"$job\", grpc_code=\"OK\"}[$__interval])) /\nsum(rate(grpc_server_handled_total{fqdn=\"$fqdn\", job=\"$job\"}[$__interval])) ","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":5,"legendFormat":"Success %","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":300,"tags":[]}],"thresholds":[{"colorMode":"warning","fill":false,"line":true,"op":"lt","value":0.999},{"colorMode":"critical","fill":true,"line":true,"op":"lt","value":0.99}],"timeFrom":null,"timeShift":null,"title":"Service Level (%)","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":null,"format":"percentunit","label":null,"logBase":1,"max":"1.00","min":".98","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"SLA","titleSize":"h6"},{"collapse":false,"height":"250px","panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":0,"id":1,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"cpu_count","color":"#6ED0E0","dashLength":4,"dashes":true,"spaceLength":2}],"spaceLength":10,"span":6,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"node_load1{fqdn=\"$fqdn\"}","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"load1-{{fqdn}}","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":120,"tags":[]},{"expr":"node_load5{fqdn=\"$fqdn\"}","format":"time_series","interval":"","intervalFactor":2,"legendFormat":"load5-{{fqdn}}","refId":"B","step":120},{"expr":"node_load15{fqdn=\"$fqdn\"}","format":"time_series","interval":"","intervalFactor":2,"legendFormat":"load15-{{fqdn}}","refId":"C","step":120},{"expr":"avg(instance:node_cpus:count{fqdn=\"$fqdn\"})","format":"time_series","interval":"","intervalFactor":2,"legendFormat":"cpu_count","refId":"D","step":120}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Load 1min","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"aliasColors":{"load_15_per_cpu":"#1F78C1"},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":22,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"avg(node_load15{fqdn=\"$fqdn\"}) / avg(instance:node_cpus:count{fqdn=\"$fqdn\"})","format":"time_series","intervalFactor":2,"legendFormat":"load_15_per_cpu","refId":"C","step":120}],"thresholds":[{"colorMode":"warning","fill":false,"line":true,"op":"gt","value":1},{"colorMode":"critical","fill":false,"line":true,"op":"gt","value":2}],"timeFrom":null,"timeShift":null,"title":"Load 15 by CPU Count","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{"fqdn":"#0A50A1"},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":2,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg(rate(node_disk_io_time_ms{fqdn=~\"$fqdn\",device=~\"sd.*\"}[$__interval])) without (device) / 1000","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"60s","intervalFactor":2,"legendFormat":"{{fqdn}}","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":120,"tags":[]},{"expr":"avg(rate(node_disk_io_time_seconds_total{fqdn=~\"$fqdn\",device=~\"sd.*\"}[$__interval])) without (device)","format":"time_series","interval":"60s","intervalFactor":2,"legendFormat":"{{fqdn}}","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Disk IO *","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":"ms per Second","logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"aliasColors":{"IOWait (last week)":"#82B5D8"},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":7,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"IOWait (last week)","dashLength":5,"dashes":true,"fill":0,"spaceLength":2},{"alias":"IOWait","linewidth":2}],"spaceLength":10,"span":6,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"quantile_over_time(0.90, instance_mode:node_cpu:rate5m{mode=\"iowait\",fqdn=\"$fqdn\"}[$__interval])","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"IOWait","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":120,"tags":[]},{"expr":"quantile_over_time(0.90, instance_mode:node_cpu:rate5m{mode=\"iowait\",fqdn=\"$fqdn\"}[$__interval] offset 1w)","format":"time_series","intervalFactor":2,"legendFormat":"IOWait (last week)","refId":"B","step":120}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"% IOWait *","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":2,"format":"percentunit","label":"","logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{"Used System Total CPU %":"#CCA300"},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":8,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"1 week prior","color":"#aaaaaa","dashLength":4,"dashes":true,"fill":0,"spaceLength":2}],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"quantile_over_time(0.95, instance:node_cpu_in_use:ratio{fqdn=\"$fqdn\"}[$__interval])","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":4,"legendFormat":"Used System Total CPU %","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":120,"tags":[]},{"expr":"quantile_over_time(0.95, instance:node_cpu_in_use:ratio{fqdn=\"$fqdn\"}[$__interval] offset 1w)","format":"time_series","intervalFactor":4,"legendFormat":"1 week prior","refId":"B"}],"thresholds":[{"colorMode":"warning","fill":false,"fillColor":"rgba(255, 0, 0, 0.09)","line":true,"op":"gt","value":0.75},{"colorMode":"critical","fill":false,"line":true,"op":"gt","value":1}],"timeFrom":null,"timeShift":null,"title":"Used System Total CPU %*","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"","logBase":1,"max":"1","min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{"nfs-file-08.stor.gitlab.com":"#EF843C"},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":3,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"rate(node_context_switches{fqdn=\"$fqdn\"}[$__interval])","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"{{fqdn}}","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":120,"tags":[]},{"expr":"rate(node_context_switches_total{fqdn=\"$fqdn\"}[$__interval])","format":"time_series","intervalFactor":2,"legendFormat":"{{fqdn}}","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Context Switches *","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":null,"format":"short","label":"Context Switches / Second","logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{"nfs-file-08.stor.gitlab.com":"#447EBC"},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":4,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"rate(node_forks{fqdn=\"$fqdn\"}[$__interval])","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"{{fqdn}}","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":120,"tags":[]},{"expr":"rate(node_forks_total{fqdn=\"$fqdn\"}[$__interval])","format":"time_series","intervalFactor":2,"legendFormat":"{{fqdn}}","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Forks Given *","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"Forks per Second","logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{"Percentage Free":"#1F78C1"},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":5,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"node_memory_MemAvailable{fqdn=\"$fqdn\"} / node_memory_MemTotal{fqdn=\"$fqdn\"}","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"Available {{fqdn}}","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":120,"tags":[]},{"expr":"node_memory_MemAvailable_bytes{fqdn=\"$fqdn\"} / node_memory_MemTotal_bytes{fqdn=\"$fqdn\"}","format":"time_series","intervalFactor":2,"legendFormat":"Available {{fqdn}}","refId":"B"},{"expr":"node_memory_Cached{fqdn=\"$fqdn\"} / node_memory_MemTotal{fqdn=\"$fqdn\"}","format":"time_series","intervalFactor":2,"legendFormat":"Cached {{fqdn}}","refId":"C"},{"expr":"node_memory_Cached_bytes{fqdn=\"$fqdn\"} / node_memory_MemTotal_bytes{fqdn=\"$fqdn\"}","format":"time_series","intervalFactor":2,"legendFormat":"Cached {{fqdn}}","refId":"D"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Available Memory","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":null,"format":"percentunit","label":null,"logBase":1,"max":"1","min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"aliasColors":{"nfs-file-08.stor.gitlab.com":"#70DBED"},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":5,"id":6,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"node_memory_Mapped{fqdn=\"$fqdn\"}","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"{{fqdn}}","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":120,"tags":[]},{"expr":"node_memory_Mapped_bytes{fqdn=\"$fqdn\"}","format":"time_series","intervalFactor":2,"legendFormat":"{{fqdn}}","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Mapped Memory","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":5,"id":9,"legend":{"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":0,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(rate(grpc_server_handled_total{fqdn=\"$fqdn\"}[$__interval])) by (grpc_method)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":10,"legendFormat":"{{grpc_method}}","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":600,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"GRPC Methods Invocations by Method *","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":true,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":10,"legend":{"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":false,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(rate(grpc_server_handled_total{fqdn=\"$fqdn\",grpc_code!=\"OK\"}[$__interval])) by (grpc_method)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":10,"legendFormat":"{{grpc_method}}","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":600,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Failures per Second by Method *","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":11,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(rate(node_network_transmit_bytes{fqdn=\"$fqdn\",device!=\"lo\"}[$__interval])) without (device)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":10,"legendFormat":"{{fqdn}}","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":600,"tags":[]},{"expr":"sum(rate(node_network_transmit_bytes_total{fqdn=\"$fqdn\",device!=\"lo\"}[$__interval])) without (device)","format":"time_series","intervalFactor":2,"legendFormat":"{{fqdn}}","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Network Transmit (bytes) *","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":"","logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":12,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(rate(node_network_receive_bytes{fqdn=\"$fqdn\",device!=\"lo\"}[$__interval])) without (device)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":10,"legendFormat":"{{fqdn}}","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":600,"tags":[]},{"expr":"sum(rate(node_network_receive_bytes_total{fqdn=\"$fqdn\",device!=\"lo\"}[$__interval])) without (device)","format":"time_series","intervalFactor":2,"legendFormat":"{{fqdn}}","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Network Receive (bytes) *","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{"Total CPU last week":"#890f02"},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":13,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"Total CPU last week","dashLength":2,"dashes":true,"fill":0,"spaceLength":2}],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg(rate(process_cpu_seconds_total{job=\"$job\", fqdn=\"$fqdn\"}[$__interval])) / avg(instance:node_cpus:count{fqdn=\"$fqdn\"})","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"Total CPU","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":120,"tags":[]},{"expr":"avg(rate(process_cpu_seconds_total{job=\"$job\", fqdn=\"$fqdn\"}[$__interval] offset 1w)) / avg(instance:node_cpus:count{fqdn=\"$fqdn\"}  offset 1w)","format":"time_series","interval":"","intervalFactor":2,"legendFormat":"Total CPU last week","refId":"B","step":4}],"thresholds":[{"colorMode":"warning","fill":false,"line":true,"op":"gt","value":0.2},{"colorMode":"critical","fill":false,"line":true,"op":"gt","value":0.5}],"timeFrom":null,"timeShift":null,"title":"Gitaly Process % CPU *","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":14,"legend":{"avg":true,"current":false,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"process_resident_memory_bytes{job=\"$job\",fqdn=\"$fqdn\"}","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"{{fqdn}}","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":120,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Resident Memory Size","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":"","logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":15,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"process_open_fds{job=\"$job\",fqdn=\"$fqdn\"} ","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"{{fqdn}}","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":120,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Open File Descriptors","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":0,"id":16,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"rate(node_disk_read_time_ms{fqdn=\"$fqdn\"}[$__interval]) / 1000","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"{{device}}","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":120,"tags":[]},{"expr":"rate(node_disk_read_time_seconds_total{fqdn=\"$fqdn\"}[$__interval])","format":"time_series","intervalFactor":2,"legendFormat":"{{device}}","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Disk Read Times *","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":10,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":0,"id":17,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"rate(node_disk_write_time_ms{fqdn=\"$fqdn\"}[$__interval]) / 1000","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"{{device}}","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":120,"tags":[]},{"expr":"rate(node_disk_write_time_seconds_total{fqdn=\"$fqdn\"}[$__interval])","format":"time_series","intervalFactor":2,"legendFormat":"{{device}}","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Disk Writes *","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":null,"format":"short","label":null,"logBase":10,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":18,"legend":{"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(rate(grpc_server_msg_received_total{fqdn=\"$fqdn\"}[$__interval])) by (grpc_method)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"{{ grpc_method }}","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":120,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"GRPC messages received *","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":19,"legend":{"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(rate(grpc_server_msg_sent_total{fqdn=\"$fqdn\"}[$__interval])) by (grpc_method)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"{{ grpc_method }}","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":120,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"GRPC Messages Sent *","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":20,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"Fleet Avg","color":"#447EBC","dashLength":3,"dashes":true,"fill":0,"spaceLength":1}],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"rate(go_goroutines{fqdn=\"$fqdn\", job=\"$job\"}[$__interval])","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"Goroutines","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":120,"tags":[]},{"expr":"avg(rate(go_goroutines{job=\"$job\"}[$__interval]))","format":"time_series","interval":"","intervalFactor":2,"legendFormat":"Fleet Avg","refId":"B","step":120}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Gitaly goroutines","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":0,"id":21,"legend":{"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(rate(grpc_server_msg_sent_total{fqdn=\"$fqdn\"}[$__interval])) by (grpc_method)\n  /\nsum(rate(grpc_server_msg_received_total{fqdn=\"$fqdn\"}[$__interval])) by (grpc_method)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"{{ grpc_method }}","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":120,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Outgoing / Incoming Message Rate (log) *","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"","logBase":2,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":0,"id":23,"legend":{"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"histogram_quantile(0.99, sum(gitaly:grpc_server_handling_seconds_bucket:rate1m{fqdn=\"$fqdn\", job=\"$job\"}) by (le, grpc_method)) * 1000","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"{{ grpc_method }}","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":120,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"p99 Gitaly RPC times","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","label":null,"logBase":10,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":0,"id":24,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"histogram_quantile(0.99, sum(gitaly:grpc_server_handling_seconds_bucket:rate1m{fqdn=\"$fqdn\", job=\"$job\"}) by (le)) * 1000","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"p99","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":120,"tags":[]},{"expr":"histogram_quantile(0.95, sum(gitaly:grpc_server_handling_seconds_bucket:rate1m{fqdn=\"$fqdn\", job=\"$job\"}) by (le)) * 1000","format":"time_series","interval":"","intervalFactor":2,"legendFormat":"p95","refId":"B","step":120},{"expr":"histogram_quantile(0.50, sum(gitaly:grpc_server_handling_seconds_bucket:rate1m{fqdn=\"$fqdn\", job=\"$job\"}) by (le)) * 1000","format":"time_series","interval":"","intervalFactor":2,"legendFormat":"p50","refId":"C","step":120},{"expr":"avg(histogram_quantile(0.50, sum(gitaly:grpc_server_handling_seconds_bucket:rate1m{job=\"$job\"}) by (le, fqdn))) * 1000","format":"time_series","interval":"","intervalFactor":10,"legendFormat":"p50 fleet avg","refId":"D","step":600}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Gitaly p99 Response Time for All Endpoints","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":10,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{"fleet avg":"#EF843C"},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":25,"legend":{"avg":false,"current":false,"hideEmpty":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"now - 1w","color":"#511749","dashLength":3,"dashes":true,"fill":0,"spaceLength":1},{"alias":"fleet avg","dashLength":2,"dashes":true,"fill":0,"spaceLength":2}],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"rate(gitaly_connections_total{job=\"$job\", fqdn=\"$fqdn\"}[$__interval])","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"now","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":120,"tags":[]},{"expr":"rate(gitaly_connections_total{job=\"$job\", fqdn=\"$fqdn\"}[$__interval] offset 1w)","format":"time_series","intervalFactor":2,"legendFormat":"now - 1w","refId":"B","step":120},{"expr":"avg(rate(gitaly_connections_total{job=\"$job\"}[$__interval]))","format":"time_series","interval":"","intervalFactor":2,"legendFormat":"fleet avg","refId":"C","step":120}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Connections Accepted *","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":0,"id":27,"legend":{"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"(avg(rate(grpc_server_handling_seconds_sum{job=\"$job\", fqdn=\"$fqdn\"}[$__interval]) / rate(grpc_server_handling_seconds_count[$__interval]) \u003e 0) by (grpc_type))\n/\n(avg(rate(grpc_server_handling_seconds_sum{job=\"$job\"}[$__interval]) / rate(grpc_server_handling_seconds_count[$__interval]) \u003e 0) by (grpc_type))\n\n\n","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":10,"legendFormat":"{{ grpc_type }}","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":120,"tags":[]}],"thresholds":[{"colorMode":"warning","fill":true,"line":true,"op":"gt","value":4},{"colorMode":"warning","fill":true,"line":true,"op":"lt","value":0.25},{"colorMode":"ok","fill":false,"line":true,"op":"gt","value":1}],"timeFrom":null,"timeShift":null,"title":"Host Relative Speed by GRPC Method","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":null,"format":"percentunit","label":null,"logBase":10,"max":null,"min":"0.1","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":28,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(rate(container_cpu_usage_seconds_total{fqdn=\"nfs-file-04.stor.gitlab.com\", id=\"/system.slice/gitlab-runsvdir.service\"}[10m])) / avg(instance:node_cpus:count{fqdn=\"$fqdn\"})","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":10,"legendFormat":"CPU Usage","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]},{"expr":"sum(rate(container_cpu_user_seconds_total{fqdn=\"nfs-file-04.stor.gitlab.com\", id=\"/system.slice/gitlab-runsvdir.service\"}[10m]))/ avg(instance:node_cpus:count{fqdn=\"$fqdn\"})","format":"time_series","intervalFactor":2,"legendFormat":"User CPU","refId":"B"},{"expr":"sum(rate(container_cpu_system_seconds_total{fqdn=\"nfs-file-04.stor.gitlab.com\", id=\"/system.slice/gitlab-runsvdir.service\"}[10m]))/ avg(instance:node_cpus:count{fqdn=\"$fqdn\"}) ","format":"time_series","interval":"","intervalFactor":2,"legendFormat":"System CPU","refId":"C"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"GitLab Cgroup CPU","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":29,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"container_memory_rss{fqdn=\"$fqdn\", id=\"/system.slice/gitlab-runsvdir.service\"}","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"Memory","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"GitLab Cgroup Memory","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"}],"schemaVersion":14,"style":"dark","tags":["Gitaly","GitalyMain"],"templating":{"list":[{"allValue":null,"current":{"text":"nfs-file-02.stor.gitlab.com","value":"nfs-file-02.stor.gitlab.com"},"datasource":"Prometheus in Azure","hide":0,"includeAll":false,"label":null,"multi":false,"name":"fqdn","options":[],"query":"label_values(up{job=~\"gitaly.*\"}, fqdn)","refresh":2,"regex":"","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"text":"gitaly","value":"gitaly"},"datasource":"Prometheus in Azure","hide":0,"includeAll":false,"label":null,"multi":false,"name":"job","options":[],"query":"label_values(up{job=~\"gitaly.*\"}, job)","refresh":2,"regex":"","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-24h","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"utc","title":"Gitaly NFS Metrics - per host","uid":"000000204","version":109}}