{"meta":{"type":"db","canSave":true,"canEdit":true,"canStar":true,"slug":"gitaly-fleet-overview","expires":"0001-01-01T00:00:00Z","created":"2017-08-30T08:46:40Z","updated":"2018-01-11T10:36:43Z","updatedBy":"ops-contact@gitlab.com","createdBy":"ops-contact@gitlab.com","version":31},"dashboard":{"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations \u0026 Alerts","type":"dashboard"}]},"editable":true,"gnetId":null,"graphTooltip":1,"hideControls":false,"id":null,"links":[{"icon":"external link","includeVars":true,"keepTime":true,"tags":["GitalyMain"],"type":"dashboards"}],"refresh":"1m","rows":[{"collapse":false,"height":"100px","panels":[{"cacheTimeout":null,"colorBackground":false,"colorValue":true,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"datasource":"Prometheus in Azure","decimals":3,"format":"percent","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"height":"100px","id":22,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"span":2,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"dsType":"influxdb","expr":"(1 - avg(gitaly:grpc_server_handled_total:error_rate1m{environment=\"$environment\"}) / avg(gitaly:grpc_server_handled_total:rate1m{environment=\"$environment\"})) * 100 ","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":600,"tags":[]}],"thresholds":"99,99.9","timeShift":null,"title":"Service Level","transparent":false,"type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"current"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"height":"100px","id":23,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"(1 - avg(gitaly:grpc_server_handled_total:error_rate1m) / avg(gitaly:grpc_server_handled_total:rate1m)) * 100","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"Success Rate %","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":60,"tags":[]}],"thresholds":[{"colorMode":"ok","fill":false,"line":true,"op":"gt","value":99.9},{"colorMode":"warning","fill":false,"line":true,"op":"gt","value":99},{"colorMode":"critical","fill":false,"line":true,"op":"lt","value":99}],"timeFrom":null,"timeShift":null,"title":"Service Level","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"transparent":false,"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":false,"values":[]},"yaxes":[{"decimals":null,"format":"percent","label":null,"logBase":1,"max":"100","min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"SLA","titleSize":"h6"},{"collapse":false,"height":"250px","panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":0,"id":1,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"cpu_count","color":"#6ED0E0","dashLength":4,"dashes":true,"spaceLength":2}],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"node_load15{environment=\"$environment\", tier=\"$tier\", type=\"gitaly\"}","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"{{fqdn}}","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":40,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Load","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{"fqdn":"#0A50A1"},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":2,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg(rate(node_disk_io_time_ms{environment=\"$environment\", tier=\"$tier\", type=\"gitaly\"}[$resolution])) by (fqdn)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":4,"legendFormat":"{{fqdn}}","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":40,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Disk IO *","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","label":"ms per Minute","logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{"nfs-file-08.stor.gitlab.com":"#EF843C"},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":3,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg(rate(node_context_switches{environment=\"$environment\", tier=\"$tier\", type=\"gitaly\"}[$resolution])) by (fqdn)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"{{fqdn}}","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":40,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Context Switches *","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"Context Switches / Second","logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{"nfs-file-08.stor.gitlab.com":"#447EBC"},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":0,"id":4,"legend":{"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg(rate(node_forks{environment=\"$environment\", tier=\"$tier\", type=\"gitaly\"}[$resolution])) by (fqdn)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"{{fqdn}}","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":40,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Forks Given *","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"Forks per Second","logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{"Percentage Free":"#1F78C1"},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":5,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"node_memory_MemFree{environment=\"$environment\", tier=\"$tier\", type=\"gitaly\"} / node_memory_MemTotal{environment=\"$environment\", tier=\"$tier\", type=\"gitaly\"}","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"{{ fqdn }}","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":40,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Free Memory","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{"nfs-file-08.stor.gitlab.com":"#70DBED"},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":5,"id":6,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"node_memory_Mapped{environment=\"$environment\", tier=\"$tier\", type=\"gitaly\"}","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"{{fqdn}}","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":40,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Mapped Memory","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":7,"legend":{"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg(rate(node_cpu{mode=\"iowait\",environment=\"prd\", type=\"gitaly\"}[$resolution])) by (fqdn)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"{{fqdn}}","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":40,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"IOWait per CPU *","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":2,"format":"percentunit","label":"","logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{"Used System Total CPU %":"#CCA300"},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":0,"id":8,"legend":{"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"1 - avg(rate(node_cpu{environment=\"$environment\", tier=\"$tier\", mode=\"idle\", type=\"gitaly\"}[$resolution])) by (fqdn)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"{{ fqdn }}","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":40,"tags":[]}],"thresholds":[{"colorMode":"warning","fill":false,"fillColor":"rgba(255, 0, 0, 0.09)","line":true,"op":"gt","value":0.75},{"colorMode":"critical","fill":false,"line":true,"op":"gt","value":1}],"timeFrom":null,"timeShift":null,"title":"Used System Total CPU % *","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"","logBase":1,"max":"1","min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":5,"id":9,"legend":{"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":0,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(rate(grpc_server_handled_total{environment=\"$environment\", tier=\"$tier\"}[$resolution])) by (fqdn)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":10,"legendFormat":"{{fqdn}}","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":200,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"GRPC Methods Invocations by Method *","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":true,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":10,"legend":{"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":false,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(rate(grpc_server_handled_total{environment=\"$environment\", tier=\"$tier\", grpc_code != \"OK\"}[$resolution])) by (fqdn)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":10,"legendFormat":"{{fqdn}}","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":200,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Failures per Second by Method","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":11,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg(rate(node_network_transmit_bytes{environment=\"$environment\", tier=\"$tier\", type=\"gitaly\"}[$resolution])) by (fqdn)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":4,"legendFormat":"{{fqdn}}","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":200,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Network Transmit (bytes) *","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":"","logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":12,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg(rate(node_network_receive_bytes{environment=\"$environment\", tier=\"$tier\", type=\"gitaly\"}[$resolution])) by (fqdn)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":4,"legendFormat":"{{fqdn}}","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":200,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Network Receive (bytes) *","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":0,"id":13,"legend":{"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg(rate(process_cpu_seconds_total{environment=\"$environment\", tier=\"$tier\", job=~\"gitaly.*\"}[$resolution])) by (fqdn) / avg(instance:node_cpus:count{environment=\"$environment\", tier=\"$tier\"}) by (fqdn)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":4,"legendFormat":"{{ fqdn }}","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":40,"tags":[]}],"thresholds":[{"colorMode":"warning","fill":false,"line":true,"op":"gt","value":0.2},{"colorMode":"critical","fill":false,"line":true,"op":"gt","value":0.5}],"timeFrom":null,"timeShift":null,"title":"Gitaly Process % CPU *","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":2,"format":"percentunit","label":"","logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":0,"id":14,"legend":{"avg":true,"current":false,"hideEmpty":true,"hideZero":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"process_resident_memory_bytes{job=~\"gitaly.*\",environment=\"$environment\", tier=\"$tier\"}","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"{{fqdn}}","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":40,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Resident Memory Size","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":"","logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":0,"id":15,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg(process_open_fds{environment=\"$environment\", tier=\"$tier\", job=~\"gitaly.*\"}) by (fqdn)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"{{fqdn}}","metric":"","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":40,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Open File Descriptors","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":0,"id":16,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg(rate(node_disk_read_time_ms{environment=\"$environment\", tier=\"$tier\", type=\"gitaly\"}[$resolution])) by (fqdn) * 1000","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":4,"legendFormat":"{{fqdn}}","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":40,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Disk Read Times (log₂) *","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","label":null,"logBase":2,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":0,"id":17,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"max(rate(node_disk_write_time_ms{environment=\"$environment\", tier=\"$tier\", type=\"gitaly\"}[1m])) by (fqdn)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"{{fqdn}}","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":40,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Disk Writes","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":10,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":18,"legend":{"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(rate(grpc_server_msg_received_total{environment=\"$environment\", tier=\"$tier\"}[1m])) by (fqdn)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"{{ fqdn }}","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":40,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"GRPC messages received","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":19,"legend":{"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(rate(grpc_server_msg_sent_total{environment=\"$environment\", tier=\"$tier\"}[1m])) by (fqdn)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"{{ fqdn }}","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":40,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"GRPC Messages Sent","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":0,"id":20,"legend":{"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg(go_goroutines{environment=\"$environment\", tier=\"$tier\", job=~\"gitaly.*\"}) by (fqdn)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"{{ fqdn}}","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":40,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Gitaly goroutines","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":0,"id":21,"legend":{"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(rate(grpc_server_msg_sent_total{environment=\"$environment\", tier=\"$tier\"}[10m])) by (grpc_method) / sum(rate(grpc_server_msg_received_total{environment=\"$environment\", tier=\"$tier\"}[10m])) by (grpc_method)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"{{ grpc_method }}","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":40,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Outgoing / Incoming Message Rate (log₁₀)","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"","logBase":2,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":5,"id":24,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"1000 * avg(gitaly:grpc_server_handling_seconds:avg5m{environment=\"$environment\"}) by (fqdn)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"{{ fqdn }}","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":40,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Average Gitaly Latencies","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":0,"format":"ms","label":"","logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"}],"schemaVersion":14,"style":"dark","tags":["Gitaly","GitalyMain"],"templating":{"list":[{"allValue":null,"current":{"selected":true,"text":"prd","value":"prd"},"datasource":"Prometheus in Azure","hide":0,"includeAll":false,"label":null,"multi":false,"name":"environment","options":[],"query":"up{job=~\"gitaly.*\"}\t","refresh":1,"regex":"/.*environment=\"(.*?)\".*/","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"text":"stor","value":"stor"},"datasource":"Prometheus in Azure","hide":0,"includeAll":false,"label":null,"multi":false,"name":"tier","options":[],"query":"up{job=~\"gitaly.*\"}\t","refresh":1,"regex":"/.*tier=\"(.*?)\".*/","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"tags":[],"text":"10m","value":"10m"},"hide":0,"includeAll":false,"label":null,"multi":false,"name":"resolution","options":[{"selected":false,"text":"1m","value":"1m"},{"selected":true,"text":"10m","value":"10m"},{"selected":false,"text":"1h","value":"1h"},{"selected":false,"text":"12h","value":"12h"}],"query":"1m,10m,1h,12h","type":"custom"}]},"time":{"from":"now-1h","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"utc","title":"Gitaly Fleet Overview","version":31}}