{"meta":{"type":"db","canSave":false,"canEdit":false,"canAdmin":false,"canStar":true,"slug":"seasonal-experiments","url":"/d/8uv121Bik/seasonal-experiments","expires":"0001-01-01T00:00:00Z","created":"2018-11-16T16:39:45Z","updated":"2018-11-16T17:05:40Z","updatedBy":"ops-contact@gitlab.com","createdBy":"ops-contact@gitlab.com","version":2,"hasAcl":false,"isFolder":false,"folderId":184,"folderTitle":".ONCE OFF","folderUrl":"/dashboards/f/kGgx9rIiz/once-off","provisioned":false,"provisionedExternalId":""},"dashboard":{"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"expr":"ALERTS{environment=\"$environment\", type=\"$type\"}","hide":true,"iconColor":"rgba(0, 211, 255, 1)","limit":100,"name":"Annotations \u0026 Alerts","showIn":0,"type":"dashboard"}]},"description":"$type","editable":true,"gnetId":null,"graphTooltip":1,"id":null,"iteration":1542387547514,"links":[{"icon":"external link","includeVars":false,"keepTime":true,"tags":["general triage"],"type":"dashboards"},{"icon":"external link","tags":[],"targetBlank":true,"title":"$type Runbook","tooltip":"","type":"link","url":"https://gitlab.com/gitlab-com/runbooks/blob/master/troubleshooting/service-$type.md"},{"icon":"external link","tags":[],"targetBlank":true,"title":"AlertManager","tooltip":"AlertManager","type":"link","url":"https://alerts.gprd.gitlab.net/#/alerts?filter=%7Benvironment%3D%22$environment%22%2C%20type%3D%22$type%22%7D"}],"panels":[{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":10,"panels":[],"title":"Operation Rates","type":"row"},{"aliasColors":{"web service":"#890f02"},"bars":false,"dashLength":10,"dashes":false,"datasource":"$prometheus_ds","fill":0,"gridPos":{"h":9,"w":24,"x":0,"y":1},"id":44,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":450,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/upper|lower/","color":"#dddddd","dashLength":2,"dashes":true,"legend":false,"spaceLength":1,"zindex":-3},{"alias":"upper (gprd-app)","color":"lightyellow","fillBelowTo":"lower (gprd-app)","lines":false},{"alias":"lower (gprd-app)","color":"lightyellow","lines":false},{"alias":"upper (gprd-default)","color":"lightblue","fillBelowTo":"lower (gprd-default)","lines":false},{"alias":"lower (gprd-default)","color":"lightblue","lines":false},{"alias":"upper","fill":2,"fillBelowTo":"lower","lines":false,"nullPointMode":"connected"},{"alias":"lower","lines":false,"nullPointMode":"connected"},{"alias":"/^Alert /","fill":1,"hideTooltip":true,"legend":false,"yaxis":2},{"alias":"Alert pending","color":"orange"},{"alias":"Alert firing","color":"red"},{"alias":"/ service$/","color":"#1f78c1","linewidth":2},{"alias":"/1 week ago/","color":"#888888","dashLength":2,"dashes":true,"fill":0,"linewidth":1,"spaceLength":1,"zindex":-3},{"alias":"lower","lines":false}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(avg_over_time(gitlab_service_ops:rate{environment=\"$environment\", type=\"$type\"}[$__interval])) by (type)","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ type }} service","refId":"A"},{"expr":"max(max_over_time(ALERTS{environment=\"$environment\", metric=\"gitlab_service_ops\", type=\"$type\"}[$__interval])) by (alertstate)","format":"time_series","interval":"2m","intervalFactor":1,"legendFormat":"Alert {{alertstate}}","refId":"D"},{"expr":"sum(avg_over_time(gitlab_service_ops:rate{environment=\"$environment\", type=\"$type\"}[$__interval] offset 1w)) by (type)","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ type }} - 1 week ago","refId":"E"},{"expr":"gitlab_service_ops:rate:prediction{environment=\"$environment\", type=\"$type\"}+ \n$sigma * gitlab_service_ops:rate:stddev_over_time_1w{component=\"\", environment=\"$environment\", type=\"$type\"}","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"upper","refId":"F"},{"expr":"sum(\nclamp_min(\ngitlab_service_ops:rate:prediction{environment=\"$environment\", type=\"$type\"}  \n- $sigma * gitlab_service_ops:rate:stddev_over_time_1w{component=\"\", environment=\"$environment\", type=\"$type\"}, 0)\n)","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"lower","refId":"G"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"$type Service Operation Rates (Periodic)","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":null,"format":"short","label":"","logBase":1,"max":null,"min":"0","show":true},{"decimals":null,"format":"percentunit","label":null,"logBase":1,"max":"1","min":"0","show":false}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{"web service":"#890f02"},"bars":false,"dashLength":10,"dashes":false,"datasource":"$prometheus_ds","fill":0,"gridPos":{"h":9,"w":24,"x":0,"y":10},"id":45,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":450,"sort":"current","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/upper|lower/","color":"#dddddd","dashLength":2,"dashes":true,"legend":false,"spaceLength":1,"zindex":-3},{"alias":"upper (gprd-app)","color":"lightyellow","fillBelowTo":"lower (gprd-app)","lines":false},{"alias":"lower (gprd-app)","color":"lightyellow","lines":false},{"alias":"upper (gprd-default)","color":"lightblue","fillBelowTo":"lower (gprd-default)","lines":false},{"alias":"lower (gprd-default)","color":"lightblue","lines":false},{"alias":"upper","fill":2,"fillBelowTo":"lower","lines":false,"nullPointMode":"connected"},{"alias":"lower","lines":false,"nullPointMode":"connected"},{"alias":"/^Alert /","fill":1,"hideTooltip":true,"legend":false,"yaxis":2},{"alias":"Alert pending","color":"orange"},{"alias":"Alert firing","color":"red"},{"alias":"/ service$/","color":"#1f78c1","linewidth":2},{"alias":"/1 week ago/","color":"#888888","dashLength":2,"dashes":true,"fill":0,"linewidth":1,"spaceLength":1,"zindex":-3},{"alias":"lower","lines":false}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(avg_over_time(gitlab_service_ops:rate{environment=\"$environment\", type=\"$type\"}[$__interval])) by (type)","format":"time_series","hide":true,"interval":"1m","intervalFactor":1,"legendFormat":"{{ type }} service","refId":"A"},{"expr":"max(max_over_time(ALERTS{environment=\"$environment\", metric=\"gitlab_service_ops\", type=\"$type\"}[$__interval])) by (alertstate)","format":"time_series","hide":true,"interval":"2m","intervalFactor":1,"legendFormat":"Alert {{alertstate}}","refId":"D"},{"expr":"sum(avg_over_time(gitlab_service_ops:rate{environment=\"$environment\", type=\"$type\"}[$__interval] offset 1w)) by (type)","format":"time_series","hide":true,"interval":"1m","intervalFactor":1,"legendFormat":"{{ type }} - 1 week ago","refId":"E"},{"expr":"gitlab_service_ops:rate:prediction{environment=\"$environment\", type=\"$type\"}+ \n$sigma * gitlab_service_ops:rate:stddev_over_time_1w{component=\"\", environment=\"$environment\", type=\"$type\"}","format":"time_series","hide":true,"interval":"5m","intervalFactor":1,"legendFormat":"upper","refId":"F"},{"expr":"sum(\nclamp_min(\ngitlab_service_ops:rate:prediction{environment=\"$environment\", type=\"$type\"}  \n- $sigma * gitlab_service_ops:rate:stddev_over_time_1w{component=\"\", environment=\"$environment\", type=\"$type\"}, 0)\n)","format":"time_series","hide":true,"interval":"5m","intervalFactor":1,"legendFormat":"lower","refId":"G"},{"expr":"stddev_over_time(gitlab_service_ops:rate[1h] offset 1w)","format":"time_series","hide":true,"intervalFactor":1,"legendFormat":"","refId":"B"},{"expr":"gitlab_service_ops:rate{type=\"pages\", environment=\"gprd\"}","format":"time_series","intervalFactor":1,"legendFormat":"","refId":"C"},{"expr":"avg_over_time(gitlab_service_ops:rate{type=\"pages\", environment=\"gprd\"}[1h])","format":"time_series","intervalFactor":1,"legendFormat":"","refId":"H"},{"expr":"avg_over_time(gitlab_service_ops:rate{type=\"pages\", environment=\"gprd\"}[1h]) + $sigma * stddev_over_time(gitlab_service_ops:rate{type=\"pages\", environment=\"gprd\"}[1h])","format":"time_series","intervalFactor":1,"legendFormat":"","refId":"I"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"$type Service Operation Rates (Periodic)","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":null,"format":"short","label":"","logBase":1,"max":null,"min":"0","show":true},{"decimals":null,"format":"percentunit","label":null,"logBase":1,"max":"1","min":"0","show":false}],"yaxis":{"align":false,"alignLevel":null}}],"refresh":false,"schemaVersion":16,"style":"dark","tags":["general triage"],"templating":{"list":[{"current":{"text":"Global","value":"Global"},"hide":0,"label":null,"name":"prometheus_ds","options":[],"query":"prometheus","refresh":1,"regex":"/(.*-gprd|Global)/","skipUrlSync":false,"type":"datasource"},{"allValue":null,"current":{"text":"gprd","value":"gprd"},"datasource":"$prometheus_ds","hide":0,"includeAll":false,"label":null,"multi":false,"name":"environment","options":[],"query":"label_values(up, environment)","refresh":1,"regex":"","skipUrlSync":false,"sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"tags":[],"text":"postgres","value":"postgres"},"datasource":"$prometheus_ds","hide":0,"includeAll":false,"label":null,"multi":false,"name":"type","options":[],"query":"label_values(up{environment=\"$environment\"}, type)","refresh":1,"regex":"","skipUrlSync":false,"sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"selected":true,"tags":[],"text":"1.5","value":"1.5"},"hide":0,"includeAll":false,"label":"σ","multi":false,"name":"sigma","options":[{"selected":false,"text":"0.5","value":"0.5"},{"selected":false,"text":"1","value":"1"},{"selected":true,"text":"1.5","value":"1.5"},{"selected":false,"text":"2","value":"2"},{"selected":false,"text":"2.5","value":"2.5"},{"selected":false,"text":"3","value":"3"}],"query":"0.5,1,1.5,2,2.5,3","skipUrlSync":false,"type":"custom"},{"allValue":null,"current":{"text":"All","value":"$__all"},"datasource":"$prometheus_ds","hide":2,"includeAll":true,"label":null,"multi":false,"name":"component_availability","options":[],"query":"label_values(gitlab_component_availability:ratio{environment=\"$environment\", type=\"$type\"}, component)","refresh":1,"regex":"","skipUrlSync":false,"sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"text":"All","value":"$__all"},"datasource":"$prometheus_ds","hide":2,"includeAll":true,"label":null,"multi":false,"name":"component_ops","options":[],"query":"label_values(gitlab_component_ops:rate{environment=\"$environment\", type=\"$type\"}, component)","refresh":1,"regex":"","skipUrlSync":false,"sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"text":"All","value":"$__all"},"datasource":"$prometheus_ds","hide":2,"includeAll":true,"label":null,"multi":false,"name":"component_apdex","options":[],"query":"label_values(gitlab_component_apdex:ratio{environment=\"$environment\", type=\"$type\"}, component)","refresh":1,"regex":"","skipUrlSync":false,"sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"text":"All","value":"$__all"},"datasource":"$prometheus_ds","hide":2,"includeAll":true,"label":null,"multi":false,"name":"component_errors","options":[],"query":"label_values(gitlab_component_errors:rate{environment=\"$environment\", type=\"$type\"}, component)","refresh":1,"regex":"","skipUrlSync":false,"sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-2d","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"","title":"Seasonal Experiments","uid":"8uv121Bik","version":2}}