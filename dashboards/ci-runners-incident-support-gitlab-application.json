{"meta":{"type":"db","canSave":false,"canEdit":true,"canAdmin":false,"canStar":true,"slug":"ci-runners-incident-support-gitlab-application","url":"/d/ci-runners-incident-gitlab-application/ci-runners-incident-support-gitlab-application","expires":"0001-01-01T00:00:00Z","created":"2021-03-24T16:30:40Z","updated":"2021-04-12T19:42:56Z","updatedBy":"ops-contact@gitlab.com","createdBy":"ops-contact@gitlab.com","version":75,"hasAcl":false,"isFolder":false,"folderId":1187,"folderTitle":"ci-runners","folderUrl":"/dashboards/f/ci-runners/ci-runners","provisioned":false,"provisionedExternalId":""},"dashboard":{"__inputs":[],"__requires":[],"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":false,"iconColor":"#96D98D","name":"deploy","showIn":0,"tags":["deploy","$environment"],"type":"tags"},{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":false,"iconColor":"#FFEE52","name":"canary-deploy","showIn":0,"tags":["deploy","${environment}-cny"],"type":"tags"},{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":false,"iconColor":"#CA95E5","name":"feature-flags","showIn":0,"tags":["feature-flag","${environment}"],"type":"tags"}]},"description":"Uploaded by https://gitlab.com/gitlab-com/runbooks/-/jobs/1173472063 at Mon Apr 12 19:42:55 UTC 2021","editable":false,"gnetId":null,"graphTooltip":1,"hideControls":false,"id":null,"links":[{"asDropdown":true,"icon":"dashboard","includeVars":true,"keepTime":true,"tags":"type:ci-runners","targetBlank":false,"title":"ci-runners Detail","type":"dashboards","url":""},{"asDropdown":true,"icon":"dashboard","includeVars":true,"keepTime":true,"tags":"ci-runners:incident-support","targetBlank":false,"title":"ci-runners Incident Dashboards","type":"dashboards","url":""}],"panels":[{"content":"Made with ‚ù§Ô∏è and [Grafonnet](https://github.com/grafana/grafonnet-lib). [Contribute to this dashboard on GitLab.com](https://gitlab.com/gitlab-com/runbooks/blob/master/dashboards/./ci-runners/incident-gitlab-application.dashboard.jsonnet)\n","datasource":null,"gridPos":{"h":2,"w":24,"x":0,"y":110000},"id":2,"mode":"markdown","title":"Source","type":"text"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Apdex is a measure of requests that complete within a tolerable period of time for the service. Higher is better.","fill":0,"gridPos":{"h":6,"w":6,"x":0,"y":1},"id":3,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"dataLinks":[{"targetBlank":true,"title":"ci-runners Service Apdex SLO Analysis","url":"/d/alerts-service_slo_apdex?${__url_time_range}\u0026${__all_variables}\u0026var-type=ci-runners\u0026var-stage=$stage"}]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"6h Degradation SLO (5% of monthly error budget)","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"1h Outage SLO (2% of monthly error budget)","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"SLO","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"ci-runners apdex","color":"#E7D551","zindex":3},{"alias":"ci-runners apdex avg","color":"#5794F2","dashLength":1,"fillBelowTo":"ci-runners apdex","linewidth":1,"spaceLength":1,"zindex":-3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3}],"spaceLength":10,"stableId":"service-ci-runners-apdex","stack":false,"steppedLine":false,"targets":[{"expr":"min_over_time(gitlab_service_apdex:ratio_5m{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"ci-runners apdex","refId":"A"},{"expr":"(1 - 6 * (1 - avg(slo:min:events:gitlab_service_apdex:ratio{monitor=\"global\",type=\"ci-runners\"})))\n","format":"time_series","interval":"5m","intervalFactor":3,"legendFormat":"6h Degradation SLO (5% of monthly error budget)","refId":"B"},{"expr":"(1 - 14.4 * (1 - avg(slo:min:events:gitlab_service_apdex:ratio{monitor=\"global\",type=\"ci-runners\"})))\n","format":"time_series","interval":"5m","intervalFactor":3,"legendFormat":"1h Outage SLO (2% of monthly error budget)","refId":"C"},{"expr":"avg_over_time(gitlab_service_apdex:ratio_5m{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"ci-runners apdex avg","refId":"D"},{"expr":"clamp_min(\n  gitlab_service_apdex:ratio_5m{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"} offset 1w\n,\n  scalar(min((1 - 14.4 * (1 - avg(slo:min:events:gitlab_service_apdex:ratio{monitor=\"global\",type=\"ci-runners\"})))\n))\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"last week","refId":"E"}],"title":"ci-runners Service Apdex","tooltip":{"shared":true,"sort":1,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Apdex %","logBase":1,"max":1,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"gridPos":{"h":1,"w":6,"x":0,"y":7},"id":4,"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"mappings":[{"from":"0","id":0,"op":"=","text":"Healthy","to":"0","type":2,"value":"0"},{"from":"1","id":1,"op":"=","text":"Warning üî•","to":"1","type":2,"value":"1"},{"from":"2","id":2,"op":"=","text":"Warning üî•","to":"2","type":2,"value":"2"},{"from":"3","id":3,"op":"=","text":"Degraded üî•","to":"3","type":2,"value":"3"},{"from":"4","id":4,"op":"=","text":"Warning ü•µ","to":"4","type":2,"value":"4"},{"from":"5","id":5,"op":"=","text":"Warning üî•ü•µ","to":"5","type":2,"value":"5"},{"from":"6","id":6,"op":"=","text":"Warning üî•ü•µ","to":"6","type":2,"value":"6"},{"from":"7","id":7,"op":"=","text":"Degraded üî•ü•µ","to":"7","type":2,"value":"7"},{"from":"8","id":8,"op":"=","text":"Warning ü•µ","to":"8","type":2,"value":"8"},{"from":"9","id":9,"op":"=","text":"Warning üî•ü•µ","to":"9","type":2,"value":"9"},{"from":"10","id":10,"op":"=","text":"Warning üî•ü•µ","to":"10","type":2,"value":"10"},{"from":"11","id":11,"op":"=","text":"Degraded üî•ü•µ","to":"11","type":2,"value":"11"},{"from":"12","id":12,"op":"=","text":"Degraded ü•µ","to":"12","type":2,"value":"12"},{"from":"13","id":13,"op":"=","text":"Degraded üî•ü•µ","to":"13","type":2,"value":"13"},{"from":"14","id":14,"op":"=","text":"Degraded üî•ü•µ","to":"14","type":2,"value":"14"},{"from":"15","id":15,"op":"=","text":"Degraded üî•ü•µ","to":"15","type":2,"value":"15"}],"nullValueMode":"connected","thresholds":{"mode":"absolute","steps":[{"color":"black","value":0},{"color":"orange","value":1},{"color":"orange","value":2},{"color":"red","value":3},{"color":"orange","value":4},{"color":"orange","value":5},{"color":"orange","value":6},{"color":"red","value":7},{"color":"orange","value":8},{"color":"orange","value":9},{"color":"orange","value":10},{"color":"red","value":11},{"color":"red","value":12},{"color":"red","value":13},{"color":"red","value":14},{"color":"red","value":15}]},"title":"Status","unit":"none"},"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"sum(\n  label_replace(\n    vector(0) and on() (gitlab_service_apdex:ratio_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"}),\n    \"period\", \"na\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(1) and on () (gitlab_service_apdex:ratio_5m{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"} \u003c on(tier, type) group_left() (1 - (14.4 * (1 - slo:min:events:gitlab_service_apdex:ratio{monitor=\"global\",type=\"ci-runners\"})))),\n    \"period\", \"5m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(2) and on () (gitlab_service_apdex:ratio_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"} \u003c on(tier, type) group_left() (1 - (14.4 * (1 - slo:min:events:gitlab_service_apdex:ratio{monitor=\"global\",type=\"ci-runners\"})))),\n    \"period\", \"1h\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(4) and on () (gitlab_service_apdex:ratio_30m{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"} \u003c on(tier, type) group_left() (1 - (6 * (1 - slo:min:events:gitlab_service_apdex:ratio{monitor=\"global\",type=\"ci-runners\"})))),\n    \"period\", \"30m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(8) and on () (gitlab_service_apdex:ratio_6h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"} \u003c on(tier, type) group_left() (1 - (6 * (1 - slo:min:events:gitlab_service_apdex:ratio{monitor=\"global\",type=\"ci-runners\"})))),\n    \"period\", \"6h\", \"\", \"\"\n  )\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":"ci-runners Service | Latency/Apdex"}],"title":"","type":"stat"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Error rates are a measure of unhandled service exceptions per second. Client errors are excluded when possible. Lower is better","fill":0,"gridPos":{"h":6,"w":6,"x":6,"y":1},"id":5,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"dataLinks":[{"targetBlank":true,"title":"ci-runners Service Error-Rate SLO Analysis","url":"/d/alerts-service_slo_error?${__url_time_range}\u0026${__all_variables}\u0026var-type=ci-runners\u0026var-stage=$stage"}]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"6h Degradation SLO (5% of monthly error budget)","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"1h Outage SLO (2% of monthly error budget)","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"ci-runners error ratio","color":"#E7D551","fillBelowTo":"ci-runners error ratio avg","zindex":3},{"alias":"ci-runners error ratio avg","color":"#5794F2","dashLength":1,"fillGradient":10,"linewidth":1,"spaceLength":1,"zindex":-3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3}],"spaceLength":10,"stableId":"service-ci-runners-error-rate","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_max(\n  max_over_time(gitlab_service_errors:ratio_5m{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"ci-runners error ratio","refId":"A"},{"expr":"(6 * avg(slo:max:events:gitlab_service_errors:ratio{monitor=\"global\",type=\"ci-runners\"}))\n","format":"time_series","interval":"5m","intervalFactor":3,"legendFormat":"6h Degradation SLO (5% of monthly error budget)","refId":"B"},{"expr":"(14.4 * avg(slo:max:events:gitlab_service_errors:ratio{monitor=\"global\",type=\"ci-runners\"}))\n","format":"time_series","interval":"5m","intervalFactor":3,"legendFormat":"1h Outage SLO (2% of monthly error budget)","refId":"C"},{"expr":"clamp_max(\n  avg_over_time(gitlab_service_errors:ratio_5m{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"ci-runners error ratio avg","refId":"D"},{"expr":"clamp_max(\n  gitlab_service_errors:ratio_5m{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"} offset 1w\n,\n  scalar(max((14.4 * avg(slo:max:events:gitlab_service_errors:ratio{monitor=\"global\",type=\"ci-runners\"}))\n))\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"last week","refId":"E"}],"title":"ci-runners Service Error Ratio","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Error %","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"gridPos":{"h":1,"w":6,"x":6,"y":7},"id":6,"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"mappings":[{"from":"0","id":0,"op":"=","text":"Healthy","to":"0","type":2,"value":"0"},{"from":"1","id":1,"op":"=","text":"Warning üî•","to":"1","type":2,"value":"1"},{"from":"2","id":2,"op":"=","text":"Warning üî•","to":"2","type":2,"value":"2"},{"from":"3","id":3,"op":"=","text":"Degraded üî•","to":"3","type":2,"value":"3"},{"from":"4","id":4,"op":"=","text":"Warning ü•µ","to":"4","type":2,"value":"4"},{"from":"5","id":5,"op":"=","text":"Warning üî•ü•µ","to":"5","type":2,"value":"5"},{"from":"6","id":6,"op":"=","text":"Warning üî•ü•µ","to":"6","type":2,"value":"6"},{"from":"7","id":7,"op":"=","text":"Degraded üî•ü•µ","to":"7","type":2,"value":"7"},{"from":"8","id":8,"op":"=","text":"Warning ü•µ","to":"8","type":2,"value":"8"},{"from":"9","id":9,"op":"=","text":"Warning üî•ü•µ","to":"9","type":2,"value":"9"},{"from":"10","id":10,"op":"=","text":"Warning üî•ü•µ","to":"10","type":2,"value":"10"},{"from":"11","id":11,"op":"=","text":"Degraded üî•ü•µ","to":"11","type":2,"value":"11"},{"from":"12","id":12,"op":"=","text":"Degraded ü•µ","to":"12","type":2,"value":"12"},{"from":"13","id":13,"op":"=","text":"Degraded üî•ü•µ","to":"13","type":2,"value":"13"},{"from":"14","id":14,"op":"=","text":"Degraded üî•ü•µ","to":"14","type":2,"value":"14"},{"from":"15","id":15,"op":"=","text":"Degraded üî•ü•µ","to":"15","type":2,"value":"15"}],"nullValueMode":"connected","thresholds":{"mode":"absolute","steps":[{"color":"black","value":0},{"color":"orange","value":1},{"color":"orange","value":2},{"color":"red","value":3},{"color":"orange","value":4},{"color":"orange","value":5},{"color":"orange","value":6},{"color":"red","value":7},{"color":"orange","value":8},{"color":"orange","value":9},{"color":"orange","value":10},{"color":"red","value":11},{"color":"red","value":12},{"color":"red","value":13},{"color":"red","value":14},{"color":"red","value":15}]},"title":"Status","unit":"none"},"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"sum (\n  label_replace(\n    vector(0) and on() (gitlab_service_errors:ratio_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"}),\n    \"period\", \"na\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(1) and on() (gitlab_service_errors:ratio_5m{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"} \u003e on(tier, type) group_left() (14.4 * slo:max:events:gitlab_service_errors:ratio{monitor=\"global\",type=\"ci-runners\"})),\n    \"period\", \"5m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(2) and on() (gitlab_service_errors:ratio_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"} \u003e on(tier, type) group_left() (14.4 * slo:max:events:gitlab_service_errors:ratio{monitor=\"global\",type=\"ci-runners\"})),\n    \"period\", \"1h\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(4) and on() (gitlab_service_errors:ratio_30m{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"} \u003e on(tier, type) group_left() (6 * slo:max:events:gitlab_service_errors:ratio{monitor=\"global\",type=\"ci-runners\"})),\n    \"period\", \"30m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(8) and on() (gitlab_service_errors:ratio_6h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"} \u003e on(tier, type) group_left() (6 * slo:max:events:gitlab_service_errors:ratio{monitor=\"global\",type=\"ci-runners\"})),\n    \"period\", \"6h\", \"\", \"\"\n  )\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":"ci-runners Service | Errors"}],"title":"","type":"stat"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"The operation rate is the sum total of all requests being handle for all components within this service. Note that a single user request can lead to requests to multiple components. Higher is busier.","fill":0,"gridPos":{"h":7,"w":6,"x":12,"y":1},"id":7,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"ci-runners RPS","color":"#E7D551","zindex":3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3},{"alias":"upper normal","color":"#73BF69","dashLength":8,"dashes":true,"fillBelowTo":"lower normal","legend":false,"lines":false,"linewidth":1,"nullPointMode":"connected","spaceLength":8,"zindex":-3},{"alias":"lower normal","color":"#73BF69","dashLength":8,"dashes":true,"legend":false,"lines":false,"linewidth":1,"nullPointMode":"connected","spaceLength":8,"zindex":-3}],"spaceLength":10,"stableId":"service-ci-runners-ops-rate","stack":false,"steppedLine":false,"targets":[{"expr":"avg_over_time(gitlab_service_ops:rate_5m{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"ci-runners RPS","refId":"A"},{"expr":"gitlab_service_ops:rate_5m{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"} offset 1w\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"last week","refId":"B"},{"expr":"clamp_min(\n  avg by (type) (\n    gitlab_service_ops:rate:prediction{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"}\n    + (1) *\n    gitlab_service_ops:rate:stddev_over_time_1w{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"}\n  ),\n  0\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"upper normal","refId":"C"},{"expr":"clamp_min(\n  avg by (type) (\n    gitlab_service_ops:rate:prediction{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"}\n    + (-1) *\n    gitlab_service_ops:rate:stddev_over_time_1w{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"}\n  ),\n  0\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"lower normal","refId":"D"}],"title":"ci-runners Service RPS - Requests per Second","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Operations per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Saturation is a measure of what ratio of a finite resource is currently being utilized. Lower is better.","fill":0,"gridPos":{"h":7,"w":6,"x":18,"y":1},"id":8,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stableId":"service-utilization","stack":false,"steppedLine":false,"targets":[{"expr":"max(\n  max_over_time(\n    gitlab_component_saturation:ratio{environment=\"$environment\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"}[$__interval]\n  )\n) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ component }} component","refId":"A"}],"title":"Saturation","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":1,"gridPos":{"h":7,"w":4.8,"x":0,"y":1000},"id":9,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"expr":"sum by(shard) (gitlab_runner_jobs{instance=~\"${runner_manager:pipe}\"})","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ shard }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Jobs running on GitLab Inc. runners (by shard)","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":true,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":1,"gridPos":{"h":7,"w":4.8,"x":4.8,"y":1000},"id":10,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":false,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"expr":"sum by(shard) (\n  increase(gitlab_runner_jobs_total{instance=~\"${runner_manager:pipe}\"}[$__interval])\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ shard }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Jobs started on runners (by shard)","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"cards":{"cardPadding":1,"cardRound":2},"color":{"cardColor":"#FA6400","colorScale":"sqrt","exponent":0.5,"mode":"opacity"},"dataFormat":"tsbuckets","datasource":"$PROMETHEUS_DS","gridPos":{"h":7,"w":4.8,"x":9.6,"y":1000},"heatmap":{},"hideZeroBuckets":false,"highlightCards":true,"id":11,"legend":{"show":false},"targets":[{"dsType":"influxdb","expr":"sum by (le) (\n  rate(job_queue_duration_seconds_bucket{environment=~\"$environment\", jobs_running_for_project=~\"$jobs_running_for_project\"}[$__interval])\n)\n","format":"heatmap","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"$__interval","intervalFactor":1,"legendFormat":"{{le}}","orderByTime":"ASC","refId":"A","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]]}],"title":"Pending job queue duration histogram","tooltip":{"show":true,"showHistogram":true},"tooltipDecimals":3,"type":"heatmap","xAxis":{"show":true},"xBucketNumber":null,"xBucketSize":null,"yAxis":{"decimals":2,"format":"s","show":true,"splitFactor":null},"yBucketBound":"auto"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"gridPos":{"h":7,"w":4.8,"x":14.399999999999999,"y":1000},"id":12,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"histogram_quantile(\n  0.99,\n  sum by (le, runner_type) (\n    increase(gitlab_ci_queue_size_total_bucket{environment=~\"$environment\"}[$__interval])\n  )\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{runner_type}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Pending jobs queue size","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"content":"Most logic of how pipelines and jobs are being handled is happening in GitLab. Runner is the last\nelement of the chain - it asks for a job and receives the payload **if any job was scheduled by GitLab\nfor that Runner**.\n\n**Please remember: It's Runner that asks for jobs. It's Runner that sends back the responses. Apart of\nCI Web Terminal feature (which we haven't configured on our runners fleet) the communicatation always\ngoes in this direction - from Runner to GitLab.**\n\nTherefore Runners are vulnerable for any problems happening on GitLab side, whether these are problem with\nAPI (that Runner uses to talk with GitLab), problems with skidekiq (which is used to handle many background\ntaksks related to pipelines and jobs handling) or queueing and long polling that we've implemented in\nGitLab Workhose.\n\nKnown problem indicators:\n- increased number of 5xx errors observed by Runner for some requests that they are doing against GitLab's API,\n- increased size of pipeline.* queues in sidekiq,\n- general load increase on API nodes,\n- misbehavior of workhorse long polling,\n- increased timing of workhorse queueing.\n\nGitLab Application problems affecting Runners are usually caused by three reasons:\n- Database slowness that affects every part of the application stack. You can double check this with the dedicated\n  dashboard: open the `ci-runners Incident Dashboards` list and select `ci-runners: Incident Support: database`.\n  If the database is slow, then this should be our main concern and efforts should be shifted there.\n\n  Please note that the `/api/v4/jobs/request` endpoint is known of being the main cause of database problems\n  when it goes for CI (the size of `ci_builds` and complexity of jobs scheduling query is enormous) and usually the\n  main victim of such slowness in the CI area. There is an ongoing work on fixing this part.\n\n- Sidekiq problems. Any Sidekiq problems that affect the time of processing of `pipeline.*` queues may affect the\n  affect the user experience, especially when it goes for transitioning jobs and pipelines between different states.\n  If Sidekiq metrics for `pipeline.*` look strange, double check that we don't have load problem on the sidekiq nodes\n  nor that there are no problems with Redis.\n\n- Workhorse polling and queueing problems. All requests made by Runner are going through GitLab Workhorse. For the\n  most important endpoint - `POST /api/v4/jobs/request` - we've implemented a long polling mechanism that reduces\n  the amount of requests created by Runners. All the requests can be also queued on the Workhorse level if Rails\n  is slow in handling them. Therefore any misconfiguration here may lead to problems with requests handling. Double\n  check that there was no changes in Workhorse configuration or Workhorse itself if there are any problems observed\n  on the Workhorse graphs.\n","datasource":null,"gridPos":{"h":7,"w":4.8,"x":19.2,"y":1000},"id":13,"mode":"markdown","title":"gitlab-application caused incident notes","type":"text"},{"aliasColors":{},"bars":true,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"gridPos":{"h":6,"w":8,"x":0,"y":3000},"id":14,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":false,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"expr":"sum by(status) (\n  increase(\n    gitlab_runner_api_request_statuses_total{instance=~\"${runner_manager:pipe}\",endpoint=\"request_job\",status=~\".*\"}[$__interval]\n  )\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{status}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Runner requests for request_job [.*]","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ops","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":true,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"gridPos":{"h":6,"w":8,"x":8,"y":3000},"id":15,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":false,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"expr":"sum by(status) (\n  increase(\n    gitlab_runner_api_request_statuses_total{instance=~\"${runner_manager:pipe}\",endpoint=\"update_job\",status=~\".*\"}[$__interval]\n  )\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{status}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Runner requests for update_job [.*]","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ops","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":true,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"gridPos":{"h":6,"w":8,"x":16,"y":3000},"id":16,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":false,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"expr":"sum by(status) (\n  increase(\n    gitlab_runner_api_request_statuses_total{instance=~\"${runner_manager:pipe}\",endpoint=\"patch_trace\",status=~\".*\"}[$__interval]\n  )\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{status}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Runner requests for patch_trace [.*]","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ops","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":true,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"gridPos":{"h":6,"w":8,"x":0,"y":4000},"id":17,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":false,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"expr":"sum by(status) (\n  increase(\n    gitlab_runner_api_request_statuses_total{instance=~\"${runner_manager:pipe}\",endpoint=\"request_job\",status=~\"(4|5)..\"}[$__interval]\n  )\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{status}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Runner requests for request_job [(4|5)..]","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ops","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":true,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"gridPos":{"h":6,"w":8,"x":8,"y":4000},"id":18,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":false,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"expr":"sum by(status) (\n  increase(\n    gitlab_runner_api_request_statuses_total{instance=~\"${runner_manager:pipe}\",endpoint=\"update_job\",status=~\"(4|5)..\"}[$__interval]\n  )\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{status}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Runner requests for update_job [(4|5)..]","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ops","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":true,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"gridPos":{"h":6,"w":8,"x":16,"y":4000},"id":19,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":false,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"expr":"sum by(status) (\n  increase(\n    gitlab_runner_api_request_statuses_total{instance=~\"${runner_manager:pipe}\",endpoint=\"patch_trace\",status=~\"(4|5)..\"}[$__interval]\n  )\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{status}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Runner requests for patch_trace [(4|5)..]","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ops","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"This graph shows the rate of the Sidekiq jobs (related to CI/CD and Runner) that have been enqueued but not yet\nfinished. A steep rise here means a backlog of jobs is being built and this means that Sidekiq is most probably\nhaving trouble keeping up.\n","fill":0,"gridPos":{"h":8,"w":8,"x":0,"y":5000},"id":20,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"(\n  sum by (worker) (\n    sidekiq_jobs_inflight:irate1m{environment=\"$environment\", stage=\"$stage\", feature_category=~\"(continuous_integration|runner)\"}\n  )\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{worker}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Sidekiq CI and Runner in flight jobs","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Loadavg (5 minute) per core, below 1 is better.","fill":0,"gridPos":{"h":8,"w":8,"x":8,"y":5000},"id":21,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":false,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"avg by (environment, type, stage, fqdn) (node_load5{environment=\"$environment\", stage=\"$stage\", type=\"api\"})\n/\ncount by (environment, type, stage, fqdn) (node_cpu_seconds_total{mode=\"idle\", environment=\"$environment\", stage=\"$stage\", type=\"api\"})\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ fqdn }}","refId":"A"}],"thresholds":[{"colorMode":"custom","fill":true,"fillColor":"rgba(242, 73, 92, 0.5)","line":false,"op":"gt","value":1,"yaxis":"left"},{"colorMode":"custom","fill":true,"fillColor":"rgba(242, 73, 92, 0.25)","line":false,"op":"gt","value":0.8,"yaxis":"left"}],"timeFrom":null,"timeShift":null,"title":"loadavg5 per core","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"loadavg5","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"gridPos":{"h":8,"w":8,"x":16,"y":5000},"id":22,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(\n  job:gitlab_workhorse_http_request_duration_seconds_count:rate1m{environment=~\"$environment\",stage=~\"$stage\",route=~\".*/api/v4/jobs/request.*\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"requests","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"`jobs/request` requests","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ops","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":1,"gridPos":{"h":8,"w":8,"x":0,"y":6000},"id":23,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"expr":"sum by (status) (\n  increase(gitlab_workhorse_builds_register_handler_requests{environment=~\"$environment\",stage=~\"$stage\"}[$__interval])\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{status}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Workhorse long polling - request statuses","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":1,"gridPos":{"h":8,"w":8,"x":8,"y":6000},"id":24,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"expr":"sum by (state) (\n  gitlab_workhorse_builds_register_handler_open{environment=~\"$environment\",stage=~\"$stage\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{state}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Workhorse long polling - open requests","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"gridPos":{"h":8,"w":8,"x":16,"y":6000},"id":25,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (type) (\n  increase(\n    gitlab_workhorse_queueing_errors{environment=~\"$environment\",stage=~\"$stage\",queue_name=\"ci_api_job_requests\"}[$__interval]\n  )\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{type}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Workhorse queueing errors","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ops","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"gridPos":{"h":8,"w":8,"x":0,"y":7000},"id":26,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(\n  gitlab_workhorse_queueing_busy{environment=~\"$environment\",stage=~\"$stage\",queue_name=\"ci_api_job_requests\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"handled","refId":"A"},{"expr":"sum(\n  gitlab_workhorse_queueing_limit{environment=~\"$environment\",stage=~\"$stage\",queue_name=\"ci_api_job_requests\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"limit","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Workhorse queueing - handled requests","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"gridPos":{"h":8,"w":8,"x":8,"y":7000},"id":27,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(\n  gitlab_workhorse_queueing_waiting{environment=~\"$environment\",stage=~\"$stage\",queue_name=\"ci_api_job_requests\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"queued","refId":"A"},{"expr":"sum(\n  gitlab_workhorse_queueing_queue_limit{environment=~\"$environment\",stage=~\"$stage\",queue_name=\"ci_api_job_requests\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"limit","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Workhorse queueing - queued requests","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"gridPos":{"h":8,"w":8,"x":16,"y":7000},"id":28,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"histogram_quantile(\n  0.50,\n  sum by (le) (\n    rate(\n      gitlab_workhorse_queueing_waiting_time_bucket{environment=~\"$environment\",stage=~\"$stage\",queue_name=\"ci_api_job_requests\"}[$__interval]\n    )\n  )\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"50th percentile","refId":"A"},{"expr":"histogram_quantile(\n  0.90,\n  sum by (le) (\n    rate(\n      gitlab_workhorse_queueing_waiting_time_bucket{environment=~\"$environment\",stage=~\"$stage\",queue_name=\"ci_api_job_requests\"}[$__interval]\n    )\n  )\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"90th percentile","refId":"B"},{"expr":"histogram_quantile(\n  0.95,\n  sum by (le) (\n    rate(\n      gitlab_workhorse_queueing_waiting_time_bucket{environment=~\"$environment\",stage=~\"$stage\",queue_name=\"ci_api_job_requests\"}[$__interval]\n    )\n  )\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"95th percentile","refId":"C"},{"expr":"histogram_quantile(\n  0.99,\n  sum by (le) (\n    rate(\n      gitlab_workhorse_queueing_waiting_time_bucket{environment=~\"$environment\",stage=~\"$stage\",queue_name=\"ci_api_job_requests\"}[$__interval]\n    )\n  )\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"99th percentile","refId":"D"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Workhorse queueing time","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]}],"refresh":"1m","rows":[],"schemaVersion":16,"style":"light","tags":["managed","ci-runners","type:ci-runners","managed","ci-runners:incident-support","ci-runners:incident-gl-app"],"templating":{"list":[{"current":{"text":"Global","value":"Global"},"hide":0,"label":null,"name":"PROMETHEUS_DS","options":[],"query":"prometheus","refresh":1,"regex":"/(.*-gprd|Frank|Global|gprd-.*)/","type":"datasource"},{"allValue":null,"current":{"text":"gprd","value":"gprd"},"datasource":"$PROMETHEUS_DS","hide":0,"includeAll":false,"label":null,"multi":false,"name":"environment","options":[],"query":"label_values(gitlab_service_ops:rate, environment)","refresh":1,"regex":"","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"text":"main","value":"main"},"hide":0,"includeAll":false,"label":"","multi":false,"name":"stage","options":[{"text":"main","value":"main"},{"text":"cny","value":"cny"},{"text":"","value":""}],"query":"main,cny,","refresh":0,"type":"custom"},{"allValue":null,"current":{},"datasource":"$PROMETHEUS_DS","hide":0,"includeAll":true,"label":null,"multi":true,"name":"shard","options":[],"query":"label_values(gitlab_runner_version_info{job=~\".*\",job!~\"omnibus-runners|gprd-runner\",shard!=\"default\"}, shard)\n","refresh":1,"regex":"","sort":true,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{},"datasource":"$PROMETHEUS_DS","hide":0,"includeAll":true,"label":null,"multi":true,"name":"runner_manager","options":[],"query":"query_result(label_replace(gitlab_runner_version_info{shard=~\"$shard\"}, \"fqdn\", \"$1.*\", \"instance\", \"(.*):[0-9]+$\"))\n","refresh":1,"regex":"/fqdn=\"([^\"]+)\"/","sort":true,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"text":"0","value":"0"},"datasource":"$PROMETHEUS_DS","hide":0,"includeAll":true,"label":null,"multi":true,"name":"jobs_running_for_project","options":[],"query":"label_values(job_queue_duration_seconds_sum, jobs_running_for_project)\n","refresh":1,"regex":"","sort":true,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-3h/m","to":"now/m"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"utc","title":"ci-runners: Incident Support: gitlab-application","uid":"ci-runners-incident-gitlab-application","version":75}}