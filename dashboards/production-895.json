{"meta":{"type":"db","canSave":false,"canEdit":false,"canAdmin":false,"canStar":true,"slug":"production-895","url":"/d/KiMEyy7Wk/production-895","expires":"0001-01-01T00:00:00Z","created":"2019-06-18T09:41:58Z","updated":"2019-06-19T11:40:35Z","updatedBy":"ops-contact@gitlab.com","createdBy":"ops-contact@gitlab.com","version":9,"hasAcl":false,"isFolder":false,"folderId":184,"folderTitle":".ONCE OFF","folderUrl":"/dashboards/f/kGgx9rIiz/once-off","provisioned":false,"provisionedExternalId":""},"dashboard":{"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations \u0026 Alerts","type":"dashboard"}]},"editable":true,"gnetId":null,"graphTooltip":1,"id":null,"links":[],"panels":[{"aliasColors":{"activity: idle in transaction":"blue","web apdex":"yellow"},"bars":false,"dashLength":10,"dashes":false,"fill":0,"gridPos":{"h":12,"w":24,"x":0,"y":0},"id":12,"interval":"","legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","options":{},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"activity: idle in transaction"},{"alias":"web apdex","yaxis":2}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"avg_over_time(pg_stat_activity_count{environment=\"gprd\", datname=\"gitlabhq_production\", fqdn=\"patroni-04-db-gprd.c.gitlab-production.internal\", state=\"idle in transaction\"}[$__interval])","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"activity: idle in transaction","refId":"A"},{"expr":"avg_over_time(gitlab_service_apdex:ratio{type=\"web\", environment=\"gprd\", stage=\"main\"}[$__interval])","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"web apdex","refId":"B"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Idle in Transaction vs Web Apdex","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"reqps","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{"activity: idle in transaction":"blue","web apdex":"yellow"},"bars":false,"dashLength":10,"dashes":false,"fill":0,"gridPos":{"h":12,"w":24,"x":0,"y":12},"id":13,"interval":"","legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","options":{},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"activity: idle in transaction"},{"alias":"inverted web apdex","yaxis":2}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"avg_over_time(pg_stat_activity_count{environment=\"gprd\", datname=\"gitlabhq_production\", fqdn=\"patroni-04-db-gprd.c.gitlab-production.internal\", state=\"idle in transaction\"}[$__interval])","format":"time_series","interval":"1m","intervalFactor":10,"legendFormat":"activity: idle in transaction","refId":"A"},{"expr":"1 -  avg_over_time(gitlab_service_apdex:ratio{type=\"web\", environment=\"gprd\", stage=\"main\"}[$__interval])","format":"time_series","interval":"1m","intervalFactor":10,"legendFormat":"inverted web apdex","refId":"B"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Idle in Transaction vs Web Apdex","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"reqps","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{"QueryTime":"blue","Web Apdex":"yellow"},"bars":false,"dashLength":10,"dashes":false,"fill":0,"gridPos":{"h":13,"w":24,"x":0,"y":24},"id":2,"interval":"","legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","options":{},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"Web Apdex","yaxis":2}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"avg(rate(pg_stat_statements_time_milliseconds{queryid=\"2722666312\"}[$__interval]))","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"QueryTime","refId":"A"},{"expr":"avg_over_time(gitlab_service_apdex:ratio{type=\"web\", environment=\"gprd\", stage=\"main\"}[$__interval])","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Web Apdex","refId":"B"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Web Apdex Score v. SELECT internal_ids FOR UPDATE time","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus-db-01-inf-gprd","fill":0,"gridPos":{"h":8,"w":24,"x":0,"y":37},"id":8,"interval":"","legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"rate(pg_stat_statements_calls{user=\"gitlab\", queryid=~\"3589441560|2687552202|2725112711|1872435845|541675883|1850364306|3046840721|372766009|1024354833|1847148074|2869434099|3470580987|1870450709|3261529960|2112300417|4110719723|2410196384|3147930916|2869637736|1471483198|813146095|1562312218|4070001059|2700573270|3734280165|1890462193|3662628805|4198375393|3709830407|473577831\", fqdn=\"patroni-04-db-gprd.c.gitlab-production.internal\"}[$__interval]) / \nrate(pg_stat_statements_calls{user=\"gitlab\", queryid=~\"3589441560|2687552202|2725112711|1872435845|541675883|1850364306|3046840721|372766009|1024354833|1847148074|2869434099|3470580987|1870450709|3261529960|2112300417|4110719723|2410196384|3147930916|2869637736|1471483198|813146095|1562312218|4070001059|2700573270|3734280165|1890462193|3662628805|4198375393|3709830407|473577831\"}[12h] offset 1h)","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"queryid: {{ queryid }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Relative Query Rates compared to 1hr before","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":null,"format":"percentunit","label":null,"logBase":10,"max":"10","min":"0.1","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus-db-01-inf-gprd","fill":0,"gridPos":{"h":8,"w":24,"x":0,"y":45},"id":9,"interval":"","legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"rate(pg_stat_statements_time_milliseconds{user=\"gitlab\", queryid=~\"3589441560|2687552202|2725112711|1872435845|541675883|1850364306|3046840721|372766009|1024354833|1847148074|2869434099|3470580987|1870450709|3261529960|2112300417|4110719723|2410196384|3147930916|2869637736|1471483198|813146095|1562312218|4070001059|2700573270|3734280165|1890462193|3662628805|4198375393|3709830407|473577831\", fqdn=\"patroni-04-db-gprd.c.gitlab-production.internal\"}[$__interval]) / \nrate(pg_stat_statements_time_milliseconds{user=\"gitlab\", queryid=~\"3589441560|2687552202|2725112711|1872435845|541675883|1850364306|3046840721|372766009|1024354833|1847148074|2869434099|3470580987|1870450709|3261529960|2112300417|4110719723|2410196384|3147930916|2869637736|1471483198|813146095|1562312218|4070001059|2700573270|3734280165|1890462193|3662628805|4198375393|3709830407|473577831\"}[12h] offset 1h)","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"queryid: {{ queryid }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Relative Query Rates compared to 1hr before","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":null,"format":"percentunit","label":null,"logBase":10,"max":"10","min":"0.1","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"fill":1,"gridPos":{"h":9,"w":24,"x":0,"y":53},"id":6,"interval":"","legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"pg_stat_activity_count{environment=\"gprd\", datname=\"gitlabhq_production\", fqdn=\"patroni-04-db-gprd.c.gitlab-production.internal\"  }","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ state }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Activity Count for States","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"fill":1,"gridPos":{"h":9,"w":24,"x":0,"y":62},"id":4,"interval":"","legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"avg(rate(pg_stat_statements_calls{queryid=~\"3100829838|1507605447|3703971970|596031129\", fqdn=\"patroni-04-db-gprd.c.gitlab-production.internal\"}[$__interval])) by (queryid, fqdn)","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"QueryID: {{ queryid }}/{{ fqdn }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Call Rates to Selected Queries","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"reqps","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"fill":1,"gridPos":{"h":14,"w":24,"x":0,"y":71},"id":10,"interval":"","legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"rate(pg_stat_statements_time_milliseconds{queryid=~\"3100829838|1507605447|3703971970|870097139|596031129\", fqdn=\"patroni-04-db-gprd.c.gitlab-production.internal\"}[$__interval])","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Call Times to Selected Queries","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus-db-01-inf-gprd","fill":10,"gridPos":{"h":9,"w":24,"x":0,"y":85},"id":5,"interval":"","legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":0,"links":[],"nullPointMode":"null","options":{},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"expr":"sum(rate(pg_stat_statements_time_milliseconds{environment=\"gprd\", type=\"patroni\"}[$__interval])) by (fqdn)","format":"time_series","interval":"1m","intervalFactor":10,"legendFormat":"{{ fqdn }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Total Query Time per Server","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"refresh":false,"schemaVersion":18,"style":"dark","tags":[],"templating":{"list":[]},"time":{"from":"now-6h","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"","title":"Production 895","uid":"KiMEyy7Wk","version":9}}