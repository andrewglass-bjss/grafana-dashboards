{"meta":{"type":"db","canSave":false,"canEdit":false,"canAdmin":false,"canStar":true,"slug":"postgresql-bloat","url":"/d/000000224/postgresql-bloat","expires":"0001-01-01T00:00:00Z","created":"2019-03-18T16:51:47Z","updated":"2020-05-27T21:19:44Z","updatedBy":"ops-contact@gitlab.com","createdBy":"ops-contact@gitlab.com","version":42,"hasAcl":false,"isFolder":false,"folderId":657,"folderTitle":"PostgreSQL","folderUrl":"/dashboards/f/RNfEDpLmz/postgresql","provisioned":false,"provisionedExternalId":""},"dashboard":{"annotations":{"list":[{"$$hashKey":"object:823","builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":true,"iconColor":"#37872D","limit":100,"matchAny":true,"name":"Annotations \u0026 Alerts","showIn":0,"tags":["pgrepack","$environment"],"type":"tags"},{"$$hashKey":"object:825","datasource":"Global","enable":false,"expr":"avg_over_time(ALERTS{alertname=\"PostgreSQL_ConfigurationChange\",fqdn=\"$instance\",alertstate=\"firing\"}[11m])","hide":false,"iconColor":"#7eb26d","limit":100,"name":"PG Config Changes","rawQuery":"SELECT\n  extract(epoch from time_column) AS time,\n  text_column as text,\n  tags_column as tags\nFROM\n  metric_table\nWHERE\n  $__timeFilter(time_column)\n","showIn":0,"step":"11m","tagKeys":"","tags":[],"titleFormat":"","type":"tags"}]},"editable":true,"gnetId":null,"graphTooltip":1,"id":null,"iteration":1590614367944,"links":[],"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","description":"This is based on gitlab-monitor and a live estimation of the database bloat (without an error bound)","editable":true,"error":false,"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":8,"w":6,"x":0,"y":0},"height":"400px","hiddenSeries":false,"id":5,"legend":{"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"dataLinks":[]},"paceLength":10,"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(avg_over_time(gitlab_database_bloat_table_bloat_size{monitor=\"db\",env=\"$environment\", fqdn=\"$instance\"}[$__interval]))\n/ sum(avg_over_time(gitlab_database_bloat_table_real_size{monitor=\"db\",env=\"$environment\", fqdn=\"$instance\"}[$__interval]))","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"1h","intervalFactor":1,"legendFormat":"Table bloat in % of real size","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":60,"tags":[]},{"expr":"sum(avg_over_time(gitlab_database_bloat_btree_bloat_size{monitor=\"db\",env=\"$environment\", fqdn=\"$instance\"}[$__interval]))\n/ sum(avg_over_time(gitlab_database_bloat_btree_real_size{monitor=\"db\",env=\"$environment\", fqdn=\"$instance\"}[$__interval]))","format":"time_series","interval":"1h","intervalFactor":1,"legendFormat":"Index bloat in % of real size","refId":"B"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Bloat ratios (total)","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","description":"This is based on gitlab-monitor and a live estimation of the database bloat (without an error bound)","editable":true,"error":false,"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":8,"w":6,"x":6,"y":0},"height":"400px","hiddenSeries":false,"id":19,"legend":{"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"dataLinks":[]},"paceLength":10,"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(avg_over_time(gitlab_database_bloat_table_bloat_size{monitor=\"db\",env=\"$environment\", fqdn=\"$instance\"}[$__interval]))","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"1h","intervalFactor":1,"legendFormat":"Overall bloat size (tables)","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":60,"tags":[]},{"expr":"sum(avg_over_time(gitlab_database_bloat_btree_bloat_size{monitor=\"db\",env=\"$environment\", fqdn=\"$instance\"}[$__interval]))","format":"time_series","interval":"1h","intervalFactor":1,"legendFormat":"Overall bloat size (indexes)","refId":"B"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Bloat size (total, estimation)","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","description":"This is based on gitlab-monitor and a live estimation of the database bloat (without an error bound)","editable":true,"error":false,"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":8,"w":6,"x":12,"y":0},"height":"400px","hiddenSeries":false,"id":21,"legend":{"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"dataLinks":[]},"paceLength":10,"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"Bloat size","yaxis":2},{"alias":"Bloat in % of real size","yaxis":1},{"alias":"Real size","yaxis":2}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg_over_time(gitlab_database_bloat_table_bloat_size{monitor=\"db\",env=\"$environment\", fqdn=\"$instance\", query_name=\"$table\"}[$__interval])","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"1h","intervalFactor":1,"legendFormat":"Bloat size","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":60,"tags":[]},{"expr":"avg_over_time(gitlab_database_bloat_table_bloat_size{monitor=\"db\",env=\"$environment\", fqdn=\"$instance\", query_name=\"$table\"}[$__interval])\n/ avg_over_time(gitlab_database_bloat_table_real_size{monitor=\"db\",env=\"$environment\", fqdn=\"$instance\", query_name=\"$table\"}[$__interval])","format":"time_series","interval":"1h","intervalFactor":1,"legendFormat":"Bloat in % of real size","refId":"B"},{"expr":"avg_over_time(gitlab_database_bloat_table_real_size{monitor=\"db\",env=\"$environment\", fqdn=\"$instance\", query_name=\"$table\"}[$__interval])","format":"time_series","interval":"1h","intervalFactor":1,"legendFormat":"Real size","refId":"C"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Bloat statistics for selected Table","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"decbytes","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","description":"This is based on gitlab-monitor and a live estimation of the database bloat (without an error bound)","editable":true,"error":false,"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":8,"w":6,"x":18,"y":0},"height":"400px","hiddenSeries":false,"id":20,"legend":{"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"dataLinks":[]},"paceLength":10,"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"Bloat size","yaxis":2},{"alias":"Bloat in % of real size","yaxis":1},{"alias":"Real size","yaxis":2}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg_over_time(gitlab_database_bloat_btree_bloat_size{monitor=\"db\",env=\"$environment\", fqdn=\"$instance\", query_name=\"$index\"}[$__interval])","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"1h","intervalFactor":1,"legendFormat":"Bloat size","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":60,"tags":[]},{"expr":"avg_over_time(gitlab_database_bloat_btree_bloat_size{monitor=\"db\",env=\"$environment\", fqdn=\"$instance\", query_name=\"$index\"}[$__interval])\n/ avg_over_time(gitlab_database_bloat_btree_real_size{monitor=\"db\",env=\"$environment\", fqdn=\"$instance\", query_name=\"$index\"}[$__interval])","format":"time_series","interval":"1h","intervalFactor":1,"legendFormat":"Bloat in % of real size","refId":"B"},{"expr":"avg_over_time(gitlab_database_bloat_btree_real_size{monitor=\"db\",env=\"$environment\", fqdn=\"$instance\", query_name=\"$index\"}[$__interval])","format":"time_series","interval":"1h","intervalFactor":1,"legendFormat":"Real size","refId":"C"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Bloat statistics for selected Index","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"decbytes","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":8},"id":18,"panels":[],"repeat":null,"title":"Site overview","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$prometheus","fill":1,"fillGradient":0,"gridPos":{"h":8,"w":6,"x":0,"y":9},"hiddenSeries":false,"id":23,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"paceLength":10,"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(pg_locks_count{environment=\"$environment\", type=\"patroni\"}) by (mode)","format":"time_series","intervalFactor":1,"legendFormat":"Number of  {{mode}} locks","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Locks across all Patroni hosts","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","fill":0,"fillGradient":0,"gridPos":{"h":8,"w":6,"x":6,"y":9},"hiddenSeries":false,"id":27,"legend":{"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"paceLength":10,"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/rolled/","dashLength":1,"dashes":true,"spaceLength":1,"yaxis":2}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"rate(pg_stat_database_xact_commit{datname=\"gitlabhq_production\", monitor=\"db\",env=\"$environment\", tier=\"db\", type=\"patroni\"}[$__interval])","format":"time_series","interval":"30s","intervalFactor":1,"legendFormat":"{{fqdn}} committed","refId":"A"},{"expr":"rate(pg_stat_database_xact_rollback{datname=\"gitlabhq_production\", monitor=\"db\",env=\"$environment\", tier=\"db\", type=\"patroni\"}[$__interval])","format":"time_series","interval":"30s","intervalFactor":1,"legendFormat":"{{fqdn}} rolled back","refId":"B"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Transactions","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ops","label":"Committed","logBase":1,"max":null,"min":"0","show":true},{"format":"ops","label":"Rolled Back","logBase":1,"max":null,"min":"0","show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","fill":1,"fillGradient":0,"gridPos":{"h":8,"w":6,"x":12,"y":9},"hiddenSeries":false,"id":25,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"paceLength":10,"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"avg(avg_over_time(postgres:pg_replication_lag_bytes{monitor=\"db\",env=\"$environment\", type=\"patroni\"}[$__interval]))","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Avg","refId":"A"},{"expr":"max(avg_over_time(postgres:pg_replication_lag_bytes{monitor=\"db\",env=\"$environment\", type=\"patroni\"}[$__interval]))","format":"time_series","intervalFactor":1,"legendFormat":"Max","refId":"B"},{"expr":"min(avg_over_time(postgres:pg_replication_lag_bytes{monitor=\"db\",env=\"$environment\", type=\"patroni\"}[$__interval]))","format":"time_series","intervalFactor":1,"legendFormat":"Min","refId":"C"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Replication lag (patroni nodes)","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"decbytes","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","fill":0,"fillGradient":0,"gridPos":{"h":8,"w":6,"x":18,"y":9},"hiddenSeries":false,"id":29,"legend":{"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"paceLength":10,"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"pg_slow_queries{monitor=\"db\",env=\"$environment\", tier=\"db\", type=\"patroni\"}","format":"time_series","interval":"30s","intervalFactor":1,"legendFormat":"","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Slow Queries Count (\u003e 1 second)","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"none","label":"Committed","logBase":1,"max":null,"min":"0","show":true},{"format":"none","label":"","logBase":1,"max":null,"min":"0","show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{"95th Percentile":"#9AC48A","99th Percentile":"#E24D42"},"bars":false,"dashLength":10,"dashes":false,"datasource":"influxdb-01-inf-gprd","editable":true,"error":false,"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":6,"x":0,"y":17},"hiddenSeries":false,"id":33,"interval":"1m","legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","options":{"dataLinks":[]},"paceLength":10,"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"alias":"$col","dsType":"influxdb","groupBy":[{"interval":"auto","params":["auto"],"type":"time"}],"measurement":"gitlab.transaction","orderByTime":"ASC","policy":"default","query":"SELECT \"sql_duration_95th\" AS \"95th Percentile\", \"sql_duration_99th\" as \"99th Percentile\", \"sql_duration_mean\" AS \"Mean\" FROM downsampled.\"rails_transaction_timings_overall\" WHERE $timeFilter","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"SQL Timings rails [production only]","tooltip":{"msResolution":true,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","logBase":1,"max":null,"min":"0","show":true},{"format":"short","logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","fill":1,"fillGradient":0,"gridPos":{"h":7,"w":6,"x":6,"y":17},"hiddenSeries":false,"id":37,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"paceLength":10,"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"quantile(0.95, quantile_over_time(0.95, job_environment:gitlab_sql_duration_seconds:p95{monitor=\"app\",env=\"$environment\"}[$__interval]))","format":"time_series","intervalFactor":1,"legendFormat":"95th","refId":"A"},{"expr":"quantile(0.99, quantile_over_time(0.99, job_environment:gitlab_sql_duration_seconds:p99{monitor=\"app\",env=\"$environment\"}[$__interval]))","format":"time_series","intervalFactor":1,"legendFormat":"99th","refId":"B"},{"expr":"histogram_quantile(\n  0.50, \n  sum by (le) (\n    avg_over_time(job_environment:gitlab_sql_duration_seconds_bucket:rate1m{monitor=\"app\",env=\"$environment\"}[$__interval])\n  )\n) \u003e 0","format":"time_series","intervalFactor":1,"legendFormat":"50th","refId":"C"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"SQL Latency","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$prometheus","description":"","editable":true,"error":false,"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":6,"x":12,"y":17},"hiddenSeries":false,"id":31,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"hideZero":true,"max":true,"min":true,"rightSide":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"maxPerRow":2,"nullPointMode":"null","options":{"dataLinks":[]},"paceLength":10,"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/^5.*/","yaxis":2}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(avg_over_time(backend_code:haproxy_server_http_responses_total:irate1m{code=\"5xx\"}[$__interval])) by (backend)","format":"time_series","hide":false,"interval":"30s","intervalFactor":1,"legendFormat":"haproxy 5xx {{ backend }}","metric":"","refId":"B","step":30},{"expr":"sum without (zone) (avg_over_time(zone:stackdriver_haproxy_errors:rate1m[$__interval]))","format":"time_series","interval":"2m","intervalFactor":1,"legendFormat":"SD haproxy {{code}}","refId":"A"},{"expr":"sum without (zone) (zone:stackdriver_haproxy_deadline_exceeded:rate1m)","format":"time_series","intervalFactor":1,"legendFormat":"SD haproxy timeout","refId":"C"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"5xx responses","tooltip":{"msResolution":true,"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":0,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Global","editable":true,"error":false,"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":7,"w":6,"x":18,"y":17},"hiddenSeries":false,"id":35,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"dataLinks":[]},"paceLength":10,"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"rate(pg_stat_bgwriter_checkpoints_req{env=\"$environment\", tier=\"db\", type=\"patroni\"}[$__interval])*60","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"interval":"1m","intervalFactor":1,"legendFormat":"{{fqdn}} - requested","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":15,"tags":[]},{"expr":"rate(pg_stat_bgwriter_checkpoints_timed{env=\"$environment\", tier=\"db\", type=\"patroni\"}[$__interval])*60","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{fqdn}} - scheduled","metric":"pg_stat_bgwriter_checkpoints_timed","refId":"B","step":15}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Performed Checkpoints","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"opm","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"refresh":"5m","schemaVersion":22,"style":"dark","tags":["postgresql"],"templating":{"list":[{"allValue":null,"current":{"tags":[],"text":"gprd","value":"gprd"},"hide":0,"includeAll":false,"label":null,"multi":false,"name":"environment","options":[{"selected":false,"text":"gprd","value":"gprd"},{"selected":true,"text":"gstg","value":"gstg"}],"query":"gprd,gstg","skipUrlSync":false,"type":"custom"},{"current":{"text":"Global","value":"Global"},"hide":2,"includeAll":false,"label":null,"multi":false,"name":"prometheus","options":[],"query":"prometheus","refresh":1,"regex":"Global","skipUrlSync":false,"type":"datasource"},{"allValue":null,"current":{"text":"postgres-dr-archive-01-db-gprd.c.gitlab-production.internal","value":"postgres-dr-archive-01-db-gprd.c.gitlab-production.internal"},"datasource":"$prometheus","definition":"label_values(gitlab_database_bloat_btree_bloat_size{environment=\"$environment\"}, fqdn)","hide":0,"includeAll":false,"index":-1,"label":"Instance","multi":false,"name":"instance","options":[],"query":"label_values(gitlab_database_bloat_btree_bloat_size{environment=\"$environment\"}, fqdn)","refresh":1,"regex":"","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"text":"abuse_reports_pkey","value":"abuse_reports_pkey"},"datasource":"$prometheus","definition":"label_values(gitlab_database_bloat_btree_bloat_size{environment=\"$environment\"}, query_name)","hide":0,"includeAll":false,"index":-1,"label":"Index","multi":false,"name":"index","options":[],"query":"label_values(gitlab_database_bloat_btree_bloat_size{environment=\"$environment\"}, query_name)","refresh":1,"regex":"","skipUrlSync":false,"sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"text":"abuse_reports","value":"abuse_reports"},"datasource":"$prometheus","definition":"label_values(gitlab_database_bloat_table_bloat_size{environment=\"$environment\"}, query_name)","hide":0,"includeAll":false,"index":-1,"label":"Table","multi":false,"name":"table","options":[],"query":"label_values(gitlab_database_bloat_table_bloat_size{environment=\"$environment\"}, query_name)","refresh":1,"regex":"","skipUrlSync":false,"sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-9d","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"utc","title":"PostgreSQL Bloat","uid":"000000224","variables":{"list":[]},"version":42}}