{"meta":{"type":"db","canSave":true,"canEdit":true,"canStar":true,"slug":"ci","expires":"0001-01-01T00:00:00Z","created":"2016-11-29T16:44:44Z","updated":"2018-05-15T08:33:13Z","updatedBy":"ops-contact@gitlab.com","createdBy":"ops-contact@gitlab.com","version":268},"dashboard":{"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations \u0026 Alerts","type":"dashboard"},{"datasource":"Production","enable":true,"hide":false,"iconColor":"#f9e2d2","limit":100,"name":"GitLab.com deployments","query":"SELECT version FROM forever.deployments","showIn":0,"tags":[],"type":"tags"}]},"editable":true,"gnetId":null,"graphTooltip":1,"hideControls":false,"id":null,"links":[{"asDropdown":true,"icon":"external link","keepTime":true,"tags":["ci"],"targetBlank":true,"title":"CI dashboards","type":"dashboards"}],"refresh":"5m","rows":[{"collapse":false,"height":78,"panels":[{"cacheTimeout":null,"colorBackground":false,"colorValue":true,"colors":["#d44a3a","rgba(237, 129, 40, 0.89)","#299c46"],"datasource":"Prometheus in Azure","format":"none","gauge":{"maxValue":5,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"id":75,"interval":null,"links":[],"mappingType":2,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"NULL","text":"DOWN","to":"NULL"},{"from":"0","text":"DOWN","to":"0.9"},{"from":"1","text":"PARTIALLY DOW","to":"2.9"},{"from":"3","text":"UP","to":"3.9"}],"span":3,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":true,"lineColor":"#5195ce","show":true},"tableColumn":"","targets":[{"dsType":"influxdb","expr":"sum(up{job=\"private-runners\"})","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":"1,3","title":"private-runners state","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"DOWN","value":"null"},{"op":"=","text":"DOWN","value":"0"},{"op":"=","text":"PARTIALLY DOWN","value":"1"},{"op":"=","text":"PARTIALLY DOWN","value":"2"},{"op":"=","text":"UP","value":"3"}],"valueName":"current"},{"cacheTimeout":null,"colorBackground":false,"colorValue":true,"colors":["#d44a3a","rgba(237, 129, 40, 0.89)","#299c46"],"datasource":"Prometheus in Azure","format":"none","gauge":{"maxValue":5,"minValue":0,"show":false,"thresholdLabels":true,"thresholdMarkers":true},"id":76,"interval":null,"links":[],"mappingType":2,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"DOWN","to":"null"},{"from":"0","text":"DOWN","to":"0.9"},{"from":"1","text":"PARTIALLY DOWN","to":"3.9"},{"from":"4","text":"UP","to":"4.9"}],"span":3,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":true,"lineColor":"#5195ce","show":true},"tableColumn":"","targets":[{"dsType":"influxdb","expr":"sum(up{job=\"shared-runners\"})","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":"0.9,3.9","title":"shared-runners state","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"DOWN","value":"null"},{"op":"=","text":"DOWN","value":"0"},{"op":"=","text":"PARTIALLY DOWN","value":"1"},{"op":"=","text":"PARTIALLY DOWN","value":"2"},{"op":"=","text":"PARTIALLY DOWN","value":"3"},{"op":"=","text":"UP","value":"4"}],"valueName":"current"},{"cacheTimeout":null,"colorBackground":false,"colorValue":true,"colors":["#d44a3a","rgba(237, 129, 40, 0.89)","#299c46"],"datasource":"Prometheus in Azure","format":"none","gauge":{"maxValue":4,"minValue":0,"show":false,"thresholdLabels":true,"thresholdMarkers":true},"id":77,"interval":null,"links":[],"mappingType":2,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"DOWN","to":"null"},{"from":"0","text":"DOWN","to":"0.9"},{"from":"1","text":"PARTIALLY DOWN","to":"3.9"},{"from":"4","text":"UP","to":"4.9"}],"span":3,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":true,"lineColor":"#5195ce","show":true},"tableColumn":"","targets":[{"dsType":"influxdb","expr":"sum(up{job=\"shared-runners-gitlab-org\"})","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":"0.9,3.9","title":"shared-runners-gitlab-org state","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"DOWN","value":"null"},{"op":"=","text":"DOWN","value":"0"},{"op":"=","text":"PARTIALLY DOWN","value":"1"},{"op":"=","text":"PARTIALLY DOWN","value":"2"},{"op":"=","text":"PARTIALLY DOWN","value":"3"},{"op":"=","text":"UP","value":"4"}],"valueName":"current"},{"cacheTimeout":null,"colorBackground":false,"colorValue":true,"colors":["#d44a3a","rgba(237, 129, 40, 0.89)","#299c46"],"datasource":"Prometheus in Azure","format":"none","gauge":{"maxValue":4,"minValue":0,"show":false,"thresholdLabels":true,"thresholdMarkers":true},"id":78,"interval":null,"links":[],"mappingType":2,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"DOWN","to":"null"},{"from":"0","text":"DOWN","to":"0.9"},{"from":"1","text":"PARTIALLY DOWN","to":"1.9"},{"from":"2","text":"UP","to":"2.9"}],"span":3,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":true,"lineColor":"#5195ce","show":true},"tableColumn":"","targets":[{"dsType":"influxdb","expr":"sum(up{job=\"staging-shared-runners\"})","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":"0.9,1.9","title":"staging-shared-runners state","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"DOWN","value":"null"},{"op":"=","text":"DOWN","value":"0"},{"op":"=","text":"PARTIALLY DOWN","value":"1"},{"op":"=","text":"PARTIALLY DOWN","value":"2"},{"op":"=","text":"PARTIALLY DOWN","value":"3"},{"op":"=","text":"UP","value":"4"}],"valueName":"current"}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":96,"panels":[{"cacheTimeout":null,"colorBackground":false,"colorValue":true,"colors":["#299c46","rgba(237, 129, 40, 0.89)","#d44a3a"],"datasource":"Prometheus in Azure","format":"none","gauge":{"maxValue":400,"minValue":0,"show":true,"thresholdLabels":false,"thresholdMarkers":true},"id":72,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"span":3,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"dsType":"influxdb","expr":"sum(ci_runner_builds{job=\"private-runners\"})","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":"200,300","title":"Jobs on private-runners","transparent":false,"type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"current"},{"cacheTimeout":null,"colorBackground":false,"colorValue":true,"colors":["#299c46","rgba(237, 129, 40, 0.89)","#d44a3a"],"datasource":"Prometheus in Azure","format":"none","gauge":{"maxValue":800,"minValue":0,"show":true,"thresholdLabels":false,"thresholdMarkers":true},"id":73,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"span":3,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"dsType":"influxdb","expr":"sum(ci_runner_builds{job=\"shared-runners\"})","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":"400,600","title":"Jobs on shared-runners","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"current"},{"cacheTimeout":null,"colorBackground":false,"colorValue":true,"colors":["#299c46","rgba(237, 129, 40, 0.89)","#d44a3a"],"datasource":"Prometheus in Azure","format":"none","gauge":{"maxValue":1100,"minValue":0,"show":true,"thresholdLabels":false,"thresholdMarkers":true},"id":74,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"span":3,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":true,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"dsType":"influxdb","expr":"sum(ci_runner_builds{job=\"shared-runners-gitlab-org\"})","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":"600,900","title":"Jobs on shared-runners-gitlab-org","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"current"},{"cacheTimeout":null,"colorBackground":false,"colorValue":true,"colors":["#299c46","rgba(237, 129, 40, 0.89)","#d44a3a"],"datasource":"Prometheus in Azure","format":"none","gauge":{"maxValue":300,"minValue":0,"show":true,"thresholdLabels":false,"thresholdMarkers":true},"id":79,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"span":3,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":true,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"dsType":"influxdb","expr":"sum(ci_runner_builds{job=\"staging-shared-runners\"})","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":"100,200","title":"Jobs on staging-shared-runners","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"current"}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":112,"panels":[{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"datasource":"Prometheus in Azure","format":"none","gauge":{"maxValue":1000,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"id":62,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"120%","prefix":"","prefixFontSize":"120%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"span":3,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":true,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"dsType":"influxdb","expr":"sum(max(sum(digitalocean_droplets_count{job=~\"digitalocean_gitlab_bv|digitalocean_gitlab_ci\",region=~\"(nyc1|sfo1)\",tags=~\".*(shared_runners|private_runners|ce_ee_runners).*\"}) by (instance,job)) by (job))","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":240,"tags":[]}],"thresholds":"","title":"Digital Ocean Droplets","transparent":false,"type":"singlestat","valueFontSize":"120%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"current"},{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"datasource":"Prometheus in Azure","format":"none","gauge":{"maxValue":1000,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"id":80,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"120%","prefix":"","prefixFontSize":"120%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"span":3,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":true,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"dsType":"influxdb","expr":"sum(max(gcp_exporter_instances_count{project=\"gitlab-ci-155816\",tags=~\".*docker-machine.*\"}) by (zone, tags))","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":240,"tags":[]}],"thresholds":"","title":"GCP Machines","transparent":false,"type":"singlestat","valueFontSize":"120%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"current"},{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"datasource":"Prometheus in Azure","decimals":null,"format":"short","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"height":"","id":65,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"span":3,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":true,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"dsType":"influxdb","expr":"sum(hanging_droplets_cleaner_remove_droplets_total{instance=~\"$hanging_droplets_cleaner\"})","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":1,"legendFormat":"","metric":"","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":120,"tags":[]}],"thresholds":"","title":"Hanging droplets removed","transparent":false,"type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"delta"},{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"datasource":"Prometheus in Azure","decimals":null,"format":"short","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"height":"","id":68,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"span":3,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":true,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"dsType":"influxdb","expr":"sum(droplet_zero_machines_cleaner_removed_machines_total{instance=~\"$droplet_zero_machines_cleaner\"})","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":1,"legendFormat":"","metric":"","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":120,"tags":[]}],"thresholds":"","title":"Droplet zero machines removed","transparent":false,"type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"delta"}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":444,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus on prometheus-app-01","decimals":null,"editable":true,"error":false,"fill":0,"grid":{},"id":2,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(ci_pending_builds{fqdn=~\"$gl_monitor_fqdn\", shared_runners=\"yes\",has_minutes=~\"$has_minutes\"})","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"pending jobs for project with shared runners enabled","metric":"ci_builds_","policy":"default","refId":"B","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":10,"tags":[]},{"dsType":"influxdb","expr":"sum(ci_pending_builds{fqdn=~\"$gl_monitor_fqdn\", shared_runners=\"no\",has_minutes=~\"$has_minutes\"})","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"pending jobs for project without shared runners enabled","metric":"ci_builds_","policy":"default","refId":"C","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":10,"tags":[]},{"dsType":"influxdb","expr":"sum(ci_running_builds{fqdn=~\"$gl_monitor_fqdn\", shared_runner=\"yes\",has_minutes=~\"$has_minutes\"})","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"running jobs on shared runners","metric":"ci_builds_","policy":"default","refId":"D","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":10,"tags":[]},{"dsType":"influxdb","expr":"sum(ci_running_builds{fqdn=~\"$gl_monitor_fqdn\", shared_runner=\"no\",has_minutes=~\"$has_minutes\"})","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"running jobs on specific runners","metric":"ci_builds_","policy":"default","refId":"E","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":10,"tags":[]},{"expr":"sum(ci_stale_builds{fqdn=~\"$gl_monitor_fqdn\"})","format":"time_series","intervalFactor":2,"legendFormat":"stale jobs","refId":"A","step":10}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Jobs at GitLab.com","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Jobs at GitLab.com","titleSize":"h6"},{"collapse":false,"height":357,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus on prometheus-app-01","description":"","fill":0,"id":89,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"show":true,"sort":"current","sortDesc":false,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":1,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"histogram_quantile(0.5, sum(rate(job_queue_duration_seconds_bucket{environment=~\"$gitlab_env\", jobs_running_for_project=~\"$jobs_running_for_project\"}[5m])) by (shared_runner, jobs_running_for_project, le))","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"shared: {{shared_runner}} - running_jobs: {{jobs_running_for_project}} - 50th","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]},{"expr":"histogram_quantile(0.9, sum(rate(job_queue_duration_seconds_bucket{environment=~\"$gitlab_env\", jobs_running_for_project=~\"$jobs_running_for_project\"}[5m])) by (shared_runner, jobs_running_for_project, le))","format":"time_series","intervalFactor":2,"legendFormat":"shared: {{shared_runner}} - running_jobs: {{jobs_running_for_project}} - 90th","refId":"B"},{"expr":"histogram_quantile(0.95, sum(rate(job_queue_duration_seconds_bucket{environment=~\"$gitlab_env\", jobs_running_for_project=~\"$jobs_running_for_project\"}[5m])) by (shared_runner, jobs_running_for_project, le))","format":"time_series","intervalFactor":2,"legendFormat":"shared: {{shared_runner}} - running_jobs: {{jobs_running_for_project}} - 95th","refId":"C"},{"expr":"histogram_quantile(0.99, sum(rate(job_queue_duration_seconds_bucket{environment=~\"$gitlab_env\", jobs_running_for_project=~\"$jobs_running_for_project\"}[5m])) by (shared_runner, jobs_running_for_project, le))","format":"time_series","intervalFactor":2,"legendFormat":"shared: {{shared_runner}} - running_jobs: {{jobs_running_for_project}} - 99th","refId":"D"}],"thresholds":[{"colorMode":"critical","fill":true,"line":true,"op":"gt","value":10}],"timeFrom":null,"timeShift":null,"title":"Job queue duration histogram percentiles (5m rate)","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus on prometheus-app-01","description":"The bigger value for all lines, the better it is.\n\n10s line on level 40% means: less than 40% of jobs was queued in less than 10s. So having 1s line at the level of 100% is what would be the best.","fill":0,"id":84,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"show":true,"sort":"current","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":1,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(increase(job_queue_duration_seconds_bucket{environment=\"prd\", jobs_running_for_project=~\"$jobs_running_for_project\", le=\"1\"}[5m])) by (shared_runner, jobs_running_for_project) / sum(increase(job_queue_duration_seconds_count{environment=\"prd\", jobs_running_for_project=~\"$jobs_running_for_project\"}[5m])) by (shared_runner, jobs_running_for_project)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"shared: {{shared_runner}} - running_jobs: {{jobs_running_for_project}} - 1s","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]},{"expr":"sum(increase(job_queue_duration_seconds_bucket{environment=\"prd\", jobs_running_for_project=~\"$jobs_running_for_project\", le=\"3\"}[5m])) by (shared_runner, jobs_running_for_project) / sum(increase(job_queue_duration_seconds_count{environment=\"prd\", jobs_running_for_project=~\"$jobs_running_for_project\"}[5m])) by (shared_runner, jobs_running_for_project)","format":"time_series","hide":false,"intervalFactor":2,"legendFormat":"shared: {{shared_runner}} - running_jobs: {{jobs_running_for_project}} - 3s","refId":"B"},{"expr":"sum(increase(job_queue_duration_seconds_bucket{environment=\"prd\", jobs_running_for_project=~\"$jobs_running_for_project\", le=\"10\"}[5m])) by (shared_runner, jobs_running_for_project) / sum(increase(job_queue_duration_seconds_count{environment=\"prd\", jobs_running_for_project=~\"$jobs_running_for_project\"}[5m])) by (shared_runner, jobs_running_for_project)","format":"time_series","hide":false,"intervalFactor":2,"legendFormat":"shared: {{shared_runner}} - running_jobs: {{jobs_running_for_project}} - 10s","refId":"C"},{"expr":"sum(increase(job_queue_duration_seconds_bucket{environment=\"prd\", jobs_running_for_project=~\"$jobs_running_for_project\", le=\"30\"}[5m])) by (shared_runner, jobs_running_for_project) / sum(increase(job_queue_duration_seconds_count{environment=\"prd\", jobs_running_for_project=~\"$jobs_running_for_project\"}[5m])) by (shared_runner, jobs_running_for_project)","format":"time_series","hide":false,"intervalFactor":2,"legendFormat":"shared: {{shared_runner}} - running_jobs: {{jobs_running_for_project}} - 30s","refId":"D"}],"thresholds":[{"colorMode":"critical","fill":true,"line":true,"op":"lt","value":0.8}],"timeFrom":null,"timeShift":null,"title":"Job queue duration histogram (5m increase)","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Job queue timings","titleSize":"h6"},{"collapse":true,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":0,"id":85,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"sort":"current","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[{"dashUri":"db/sidekiq-stats","dashboard":"Sidekiq Stats","keepTime":true,"targetBlank":true,"title":"Sidekiq Stats","type":"dashboard"}],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":3,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sidekiq_queue_size{environment=~\"$gitlab_env\",name=~\"pipeline.*\"} and on (fqdn) gitlab:redis_master","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"{{name}}","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Sidekiq Queues","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Production","fill":1,"id":86,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[{"dashUri":"db/grape-endpoints","dashboard":"Grape Endpoints","includeVars":false,"keepTime":true,"params":"var-action=Grape%23POST%20%2Fapi%2Fjobs%2Frequest","targetBlank":true,"title":"Grape Endpoints","type":"dashboard"}],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":3,"stack":false,"steppedLine":false,"targets":[{"alias":"amount","dsType":"influxdb","groupBy":[],"measurement":"grape_transaction_counts_per_action","orderByTime":"ASC","policy":"downsampled","refId":"A","resultFormat":"time_series","select":[[{"params":["count"],"type":"field"}]],"tags":[{"key":"action","operator":"=","value":"Grape#POST /api/jobs/request"}]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"jobs/request API transactions","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Production","fill":0,"id":87,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"sortDesc":false,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":3,"stack":false,"steppedLine":false,"targets":[{"alias":"","dsType":"influxdb","groupBy":[],"measurement":"grape_transaction_timings_per_action","orderByTime":"ASC","policy":"downsampled","refId":"A","resultFormat":"time_series","select":[[{"params":["sql_duration_95th"],"type":"field"}],[{"params":["sql_duration_99th"],"type":"field"}],[{"params":["sql_duration_mean"],"type":"field"}],[{"params":["sql_duration_max"],"type":"field"}]],"tags":[{"key":"action","operator":"=","value":"Grape#POST /api/jobs/request"}]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"jobs/request SQL timings","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":0,"id":88,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"show":true,"sort":"max","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[{"dashUri":"db/fleet-overview","dashboard":"Fleet Overview","keepTime":true,"targetBlank":true,"title":"Fleet Overview","type":"dashboard"}],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/AVG/","color":"#e0f9d7","linewidth":2}],"spaceLength":10,"span":3,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"node_load1{tier=\"sv\", environment=\"$gitlab_env\", type=\"api\"}","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"{{fqdn}}","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]},{"expr":"avg(node_load1{tier=\"sv\", environment=\"$gitlab_env\", type=\"api\"})","format":"time_series","intervalFactor":2,"legendFormat":"AVG","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"API Workers Load1","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Sidekiq \u0026 API","titleSize":"h6"},{"collapse":true,"height":346,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":28,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"rightSide":false,"show":true,"sort":null,"sortDesc":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":4,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(ci_runner_builds{job=~\"$runner_type\"}) by (instance)","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"{{instance}}","metric":"ci_runner_builds","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":40,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Jobs running on runners owned by GitLab Inc. (by instance)","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","editable":true,"error":false,"fill":1,"grid":{},"id":71,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":4,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(ci_runner_builds{job=~\"$runner_type\"}) by (instance, runner)","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"{{instance}} - {{runner}}","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":40,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Jobs running on runners owned by GitLab Inc. (by worker)","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","editable":true,"error":false,"fill":1,"grid":{},"id":1,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":4,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(ci_runner_builds{job=~\"$runner_type\"}) by (job)","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"","intervalFactor":2,"legendFormat":"{{job}}","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":40,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Jobs running on runners owned by GitLab Inc. (by runner type)","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Jobs running on runners owned by GitLab Inc. (part I)","titleSize":"h6"},{"collapse":true,"height":346,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","editable":true,"error":false,"fill":1,"id":45,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":4,"stack":true,"steppedLine":false,"targets":[{"expr":"sum(ci_runner_builds{job=~\"$runner_type\"}) by (state)","format":"time_series","intervalFactor":2,"legendFormat":"{{state}}","metric":"ci_runner_builds","refId":"A","step":40}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Jobs running on runners owned by GitLab Inc. (by Runner's state)","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","editable":true,"error":false,"fill":1,"id":6,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"show":true,"sort":"current","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":4,"stack":true,"steppedLine":false,"targets":[{"expr":"sum(ci_runner_builds{job=~\"$runner_type\"}) by (stage)","intervalFactor":2,"legendFormat":"{{stage}}","metric":"ci_runner_builds","refId":"A","step":40}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Jobs running on runners owned by GitLab Inc. (by Runner's stage)","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","editable":true,"error":false,"fill":1,"id":46,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":4,"stack":true,"steppedLine":false,"targets":[{"expr":"sum(ci_runner_builds{job=~\"$runner_type\"}) by (executor_stage)","intervalFactor":2,"legendFormat":"{{executor_stage}}","metric":"ci_runner_builds","refId":"A","step":40}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Jobs running on runners owned by GitLab Inc. (by Runner's executor_stage)","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Jobs running on runners owned by GitLab Inc. (part II)","titleSize":"h6"},{"collapse":true,"height":544,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":0,"id":82,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"sort":"avg","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"avg","color":"#cffaff","linewidth":2}],"spaceLength":10,"span":6,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(irate(ci_runner_failed_jobs_total{job=~\"$runner_type\",failure_reason=~\"$runner_job_failure_reason\"}[1m])) by (instance, failure_reason)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"{{instance}} - {{failure_reason}}","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]},{"expr":"AVG(irate(ci_runner_failed_jobs_total{job=~\"$runner_type\",failure_reason=~\"$runner_job_failure_reason\"}[1m]))","format":"time_series","intervalFactor":2,"legendFormat":"avg","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Jobs failures on Runners (by instance)","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ops","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":0,"id":83,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"sort":"avg","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"avg","color":"#cffaff","linewidth":2}],"spaceLength":10,"span":6,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(irate(ci_runner_failed_jobs_total{job=~\"$runner_type\",failure_reason=~\"$runner_job_failure_reason\"}[1m])) by (job, failure_reason)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"{{job}} - {{failure_reason}}","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]},{"expr":"AVG(irate(ci_runner_failed_jobs_total{job=~\"$runner_type\",failure_reason=~\"$runner_job_failure_reason\"}[1m]))","format":"time_series","intervalFactor":2,"legendFormat":"avg","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Jobs failures on Runners (by Runner type)","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ops","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Jobs failures on Runners","titleSize":"h6"},{"collapse":true,"height":287,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","decimals":null,"editable":true,"error":false,"fill":1,"id":3,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"rightSide":false,"show":true,"sort":"current","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":true,"steppedLine":false,"targets":[{"expr":"sum(ci_docker_machines_provider_machine_states{job=~\"$runner_type\"}) by (job, state)","format":"time_series","hide":false,"intervalFactor":2,"legendFormat":"{{job}}: {{state}}","refId":"B","step":30}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Auto-scale machines states","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","editable":true,"error":false,"fill":1,"id":4,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"rightSide":false,"show":true,"sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":true,"steppedLine":false,"targets":[{"expr":"sum(ci_docker_machines_provider_machine_states{job=~\"$runner_type\"}) by (job, instance)","intervalFactor":2,"legendFormat":"{{job}}: {{instance}}","refId":"B","step":30}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Auto-scaled machines","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Auto-scale machines","titleSize":"h6"},{"collapse":true,"height":343,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","decimals":2,"editable":true,"error":false,"fill":1,"id":5,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":false,"min":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":4,"stack":true,"steppedLine":false,"targets":[{"expr":"sum(rate(ci_docker_machines_provider_actions_total{job=~\"$runner_type\"}[1m])) by (job, action)","format":"time_series","intervalFactor":2,"legendFormat":"{{job}}: {{action}}","refId":"B","step":240}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Rate of machine creation / deletion","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ops","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","decimals":2,"editable":true,"error":false,"fill":0,"id":47,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":false,"min":false,"show":true,"sort":null,"sortDesc":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":4,"stack":false,"steppedLine":false,"targets":[{"expr":"histogram_quantile(0.50, sum(rate(ci_docker_machines_provider_machine_creation_duration_seconds_bucket{job=~\"$runner_type\"}[5m])) by (job,le))","interval":"10m","intervalFactor":1,"legendFormat":"{{job}}: 50th","refId":"A","step":600},{"expr":"histogram_quantile(0.90, sum(rate(ci_docker_machines_provider_machine_creation_duration_seconds_bucket{job=~\"$runner_type\"}[5m])) by (job,le))","intervalFactor":2,"legendFormat":"{{job}}: 90th","refId":"B","step":240},{"expr":"histogram_quantile(0.99, sum(rate(ci_docker_machines_provider_machine_creation_duration_seconds_bucket{job=~\"$runner_type\"}[5m])) by (job,le))","intervalFactor":2,"legendFormat":"{{job}}: 99th","refId":"C","step":240}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Machines creation timing (5m percentiles)","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","editable":true,"error":false,"fill":1,"id":19,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":4,"stack":true,"steppedLine":false,"targets":[{"expr":"sum(ci_runner_builds{stage=~\"canceled|timedout\",job=~\"$runner_type\"}) by (instance, stage)","intervalFactor":2,"legendFormat":"{{instance}}: {{stage}}","refId":"A","step":240}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Stuck machines","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Machine operations rates and stuck machines count","titleSize":"h6"},{"collapse":true,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","description":"May not count all droplets at this moment","fill":1,"id":61,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":true,"steppedLine":false,"targets":[{"expr":"max(sum(label_replace(digitalocean_droplets_count{job=~\"digitalocean_gitlab_bv|digitalocean_gitlab_ci\",region=~\"(nyc1|sfo1)\",tags=~\".*(shared_runners|private_runners|ce_ee_runners).*\"}, \"runner_group\", \"$2\", \"tags\", \"(.*,)?(shared_runners|private_runners|ce_ee_runners)(,.*)?\")) by (runner_group,instance)) by (runner_group)","format":"time_series","intervalFactor":2,"legendFormat":"{{runner_group}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Digital Ocean Droplets by Tag","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":81,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":true,"steppedLine":false,"targets":[{"expr":"max(label_replace(gcp_exporter_instances_count{project=\"gitlab-ci-155816\"}, \"runner_group\", \"$2\", \"tags\", \"(.*,)?(srm|prm|gsrm)(,.*)?\")) by (runner_group)","format":"time_series","intervalFactor":2,"legendFormat":"{{runner_group}}","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"GCP Machines","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Autoscale providers","titleSize":"h6"},{"collapse":true,"height":352,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus on prometheus-app-01","description":"What triggered the job, and how many of these are there?","editable":true,"error":false,"fill":1,"id":13,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"rightSide":true,"show":true,"sort":"current","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(ci_running_builds{shared_runner=\"yes\",fqdn=~\"$gl_monitor_fqdn\",mirror=\"yes\",has_minutes=~\"$has_minutes\"})","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"Mirror","metric":"ci_builds_per_runner","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":30,"tags":[]},{"dsType":"influxdb","expr":"sum(ci_running_builds{shared_runner=\"yes\",fqdn=~\"$gl_monitor_fqdn\",triggered=\"yes\",has_minutes=~\"$has_minutes\"})","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"Trigger Request","metric":"ci_builds_per_runner","policy":"default","refId":"B","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":30,"tags":[]},{"dsType":"influxdb","expr":"sum(ci_running_builds{shared_runner=\"yes\",fqdn=~\"$gl_monitor_fqdn\",scheduled=\"yes\",has_minutes=~\"$has_minutes\"})","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"Scheduled","metric":"ci_builds_per_runner","policy":"default","refId":"C","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":30,"tags":[]},{"dsType":"influxdb","expr":"sum(ci_running_builds{shared_runner=\"yes\",fqdn=~\"$gl_monitor_fqdn\",scheduled!=\"yes\",triggered!=\"yes\",mirror!=\"yes\",has_minutes=~\"$has_minutes\"})","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"Push","metric":"ci_builds_per_runner","policy":"default","refId":"D","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":30,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Shared Runners - Running Jobs Origin","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus on prometheus-app-01","description":"What triggered the job, and how many of these are there?","fill":1,"id":51,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"rightSide":true,"show":true,"sort":"current","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(ci_running_builds{shared_runner=\"no\",triggered=\"yes\",fqdn=~\"$gl_monitor_fqdn\",has_minutes=~\"$has_minutes\"})","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"Triggered","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":30,"tags":[]},{"dsType":"influxdb","expr":"sum(ci_running_builds{shared_runner=\"no\",scheduled=\"yes\",fqdn=~\"$gl_monitor_fqdn\",has_minutes=~\"$has_minutes\"})","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"Scheduled","policy":"default","refId":"B","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":30,"tags":[]},{"dsType":"influxdb","expr":"sum(ci_running_builds{shared_runner=\"no\",mirror=\"yes\",fqdn=~\"$gl_monitor_fqdn\",has_minutes=~\"$has_minutes\"})","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"Mirroring","policy":"default","refId":"C","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":30,"tags":[]},{"dsType":"influxdb","expr":"sum(ci_running_builds{shared_runner=\"no\",mirror=\"no\",triggered=\"no\",scheduled=\"no\",fqdn=~\"$gl_monitor_fqdn\",has_minutes=~\"$has_minutes\"})","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"Push","policy":"default","refId":"D","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":30,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Specific Runners - Running Jobs Origin","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus on prometheus-app-01","editable":true,"error":false,"fill":1,"id":14,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(ci_running_builds{shared_runner=\"yes\",fqdn=~\"$gl_monitor_fqdn\",has_minutes=~\"$has_minutes\"}) by (runner)","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"runner {{runner}}","metric":"ci_builds_per_runner","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":10,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Shared runners - jobs distribution by runner","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Jobs distribution","titleSize":"h6"},{"collapse":true,"height":270,"panels":[{"columns":[{"text":"Current","value":"current"},{"text":"Min","value":"min"},{"text":"Max","value":"max"},{"text":"Avg","value":"avg"}],"datasource":"Prometheus on prometheus-app-01","filterNull":false,"fontSize":"100%","id":33,"links":[],"pageSize":15,"scroll":true,"showHeader":true,"sort":{"col":1,"desc":true},"span":6,"styles":[{"dateFormat":"YYYY-MM-DD HH:mm:ss","pattern":"Time","type":"date"},{"colorMode":"cell","colors":["rgba(50, 172, 45, 0.97)","rgba(237, 129, 40, 0.89)","rgba(245, 54, 54, 0.9)"],"decimals":0,"pattern":"/.*/","thresholds":["400","500"],"type":"number","unit":"none"}],"targets":[{"expr":"sum(ci_pending_builds{fqdn=~\"$gl_monitor_fqdn\", shared_runners=\"yes\",has_minutes=~\"$has_minutes\"}) by (namespace)","format":"time_series","intervalFactor":2,"legendFormat":"Namespace: {{namespace}}","refId":"A","step":30}],"title":"Pending jobs with shared runners enabled","transform":"timeseries_aggregations","type":"table"},{"columns":[{"text":"Current","value":"current"},{"text":"Min","value":"min"},{"text":"Max","value":"max"},{"text":"Avg","value":"avg"}],"datasource":"Prometheus on prometheus-app-01","filterNull":false,"fontSize":"100%","id":60,"links":[],"pageSize":15,"scroll":true,"showHeader":true,"sort":{"col":1,"desc":true},"span":6,"styles":[{"dateFormat":"YYYY-MM-DD HH:mm:ss","pattern":"Time","type":"date"},{"colorMode":"cell","colors":["rgba(50, 172, 45, 0.97)","rgba(237, 129, 40, 0.89)","rgba(245, 54, 54, 0.9)"],"decimals":0,"pattern":"/.*/","thresholds":["400","500"],"type":"number","unit":"none"}],"targets":[{"expr":"sum(ci_running_builds{fqdn=~\"$gl_monitor_fqdn\", shared_runner=\"yes\",has_minutes=~\"$has_minutes\"}) by (namespace)","format":"time_series","intervalFactor":2,"legendFormat":"Namespace: {{namespace}}","refId":"A","step":30}],"title":"Running jobs on Shared Runners","transform":"timeseries_aggregations","type":"table"}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Jobs queue","titleSize":"h6"},{"collapse":true,"height":265,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus on prometheus-app-01","editable":true,"error":false,"fill":1,"id":20,"legend":{"alignAsTable":true,"avg":true,"current":false,"max":true,"min":false,"show":true,"total":true,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":4,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(increase(gitlab_workhorse_multipart_upload_bytes{type=\"artifacts\"}[1h]))","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"1h","intervalFactor":2,"legendFormat":"Uploads size","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":7200,"tags":[]},{"expr":"sum(increase(gitlab_workhorse_sendfile_bytes{type=\"artifacts\"}[1h]))","format":"time_series","interval":"1h","intervalFactor":2,"legendFormat":"Downloads size","refId":"B","step":7200}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Artifacts operations","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"decbytes","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus on prometheus-app-01","editable":true,"error":false,"fill":1,"id":21,"legend":{"alignAsTable":true,"avg":true,"current":false,"max":true,"min":false,"show":true,"total":true,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":4,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(increase(gitlab_workhorse_multipart_upload_requests{type=\"artifacts\"}[1h]))","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"1h","intervalFactor":2,"legendFormat":"Uploads","metric":"gtlab_workhorse_multipart_upload_requsts","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":7200,"tags":[]},{"expr":"sum(increase(gitlab_workhorse_sendfile_requests{type=\"artifacts\"}[1h]))","format":"time_series","interval":"1h","intervalFactor":2,"legendFormat":"Downloads","refId":"B","step":7200}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Artifacts operations - requests","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus on prometheus-app-01","editable":true,"error":false,"fill":1,"id":27,"legend":{"alignAsTable":true,"avg":true,"current":false,"max":true,"min":false,"show":true,"total":true,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":4,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(increase(gitlab_workhorse_multipart_upload_files{type=\"artifacts\"}[1h]))","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"1h","intervalFactor":2,"legendFormat":"Uploads","metric":"gtlab_workhorse_multipart_upload_requsts","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":7200,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Artifacts operations - files","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"CI Artifacts operations","titleSize":"h6"},{"collapse":true,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus on prometheus-app-01","editable":true,"error":false,"fill":1,"id":22,"legend":{"alignAsTable":true,"avg":true,"current":false,"max":true,"min":false,"show":true,"total":true,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"(sum(increase(gitlab_workhorse_git_http_bytes{agent=\"gitlab-ci\"}[1h])) by (direction))","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"1h","intervalFactor":2,"legendFormat":"Size ({{direction}})","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":7200,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Git operations by CI","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"decbytes","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus on prometheus-app-01","editable":true,"error":false,"fill":1,"id":23,"legend":{"alignAsTable":true,"avg":true,"current":false,"max":true,"min":false,"show":true,"total":true,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(increase(gitlab_workhorse_git_http_requests{agent=\"gitlab-ci\"}[1h]))","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"1h","intervalFactor":2,"legendFormat":"Requests","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":7200,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Git operations by CI - requests","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Git operations by CI","titleSize":"h6"},{"collapse":true,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus on prometheus-app-01","fill":1,"id":29,"legend":{"alignAsTable":true,"avg":true,"current":false,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":4,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(rate(gitlab_workhorse_multipart_upload_bytes{type=\"artifacts\"}[1h])) / sum(rate(gitlab_workhorse_multipart_upload_bytes[1h]))","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"1h","intervalFactor":2,"legendFormat":"Artifacts uploads vs. all uploads","metric":"gitlab_workhorse_multipart","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":7200,"tags":[]}],"thresholds":[],"timeFrom":"24h","timeShift":null,"title":"Artifacts uploads vs. all uploads","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus on prometheus-app-01","fill":1,"id":30,"legend":{"alignAsTable":true,"avg":true,"current":false,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":4,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(rate(gitlab_workhorse_sendfile_bytes{type=\"artifacts\"}[1h])) / sum(rate(gitlab_workhorse_sendfile_bytes[1h]))","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"1h","intervalFactor":2,"legendFormat":"Artifacts downloads vs. all downloads","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":7200,"tags":[]}],"thresholds":[],"timeFrom":"24h","timeShift":null,"title":"Artifacts downloads vs. all downloads","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus on prometheus-app-01","fill":1,"id":31,"legend":{"alignAsTable":true,"avg":true,"current":false,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":4,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(rate(gitlab_workhorse_git_http_bytes{agent=\"gitlab-ci\"}[1h])) / sum(rate(gitlab_workhorse_git_http_bytes[1h]))","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"1h","intervalFactor":2,"legendFormat":"CI Git HTTP transfer vs. all Git HTTP transfer","metric":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":7200,"tags":[]}],"thresholds":[],"timeFrom":"24h","timeShift":null,"title":"CI Git HTTP transfer vs. all Git HTTP transfer","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"CI bandwidth usage","titleSize":"h6"},{"collapse":true,"height":523,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","editable":true,"error":false,"fill":0,"id":15,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"rightSide":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"process_open_fds{job=~\"$runner_type\"} / process_max_fds{job=~\"$runner_type\"}","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"intervalFactor":2,"legendFormat":"{{instance}}","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":10,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"File Descriptors","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"File Descriptors usage","titleSize":"h6"},{"collapse":true,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus on prometheus-app-01","fill":1,"id":35,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":true,"steppedLine":false,"targets":[{"expr":"sum(rate(gitlab_workhorse_builds_register_handler_requests[5m])) by (status)","format":"time_series","intervalFactor":2,"legendFormat":"{{status}}","refId":"A","step":120}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Requests state counter","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus on prometheus-app-01","fill":1,"id":36,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":true,"steppedLine":false,"targets":[{"expr":"sum(gitlab_workhorse_builds_register_handler_open) by (state)","format":"time_series","intervalFactor":2,"legendFormat":"{{state}}","refId":"A","step":120}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Requests open in given state","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Workhorse Long polling","titleSize":"h6"},{"collapse":true,"height":392,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus on prometheus-app-01","fill":0,"id":37,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":false,"min":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":4,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(gitlab_workhorse_queueing_busy{queue_name=\"ci_api_job_requests\",job=\"gitlab-workhorse-api\"})","format":"time_series","intervalFactor":2,"legendFormat":"handled","refId":"B","step":240},{"expr":"sum(gitlab_workhorse_queueing_limit{queue_name=\"ci_api_job_requests\",job=\"gitlab-workhorse-api\"})","format":"time_series","intervalFactor":2,"legendFormat":"handling limit","refId":"C","step":240}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Requests handled","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus on prometheus-app-01","fill":0,"id":39,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":false,"min":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":4,"stack":false,"steppedLine":false,"targets":[{"expr":"max(gitlab_workhorse_queueing_waiting{queue_name=\"ci_api_job_requests\",job=\"gitlab-workhorse-api\"})","format":"time_series","intervalFactor":2,"legendFormat":"max waiting in queue","refId":"A","step":240},{"expr":"max(gitlab_workhorse_queueing_queue_limit{queue_name=\"ci_api_job_requests\",job=\"gitlab-workhorse-api\"})","format":"time_series","intervalFactor":2,"legendFormat":"queueing limit","refId":"D","step":240},{"expr":"avg(gitlab_workhorse_queueing_waiting{queue_name=\"ci_api_job_requests\",job=\"gitlab-workhorse-api\"})","format":"time_series","intervalFactor":2,"legendFormat":"average waiting in queue","refId":"B","step":240}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Requests queued (max)","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus on prometheus-app-01","fill":0,"id":38,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":false,"min":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":1,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":4,"stack":false,"steppedLine":false,"targets":[{"expr":"histogram_quantile(0.50, sum(rate(gitlab_workhorse_queueing_waiting_time_bucket{queue_name=\"ci_api_job_requests\",job=\"gitlab-workhorse-api\"}[5m])) by (le))","format":"time_series","interval":"","intervalFactor":2,"legendFormat":"50th","refId":"A","step":240},{"expr":"histogram_quantile(0.90, sum(rate(gitlab_workhorse_queueing_waiting_time_bucket{queue_name=\"ci_api_job_requests\",job=\"gitlab-workhorse-api\"}[5m])) by (le))","format":"time_series","interval":"","intervalFactor":2,"legendFormat":"90th","refId":"B","step":240}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Request Queueing Time","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"transparent":false,"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"dtdurations","label":"","logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Workhorse Queueing","titleSize":"h6"},{"collapse":true,"height":307,"panels":[{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"datasource":"Prometheus on prometheus-app-01","format":"short","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"id":41,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"span":1,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"dsType":"influxdb","expr":"sum(gitlab_workhorse_queueing_limit{job=\"gitlab-workhorse-api\",queue_name=\"ci_api_job_requests\"})","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"Handling limit","metric":"gitlab_workhorse_queueing_limit","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":1800,"tags":[]}],"thresholds":"","title":"Requests handling limit","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"current"},{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"datasource":"Prometheus on prometheus-app-01","decimals":null,"format":"short","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"id":42,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"span":1,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"dsType":"influxdb","expr":"sum(gitlab_workhorse_queueing_queue_limit{job=\"gitlab-workhorse-api\",queue_name=\"ci_api_job_requests\"})","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"Handling limit","metric":"gitlab_workhorse_queueing_limit","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":1800,"tags":[]}],"thresholds":"","title":"Requests queueing limit","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"current"},{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"datasource":"Prometheus on prometheus-app-01","decimals":null,"format":"s","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"id":43,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"span":1,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"dsType":"influxdb","expr":"max(gitlab_workhorse_queueing_queue_timeout{job=\"gitlab-workhorse-api\",queue_name=\"ci_api_job_requests\"})","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"Queueing timeout","metric":"gitlab_workhorse_queueing_limit","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":1800,"tags":[]}],"thresholds":"","title":"Requests queueing timeout","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"current"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus on prometheus-app-01","fill":1,"id":44,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":false,"min":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":9,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(rate(gitlab_workhorse_queueing_errors{queue_name=\"ci_api_job_requests\",job=\"gitlab-workhorse-api\"}[5m])) by (type)","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"{{type}}","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":120,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Queueing errors","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ops","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Workhorse Queueing errors and limits","titleSize":"h6"},{"collapse":true,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":48,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":false,"min":false,"show":true,"sort":"current","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(rate(ci_runner_errors{job=~\"$runner_type\"}[5m])) by (job,level)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"5m","intervalFactor":2,"legendFormat":"{{job}}: {{level}}","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":600,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Runners error 5m rate (by job\u0026level)","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ops","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":49,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":false,"min":false,"show":true,"sort":"avg","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(rate(ci_runner_errors{job=~\"$runner_type\"}[5m])) by (instance,level)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"5m","intervalFactor":2,"legendFormat":"{{instance}}: {{level}}","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":600,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Runners error 5m rate (by instance\u0026level)","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ops","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Runners errors","titleSize":"h6"},{"collapse":true,"height":455,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","decimals":0,"editable":true,"error":false,"fill":0,"id":18,"legend":{"alignAsTable":true,"avg":false,"current":true,"hideEmpty":false,"hideZero":false,"max":true,"min":false,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","percentage":false,"pointradius":1,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"time() - process_start_time_seconds{job=~\"$runner_type\"}","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"{{instance}}","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":30,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Runners uptime","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"columns":[],"datasource":"Prometheus in Azure","editable":true,"error":false,"filterNull":false,"fontSize":"100%","id":12,"links":[],"pageSize":null,"scroll":true,"showHeader":true,"sort":{"col":2,"desc":false},"span":6,"styles":[{"dateFormat":"YYYY-MM-DD HH:mm:ss","pattern":"Time","type":"date"},{"colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"decimals":2,"pattern":"/.*/","thresholds":[],"type":"string","unit":"short"}],"targets":[{"dsType":"influxdb","expr":"ci_runner_version_info{job=~\"$runner_type\"}","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"1h","intervalFactor":2,"legendFormat":"{{instance}}: {{version}} ({{revision}})","metric":"ci_runner_version_info","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":7200,"tags":[]}],"timeFrom":"1m","title":"Runner versions","transform":"timeseries_to_rows","type":"table"}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Runners uptime \u0026 version","titleSize":"h6"},{"collapse":true,"height":339,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":0,"id":52,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":4,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"node_load1{fqdn=~\"$cache_server\"}","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"{{fqdn}}","metric":"node_load15","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":40,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Load","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":0,"id":53,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":4,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"avg(irate(node_cpu{fqdn=~\"$cache_server\",mode=~\"iowait|user|system|steal\"}[1m])) by (fqdn,mode)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"{{fqdn}} - {{mode}}","metric":"node_cpu","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":40,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"CPU","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":0,"id":54,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":4,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"node_memory_MemTotal{fqdn=~\"$cache_server\"}","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"{{fqdn}}: total","metric":"node_cpu","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":40,"tags":[]},{"expr":"node_memory_MemTotal{fqdn=~\"$cache_server\"} - node_memory_MemFree{fqdn=~\"$cache_server\"} - node_memory_Buffers{fqdn=~\"$cache_server\"} - node_memory_Cached{fqdn=~\"$cache_server\"}","format":"time_series","intervalFactor":2,"legendFormat":"{{fqdn}}: used","refId":"B","step":40}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Memory","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":0,"id":55,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/.*: read/","transform":"negative-Y"}],"spaceLength":10,"span":4,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(rate(node_disk_read_time_ms{fqdn=~\"$cache_server\", device!~\"dm.*|md.*\"}[1m])) by (fqdn,device)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"{{fqdn}} - {{device}}: read","metric":"node_cpu","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":40,"tags":[]},{"expr":"sum(rate(node_disk_write_time_ms{fqdn=~\"$cache_server\", device!~\"dm.*|md.*\"}[1m])) by (fqdn,device)","format":"time_series","intervalFactor":2,"legendFormat":"{{fqdn}} - {{device}}: write","refId":"B","step":40}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Total IO Wait","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":0,"id":57,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/.*: read/","transform":"negative-Y"}],"spaceLength":10,"span":4,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(rate(node_disk_reads_completed{fqdn=~\"$cache_server\", device!~\"dm.*|md.*\"}[1m])) by (fqdn,device)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"{{fqdn}} - {{device}}: reads","metric":"node_cpu","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":40,"tags":[]},{"expr":"sum(rate(node_disk_writes_completed{fqdn=~\"$cache_server\", device!~\"dm.*|md.*\"}[1m])) by (fqdn,device)","format":"time_series","intervalFactor":2,"legendFormat":"{{fqdn}} - {{device}}: writes","refId":"B","step":40}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Total IOPS","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"iops","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":0,"id":58,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/.*: read/","transform":"negative-Y"}],"spaceLength":10,"span":4,"stack":false,"steppedLine":false,"targets":[{"expr":"node_filesystem_avail{fqdn=~\"$cache_server\",fstype=~\"ext4|xfs\"}","format":"time_series","intervalFactor":2,"legendFormat":"{{fqdn}} - {{mountpoint}}","metric":"","refId":"C","step":40}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Filesystem","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":0,"id":56,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":4,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"node_netstat_Tcp_CurrEstab{fqdn=~\"$cache_server\"}","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"{{fqdn}}","metric":"","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":40,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Established connections","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":0,"id":59,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/.*receive/","transform":"negative-Y"}],"spaceLength":10,"span":4,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"rate(node_network_receive_bytes{fqdn=~\"$cache_server\",device=~\"eth.*\"}[1m])","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"{{fqdn}} - {{device}}: receive","metric":"","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":40,"tags":[]},{"expr":"rate(node_network_transmit_bytes{fqdn=~\"$cache_server\",device=~\"eth.*\"}[1m])","format":"time_series","intervalFactor":2,"legendFormat":"{{fqdn}} - {{device}}: transmit","metric":"","refId":"B","step":40}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Network usage","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"Bps","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":67,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(nginx_http_connections{fqdn=~\"$cache_server\",job=\"runners-cache-server\"}) by (fqdn)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"{{fqdn}}","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":30,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Nginx connections","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":66,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"sum(rate(nginx_http_requests_total{fqdn=~\"$cache_server\",job=\"runners-cache-server\"}[1m])) by (fqdn,status)","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":2,"legendFormat":"{{fqdn}} - {{status}}","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":30,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Nginx requests","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ops","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Cache servers","titleSize":"h6"},{"collapse":true,"height":511,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":63,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"rate(hanging_droplets_cleaner_remove_droplets_total{instance=~\"$hanging_droplets_cleaner\"}[15m])","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"15m","intervalFactor":1,"legendFormat":"{{instance}}","metric":"hanging_droplets_cleaner_remove_droplets_total","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":900,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Hanging droplepts remove rate (15m)","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ops","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":64,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"rate(hanging_droplets_cleaner_remove_droplet_errors_total{instance=~\"$hanging_droplets_cleaner\"}[15m])","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"15m","intervalFactor":1,"legendFormat":"{{instance}}","metric":"","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":900,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Hanging droplepts remove errors rate (15m)","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ops","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Hanging droplets cleaner","titleSize":"h6"},{"collapse":true,"height":477,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":69,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"rate(droplet_zero_machines_cleaner_removed_machines_total{instance=~\"$droplet_zero_machines_cleaner\"}[15m])","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"15m","intervalFactor":1,"legendFormat":"{{instance}}","metric":"hanging_droplets_cleaner_remove_droplets_total","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":900,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Droplet zero machines remove rate (15m)","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ops","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus in Azure","fill":1,"id":70,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":6,"stack":true,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"rate(droplet_zero_machines_cleaner_remove_machine_errors_total{instance=~\"$droplet_zero_machines_cleaner\"}[15m])","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"15m","intervalFactor":1,"legendFormat":"{{instance}}","metric":"hanging_droplets_cleaner_remove_droplets_total","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":900,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Droplet zero machines remove errors rate (15m)","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ops","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Droplet zero machines cleaner","titleSize":"h6"}],"schemaVersion":14,"style":"dark","tags":["ci"],"templating":{"list":[{"allValue":null,"current":{"text":"All","value":"$__all"},"datasource":"Prometheus in Azure","hide":0,"includeAll":true,"label":"Runner Type","multi":true,"name":"runner_type","options":[],"query":"ci_runner_version_info{job=~\".*\",job!=\"omnibus-runners\"}","refresh":1,"regex":"/job=\"([^\\/]*?)\"/","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"text":"All","value":"$__all"},"datasource":"Prometheus in Azure","hide":0,"includeAll":true,"label":"Cache Server","multi":true,"name":"cache_server","options":[],"query":"node_boot_time{fqdn=~\"runners-cache-.*\"}","refresh":1,"regex":"/fqdn=\"([^\\/]*?)\"/","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"text":"postgres-01.db.prd.gitlab.com","value":"postgres-01.db.prd.gitlab.com"},"datasource":"Prometheus on prometheus-app-01","hide":0,"includeAll":false,"label":"GitLab Monitor instance","multi":false,"name":"gl_monitor_fqdn","options":[],"query":"ci_running_builds{fqdn=~\".*\"}","refresh":1,"regex":"/fqdn=\"(postgres-[^\\/]*?)\"/","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"selected":true,"text":"yes","value":"yes"},"hide":0,"includeAll":true,"label":"Has Shared Runners Minutes","multi":true,"name":"has_minutes","options":[{"selected":false,"text":"All","value":"$__all"},{"selected":true,"text":"yes","value":"yes"},{"selected":false,"text":"no","value":"no"}],"query":"yes,no","type":"custom"},{"allValue":null,"current":{"text":"All","value":"$__all"},"datasource":"Prometheus in Azure","hide":0,"includeAll":true,"label":"Hanging doplets cleaner","multi":true,"name":"hanging_droplets_cleaner","options":[],"query":"hanging_droplets_cleaner_remove_droplets_total","refresh":1,"regex":"/instance=\"([^\\/]*?)\"/","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"text":"All","value":"$__all"},"datasource":"Prometheus in Azure","hide":0,"includeAll":true,"label":"Droplet zero machines cleaner","multi":true,"name":"droplet_zero_machines_cleaner","options":[],"query":"droplet_zero_machines_cleaner_removed_machines_total","refresh":1,"regex":"/instance=\"([^\\/]*?)\"/","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"text":"All","value":"$__all"},"datasource":"Prometheus in Azure","hide":0,"includeAll":true,"label":"Job failure reason","multi":true,"name":"runner_job_failure_reason","options":[],"query":"label_values(ci_runner_failed_jobs_total, failure_reason)","refresh":1,"regex":"","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"text":"prd","value":"prd"},"datasource":"Prometheus on prometheus-app-01","hide":0,"includeAll":false,"label":"GitLab env","multi":false,"name":"gitlab_env","options":[],"query":"job_queue_duration_seconds_sum","refresh":1,"regex":"/environment=\"([^\"]+)\"/","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"tags":[],"text":"0","value":["0"]},"datasource":"Prometheus on prometheus-app-01","hide":0,"includeAll":true,"label":"Jobs running for project","multi":true,"name":"jobs_running_for_project","options":[],"query":"job_queue_duration_seconds_sum","refresh":1,"regex":"/jobs_running_for_project=\"([^\"]+)\"/","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-3h","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"utc","title":"CI","version":268}}