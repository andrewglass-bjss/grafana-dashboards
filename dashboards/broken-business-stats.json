{"meta":{"type":"db","canSave":false,"canEdit":false,"canAdmin":false,"canStar":true,"slug":"broken-business-stats","url":"/d/qe8wE9Iik/broken-business-stats","expires":"0001-01-01T00:00:00Z","created":"2018-06-12T12:11:47Z","updated":"2018-06-12T13:51:40Z","updatedBy":"ops-contact@gitlab.com","createdBy":"ops-contact@gitlab.com","version":4,"hasAcl":false,"isFolder":false,"folderId":183,"folderTitle":".BROKEN","folderUrl":"/dashboards/f/cYFN9rSmz/broken","provisioned":false,"provisionedExternalId":""},"dashboard":{"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations \u0026 Alerts","type":"dashboard"}]},"editable":true,"gnetId":null,"graphTooltip":0,"id":null,"links":[],"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus-01-inf-gprd","editable":true,"error":false,"fill":0,"grid":{},"gridPos":{"h":6,"w":12,"x":0,"y":0},"id":1,"legend":{"avg":true,"current":false,"max":true,"min":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"alias":"Created","dsType":"influxdb","expr":"","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":1,"policy":"default","query":"SELECT sum(count) AS \"Amount\" FROM year.events_per_hour WHERE event = 'create_repository' AND $timeFilter GROUP BY time(1h)","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]},{"alias":"Imported","dsType":"influxdb","expr":"","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":1,"policy":"default","query":"SELECT sum(count) AS \"Amount\" FROM year.events_per_hour WHERE event = 'import_repository' AND $timeFilter GROUP BY time(1h)","rawQuery":true,"refId":"B","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]},{"alias":"Forked","dsType":"influxdb","expr":"","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"intervalFactor":1,"policy":"default","query":"SELECT sum(count) AS \"Amount\" FROM year.events_per_hour WHERE event = 'fork_repository' AND $timeFilter GROUP BY time(1h)","rawQuery":true,"refId":"C","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"New Repos Source","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus-01-inf-gprd","editable":true,"error":false,"fill":0,"grid":{},"gridPos":{"h":6,"w":12,"x":12,"y":0},"id":3,"legend":{"avg":false,"current":false,"max":true,"min":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"alias":"Commits","dsType":"influxdb","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"policy":"default","query":"SELECT sum(count) AS \"Amount\" FROM year.events_per_hour WHERE event = 'push_commit' AND $timeFilter GROUP BY time(1h)","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]},{"alias":"Branch","dsType":"influxdb","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"policy":"default","query":"SELECT sum(count) AS \"Amount\" FROM year.events_per_hour WHERE event = 'push_branch' AND $timeFilter GROUP BY time(1h)","rawQuery":true,"refId":"B","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]},{"alias":"Tag","dsType":"influxdb","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"policy":"default","query":"SELECT sum(count) AS \"Amount\" FROM year.events_per_hour WHERE event = 'push_tag' AND $timeFilter GROUP BY time(1h)","rawQuery":true,"refId":"C","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Pushes","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus-01-inf-gprd","editable":true,"error":false,"fill":0,"grid":{},"gridPos":{"h":6,"w":8,"x":0,"y":6},"id":2,"legend":{"avg":false,"current":false,"max":true,"min":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"Not Found","yaxis":2}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"alias":"Found new build","dsType":"influxdb","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"policy":"default","query":"SELECT sum(count) AS \"Amount\" FROM year.events_per_hour WHERE event = 'build_found' AND $timeFilter GROUP BY time(1h)","rawQuery":true,"refId":"B","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]},{"alias":"Update","dsType":"influxdb","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"policy":"default","query":"SELECT sum(count) AS \"Amount\" FROM year.events_per_hour WHERE event = 'update_build' AND $timeFilter GROUP BY time(1h)","rawQuery":true,"refId":"C","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]},{"alias":"Not Found (Redis Hit)","dsType":"influxdb","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"policy":"default","query":"SELECT sum(count) AS \"Amount\" FROM year.events_per_hour WHERE event = 'build_not_found_cached' AND $timeFilter GROUP BY time(1h)","rawQuery":true,"refId":"D","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]},{"alias":"Not Found","dsType":"influxdb","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":true,"measurement":"events_per_hour","policy":"year","refId":"A","resultFormat":"time_series","select":[[{"params":["count"],"type":"field"},{"params":[],"type":"sum"}]],"tags":[{"key":"event","operator":"=","value":"build_not_found"}]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"CI Builds","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus-01-inf-gprd","fill":1,"gridPos":{"h":6,"w":8,"x":8,"y":6},"id":12,"legend":{"alignAsTable":false,"avg":false,"current":true,"max":false,"min":false,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"etag_caching_cache_hit","yaxis":1}],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"alias":"$tag_event","dsType":"influxdb","expr":"","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["event"],"type":"tag"},{"params":["none"],"type":"fill"}],"intervalFactor":2,"measurement":"events_per_hour","policy":"year","query":"SELECT sum(count) AS \"Amount\" FROM year.events_per_hour WHERE event = '$event' AND $timeFilter GROUP BY time($interval)","rawQuery":false,"refId":"A","resultFormat":"time_series","select":[[{"params":["count"],"type":"field"},{"params":[],"type":"sum"}]],"tags":[{"key":"event","operator":"=~","value":"/etag/"},{"condition":"AND","key":"event","operator":"!=","value":"etag_caching_middleware_used"},{"condition":"AND","key":"event","operator":"!=","value":"etag_caching_cache_hit"}]},{"alias":"$tag_event","dsType":"influxdb","expr":"","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["event"],"type":"tag"},{"params":["none"],"type":"fill"}],"intervalFactor":2,"measurement":"events_per_hour","policy":"year","query":"SELECT sum(count) AS \"Amount\" FROM year.events_per_hour WHERE event = '$event' AND $timeFilter GROUP BY time($interval)","rawQuery":false,"refId":"B","resultFormat":"time_series","select":[[{"params":["count"],"type":"field"},{"params":[],"type":"sum"}]],"tags":[{"key":"event","operator":"=","value":"etag_caching_cache_hit"}]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Etags","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"transparent":false,"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":["total"]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"datasource":"prometheus-01-inf-gprd","decimals":null,"description":"Number of Upload records in the database","format":"none","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"gridPos":{"h":6,"w":8,"x":16,"y":6},"id":10,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":true},"tableColumn":"","targets":[{"dsType":"influxdb","expr":"max(gitlab_database_rows{query_name=\"uploads\"})","format":"time_series","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"interval":"","intervalFactor":1,"legendFormat":"","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":900,"tags":[]}],"thresholds":"","title":"Uploads","type":"singlestat","valueFontSize":"100%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"max"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus-01-inf-gprd","editable":true,"error":false,"fill":0,"grid":{},"gridPos":{"h":6,"w":8,"x":0,"y":12},"id":6,"legend":{"avg":false,"current":true,"max":false,"min":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"dsType":"influxdb","expr":"gitlab_database_rows{query_name=~\"(orphaned_projects|soft_deleted_projects)\"}","format":"time_series","groupBy":[{"params":["$interval"],"type":"time"},{"params":["null"],"type":"fill"}],"interval":"1m","intervalFactor":2,"legendFormat":"{{query_name}}","metric":"db_rows_count","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"step":120,"tags":[]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Orphans and Soft-deleted","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":null,"description":"","fill":1,"gridPos":{"h":6,"w":8,"x":8,"y":12},"id":8,"interval":"1h","legend":{"alignAsTable":false,"avg":false,"current":true,"max":false,"min":false,"rightSide":false,"show":true,"total":true,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":true,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"alias":"Projects","dsType":"influxdb","groupBy":[{"params":["auto"],"type":"time"},{"params":["none"],"type":"fill"}],"hide":false,"measurement":"rails_method_calls","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["call_count"],"type":"field"},{"params":[],"type":"sum"}]],"tags":[{"key":"action","operator":"=","value":"ProjectsController#create"}]},{"alias":"Groups","dsType":"influxdb","groupBy":[{"params":["auto"],"type":"time"},{"params":["none"],"type":"fill"}],"hide":false,"measurement":"rails_method_calls","policy":"default","refId":"B","resultFormat":"time_series","select":[[{"params":["call_count"],"type":"field"},{"params":[],"type":"sum"}]],"tags":[{"key":"action","operator":"=","value":"GroupsController#create"}]},{"alias":"Snippets","dsType":"influxdb","groupBy":[{"params":["auto"],"type":"time"},{"params":["none"],"type":"fill"}],"hide":false,"measurement":"rails_method_calls","policy":"default","refId":"C","resultFormat":"time_series","select":[[{"params":["call_count"],"type":"field"},{"params":[],"type":"sum"}]],"tags":[{"key":"action","operator":"=","value":"SnippetsController#create"},{"condition":"OR","key":"action","operator":"=","value":"Projects::SnippetsController#create"}]},{"alias":"Issues","dsType":"influxdb","groupBy":[{"params":["auto"],"type":"time"},{"params":["none"],"type":"fill"}],"hide":false,"measurement":"rails_method_calls","policy":"default","refId":"D","resultFormat":"time_series","select":[[{"params":["call_count"],"type":"field"},{"params":[],"type":"sum"}]],"tags":[{"key":"action","operator":"=","value":"Projects::IssuesController#create"}]},{"alias":"Merge requests","dsType":"influxdb","groupBy":[{"params":["auto"],"type":"time"},{"params":["none"],"type":"fill"}],"hide":false,"measurement":"rails_method_calls","policy":"default","query":"SELECT count(\"call_count\") FROM \"rails_method_calls\" WHERE \"action\" = 'Projects::MergeRequestsController#create' AND $timeFilter GROUP BY time($__interval) fill(none)","rawQuery":false,"refId":"E","resultFormat":"time_series","select":[[{"params":["call_count"],"type":"field"},{"params":[],"type":"sum"}]],"tags":[{"key":"action","operator":"=","value":"Projects::MergeRequestsController#create"}]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Object creations","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"transparent":false,"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":["total"]},"yaxes":[{"format":"none","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"refresh":"1h","schemaVersion":16,"style":"dark","tags":["events"],"templating":{"list":[]},"time":{"from":"now-24h","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"utc","title":"Broken: Business Stats","uid":"qe8wE9Iik","version":4}}